
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../public_api/">
      
      
      
      <link rel="icon" href="../assets/keyboard.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Internals - Kebbie</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#internals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest stable version.
  <a href="../..">

    <strong>Go to latest stable version.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kebbie" class="md-header__button md-logo" aria-label="Kebbie" data-md-component="logo">
      
  <img src="../assets/keyboard.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kebbie
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Internals
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/FleksySDK/kebbie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    FleksySDK/kebbie
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kebbie" class="md-nav__button md-logo" aria-label="Kebbie" data-md-component="logo">
      
  <img src="../assets/keyboard.svg" alt="logo">

    </a>
    Kebbie
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FleksySDK/kebbie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    FleksySDK/kebbie
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../emulated_keyboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emulated keyboards
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../emu_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emulator setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_testing_is_done/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How testing is done ?
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../leaderboards/main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaderboard
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Code reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Code reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../public_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Public API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Internals
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Internals
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmdpy" class="md-nav__link">
    <span class="md-ellipsis">
      cmd.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cmd.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.instantiate_correctors" class="md-nav__link">
    <span class="md-ellipsis">
      instantiate_correctors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.common_args" class="md-nav__link">
    <span class="md-ellipsis">
      common_args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correctorspy" class="md-nav__link">
    <span class="md-ellipsis">
      correctors.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="correctors.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector" class="md-nav__link">
    <span class="md-ellipsis">
      EmulatorCorrector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmulatorCorrector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.__reduce__" class="md-nav__link">
    <span class="md-ellipsis">
      __reduce__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.cached_type" class="md-nav__link">
    <span class="md-ellipsis">
      cached_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.auto_correct" class="md-nav__link">
    <span class="md-ellipsis">
      auto_correct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.auto_complete" class="md-nav__link">
    <span class="md-ellipsis">
      auto_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.predict_next_word" class="md-nav__link">
    <span class="md-ellipsis">
      predict_next_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emulatorpy" class="md-nav__link">
    <span class="md-ellipsis">
      emulator.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emulator.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator" class="md-nav__link">
    <span class="md-ellipsis">
      Emulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Emulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_android_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_android_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.select_keyboard" class="md-nav__link">
    <span class="md-ellipsis">
      select_keyboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_ios_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_ios_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.paste" class="md-nav__link">
    <span class="md-ellipsis">
      paste
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.type_characters" class="md-nav__link">
    <span class="md-ellipsis">
      type_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      get_predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_text" class="md-nav__link">
    <span class="md-ellipsis">
      get_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.show_keyboards" class="md-nav__link">
    <span class="md-ellipsis">
      show_keyboards
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.LayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      LayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.LayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GboardLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      GboardLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GboardLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GboardLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IosLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      IosLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IosLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IosLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitproLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      KbkitproLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KbkitproLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitproLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitossLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      KbkitossLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KbkitossLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitossLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SwiftkeyLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SwiftkeyLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SwiftkeyLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SwiftkeyLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YandexLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      YandexLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YandexLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YandexLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TappaLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      TappaLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TappaLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TappaLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FleksyLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      FleksyLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FleksyLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FleksyLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gesturepy" class="md-nav__link">
    <span class="md-ellipsis">
      gesture.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gesture.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.make_swipe_gesture" class="md-nav__link">
    <span class="md-ellipsis">
      make_swipe_gesture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.random_point_around" class="md-nav__link">
    <span class="md-ellipsis">
      random_point_around
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.bernstein_poly" class="md-nav__link">
    <span class="md-ellipsis">
      bernstein_poly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.bezier_curve" class="md-nav__link">
    <span class="md-ellipsis">
      bezier_curve
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.accelerated_linspace" class="md-nav__link">
    <span class="md-ellipsis">
      accelerated_linspace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layoutpy" class="md-nav__link">
    <span class="md-ellipsis">
      layout.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.KeyInfo" class="md-nav__link">
    <span class="md-ellipsis">
      KeyInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.Key" class="md-nav__link">
    <span class="md-ellipsis">
      Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper" class="md-nav__link">
    <span class="md-ellipsis">
      LayoutHelper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayoutHelper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper._extract_infos" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_infos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper._make_virtual_key" class="md-nav__link">
    <span class="md-ellipsis">
      _make_virtual_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper.get_key_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_key_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper.get_key" class="md-nav__link">
    <span class="md-ellipsis">
      get_key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noise_modelpy" class="md-nav__link">
    <span class="md-ellipsis">
      noise_model.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="noise_model.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.Typo" class="md-nav__link">
    <span class="md-ellipsis">
      Typo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel" class="md-nav__link">
    <span class="md-ellipsis">
      NoiseModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NoiseModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel.type_till_space" class="md-nav__link">
    <span class="md-ellipsis">
      type_till_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel.swipe" class="md-nav__link">
    <span class="md-ellipsis">
      swipe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._introduce_typos" class="md-nav__link">
    <span class="md-ellipsis">
      _introduce_typos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._fuzzy_type" class="md-nav__link">
    <span class="md-ellipsis">
      _fuzzy_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._is_correctable" class="md-nav__link">
    <span class="md-ellipsis">
      _is_correctable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._get_common_typos" class="md-nav__link">
    <span class="md-ellipsis">
      _get_common_typos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oraclepy" class="md-nav__link">
    <span class="md-ellipsis">
      oracle.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="oracle.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.Oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Oracle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Oracle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.Oracle.test" class="md-nav__link">
    <span class="md-ellipsis">
      test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.init_tester" class="md-nav__link">
    <span class="md-ellipsis">
      init_tester
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.tester" class="md-nav__link">
    <span class="md-ellipsis">
      tester
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scorerpy" class="md-nav__link">
    <span class="md-ellipsis">
      scorer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scorer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count" class="md-nav__link">
    <span class="md-ellipsis">
      Count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      __add__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      __mul__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Mistake" class="md-nav__link">
    <span class="md-ellipsis">
      Mistake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer" class="md-nav__link">
    <span class="md-ellipsis">
      Scorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.nwp" class="md-nav__link">
    <span class="md-ellipsis">
      nwp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.acp" class="md-nav__link">
    <span class="md-ellipsis">
      acp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.acr" class="md-nav__link">
    <span class="md-ellipsis">
      acr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.swp" class="md-nav__link">
    <span class="md-ellipsis">
      swp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.set_domain" class="md-nav__link">
    <span class="md-ellipsis">
      set_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      _score_accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_precision_recall" class="md-nav__link">
    <span class="md-ellipsis">
      _score_precision_recall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_performances" class="md-nav__link">
    <span class="md-ellipsis">
      _score_performances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.score" class="md-nav__link">
    <span class="md-ellipsis">
      score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.dd_x_layers" class="md-nav__link">
    <span class="md-ellipsis">
      dd_x_layers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.one_score" class="md-nav__link">
    <span class="md-ellipsis">
      one_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenizerpy" class="md-nav__link">
    <span class="md-ellipsis">
      tokenizer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tokenizer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      BasicTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasicTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.word_split" class="md-nav__link">
    <span class="md-ellipsis">
      word_split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.update_context" class="md-nav__link">
    <span class="md-ellipsis">
      update_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      utils.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.profile_fn" class="md-nav__link">
    <span class="md-ellipsis">
      profile_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.euclidian_dist" class="md-nav__link">
    <span class="md-ellipsis">
      euclidian_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.load_keyboard" class="md-nav__link">
    <span class="md-ellipsis">
      load_keyboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.strip_accents" class="md-nav__link">
    <span class="md-ellipsis">
      strip_accents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample_among" class="md-nav__link">
    <span class="md-ellipsis">
      sample_among
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample_partial_word" class="md-nav__link">
    <span class="md-ellipsis">
      sample_partial_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.precision" class="md-nav__link">
    <span class="md-ellipsis">
      precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.recall" class="md-nav__link">
    <span class="md-ellipsis">
      recall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.fbeta" class="md-nav__link">
    <span class="md-ellipsis">
      fbeta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.round_to_n" class="md-nav__link">
    <span class="md-ellipsis">
      round_to_n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.human_readable_memory" class="md-nav__link">
    <span class="md-ellipsis">
      human_readable_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.human_readable_runtime" class="md-nav__link">
    <span class="md-ellipsis">
      human_readable_runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.get_soda_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      get_soda_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__py" class="md-nav__link">
    <span class="md-ellipsis">
      __init__.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.SUPPORTED_LANG" class="md-nav__link">
    <span class="md-ellipsis">
      SUPPORTED_LANG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.N_MOST_COMMON_MISTAKES" class="md-nav__link">
    <span class="md-ellipsis">
      N_MOST_COMMON_MISTAKES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.DEFAULT_SEED" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SEED
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emulatorpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      emulator.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emulator.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS" class="md-nav__link">
    <span class="md-ellipsis">
      IOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GBOARD" class="md-nav__link">
    <span class="md-ellipsis">
      GBOARD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TAPPA" class="md-nav__link">
    <span class="md-ellipsis">
      TAPPA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FLEKSY" class="md-nav__link">
    <span class="md-ellipsis">
      FLEKSY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KBKITPRO" class="md-nav__link">
    <span class="md-ellipsis">
      KBKITPRO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KBKITOSS" class="md-nav__link">
    <span class="md-ellipsis">
      KBKITOSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SWIFTKEY" class="md-nav__link">
    <span class="md-ellipsis">
      SWIFTKEY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YANDEX" class="md-nav__link">
    <span class="md-ellipsis">
      YANDEX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KEYBOARD_PACKAGE" class="md-nav__link">
    <span class="md-ellipsis">
      KEYBOARD_PACKAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID_CAPABILITIES" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID_CAPABILITIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_CAPABILITIES" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_CAPABILITIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.BROWSER_PAD_URL" class="md-nav__link">
    <span class="md-ellipsis">
      BROWSER_PAD_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID_TYPING_FIELD_CLASS_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID_TYPING_FIELD_CLASS_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.DUMMY_RECIPIENT" class="md-nav__link">
    <span class="md-ellipsis">
      DUMMY_RECIPIENT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_TYPING_FIELD_ID" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_TYPING_FIELD_ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_START_CHAT_CLASS_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_START_CHAT_CLASS_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TESSERACT_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      TESSERACT_CONFIG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.PREDICTION_DELAY" class="md-nav__link">
    <span class="md-ellipsis">
      PREDICTION_DELAY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.CONTENT_TO_IGNORE" class="md-nav__link">
    <span class="md-ellipsis">
      CONTENT_TO_IGNORE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.CONTENT_TO_RENAME" class="md-nav__link">
    <span class="md-ellipsis">
      CONTENT_TO_RENAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FLEKSY_LAYOUT" class="md-nav__link">
    <span class="md-ellipsis">
      FLEKSY_LAYOUT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gesturepy_1" class="md-nav__link">
    <span class="md-ellipsis">
      gesture.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gesture.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_RADIUS" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_RADIUS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MIN_N_POINTS_PER_DIST" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_N_POINTS_PER_DIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_N_POINTS_PER_DIST" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_N_POINTS_PER_DIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MIN_ACCELERATION" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_ACCELERATION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_ACCELERATION" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_ACCELERATION
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layoutpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      layout.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.SPACE" class="md-nav__link">
    <span class="md-ellipsis">
      SPACE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.POINT" class="md-nav__link">
    <span class="md-ellipsis">
      POINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.N_ACCENT_PER_LINE" class="md-nav__link">
    <span class="md-ellipsis">
      N_ACCENT_PER_LINE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noise_modelpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      noise_model.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="noise_model.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DEFAULT_TYPO_PROBS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TYPO_PROBS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.SPACE" class="md-nav__link">
    <span class="md-ellipsis">
      SPACE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DELETIONS" class="md-nav__link">
    <span class="md-ellipsis">
      DELETIONS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.FRONT_DELETION_MULTIPLIER" class="md-nav__link">
    <span class="md-ellipsis">
      FRONT_DELETION_MULTIPLIER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DEFAULT_SIGMA_RATIO" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SIGMA_RATIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.CACHE_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      CACHE_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.TWEET_TYPO_CORPUS_URL" class="md-nav__link">
    <span class="md-ellipsis">
      TWEET_TYPO_CORPUS_URL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oraclepy_1" class="md-nav__link">
    <span class="md-ellipsis">
      oracle.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="oracle.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.CHUNK_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      CHUNK_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.MAX_CHAR_PER_SENTENCE" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_CHAR_PER_SENTENCE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.SWIPE_PROB" class="md-nav__link">
    <span class="md-ellipsis">
      SWIPE_PROB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scorerpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      scorer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scorer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.DEFAULT_BETA" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_BETA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.WITH_TYPO" class="md-nav__link">
    <span class="md-ellipsis">
      WITH_TYPO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.WITHOUT_TYPO" class="md-nav__link">
    <span class="md-ellipsis">
      WITHOUT_TYPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilspy_1" class="md-nav__link">
    <span class="md-ellipsis">
      utils.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.SEC_TO_NANOSEC" class="md-nav__link">
    <span class="md-ellipsis">
      SEC_TO_NANOSEC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmdpy" class="md-nav__link">
    <span class="md-ellipsis">
      cmd.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cmd.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.instantiate_correctors" class="md-nav__link">
    <span class="md-ellipsis">
      instantiate_correctors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.common_args" class="md-nav__link">
    <span class="md-ellipsis">
      common_args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.cmd.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correctorspy" class="md-nav__link">
    <span class="md-ellipsis">
      correctors.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="correctors.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector" class="md-nav__link">
    <span class="md-ellipsis">
      EmulatorCorrector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmulatorCorrector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.__reduce__" class="md-nav__link">
    <span class="md-ellipsis">
      __reduce__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.cached_type" class="md-nav__link">
    <span class="md-ellipsis">
      cached_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.auto_correct" class="md-nav__link">
    <span class="md-ellipsis">
      auto_correct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.auto_complete" class="md-nav__link">
    <span class="md-ellipsis">
      auto_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.correctors.EmulatorCorrector.predict_next_word" class="md-nav__link">
    <span class="md-ellipsis">
      predict_next_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emulatorpy" class="md-nav__link">
    <span class="md-ellipsis">
      emulator.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emulator.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator" class="md-nav__link">
    <span class="md-ellipsis">
      Emulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Emulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_android_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_android_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.select_keyboard" class="md-nav__link">
    <span class="md-ellipsis">
      select_keyboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_ios_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_ios_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.paste" class="md-nav__link">
    <span class="md-ellipsis">
      paste
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.type_characters" class="md-nav__link">
    <span class="md-ellipsis">
      type_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      get_predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.get_text" class="md-nav__link">
    <span class="md-ellipsis">
      get_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.Emulator.show_keyboards" class="md-nav__link">
    <span class="md-ellipsis">
      show_keyboards
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.LayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      LayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.LayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GboardLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      GboardLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GboardLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GboardLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IosLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      IosLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IosLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IosLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitproLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      KbkitproLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KbkitproLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitproLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitossLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      KbkitossLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KbkitossLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KbkitossLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SwiftkeyLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SwiftkeyLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SwiftkeyLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SwiftkeyLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YandexLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      YandexLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YandexLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YandexLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TappaLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      TappaLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TappaLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TappaLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FleksyLayoutDetector" class="md-nav__link">
    <span class="md-ellipsis">
      FleksyLayoutDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FleksyLayoutDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FleksyLayoutDetector.get_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gesturepy" class="md-nav__link">
    <span class="md-ellipsis">
      gesture.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gesture.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.make_swipe_gesture" class="md-nav__link">
    <span class="md-ellipsis">
      make_swipe_gesture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.random_point_around" class="md-nav__link">
    <span class="md-ellipsis">
      random_point_around
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.bernstein_poly" class="md-nav__link">
    <span class="md-ellipsis">
      bernstein_poly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.bezier_curve" class="md-nav__link">
    <span class="md-ellipsis">
      bezier_curve
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.accelerated_linspace" class="md-nav__link">
    <span class="md-ellipsis">
      accelerated_linspace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layoutpy" class="md-nav__link">
    <span class="md-ellipsis">
      layout.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.KeyInfo" class="md-nav__link">
    <span class="md-ellipsis">
      KeyInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.Key" class="md-nav__link">
    <span class="md-ellipsis">
      Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper" class="md-nav__link">
    <span class="md-ellipsis">
      LayoutHelper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayoutHelper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper._extract_infos" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_infos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper._make_virtual_key" class="md-nav__link">
    <span class="md-ellipsis">
      _make_virtual_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper.get_key_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_key_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.LayoutHelper.get_key" class="md-nav__link">
    <span class="md-ellipsis">
      get_key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noise_modelpy" class="md-nav__link">
    <span class="md-ellipsis">
      noise_model.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="noise_model.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.Typo" class="md-nav__link">
    <span class="md-ellipsis">
      Typo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel" class="md-nav__link">
    <span class="md-ellipsis">
      NoiseModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NoiseModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel.type_till_space" class="md-nav__link">
    <span class="md-ellipsis">
      type_till_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel.swipe" class="md-nav__link">
    <span class="md-ellipsis">
      swipe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._introduce_typos" class="md-nav__link">
    <span class="md-ellipsis">
      _introduce_typos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._fuzzy_type" class="md-nav__link">
    <span class="md-ellipsis">
      _fuzzy_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._is_correctable" class="md-nav__link">
    <span class="md-ellipsis">
      _is_correctable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.NoiseModel._get_common_typos" class="md-nav__link">
    <span class="md-ellipsis">
      _get_common_typos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oraclepy" class="md-nav__link">
    <span class="md-ellipsis">
      oracle.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="oracle.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.Oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Oracle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Oracle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.Oracle.test" class="md-nav__link">
    <span class="md-ellipsis">
      test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.init_tester" class="md-nav__link">
    <span class="md-ellipsis">
      init_tester
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.tester" class="md-nav__link">
    <span class="md-ellipsis">
      tester
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scorerpy" class="md-nav__link">
    <span class="md-ellipsis">
      scorer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scorer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count" class="md-nav__link">
    <span class="md-ellipsis">
      Count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      __add__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Count.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      __mul__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Mistake" class="md-nav__link">
    <span class="md-ellipsis">
      Mistake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer" class="md-nav__link">
    <span class="md-ellipsis">
      Scorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.nwp" class="md-nav__link">
    <span class="md-ellipsis">
      nwp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.acp" class="md-nav__link">
    <span class="md-ellipsis">
      acp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.acr" class="md-nav__link">
    <span class="md-ellipsis">
      acr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.swp" class="md-nav__link">
    <span class="md-ellipsis">
      swp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.set_domain" class="md-nav__link">
    <span class="md-ellipsis">
      set_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      _score_accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_precision_recall" class="md-nav__link">
    <span class="md-ellipsis">
      _score_precision_recall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer._score_performances" class="md-nav__link">
    <span class="md-ellipsis">
      _score_performances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.Scorer.score" class="md-nav__link">
    <span class="md-ellipsis">
      score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.dd_x_layers" class="md-nav__link">
    <span class="md-ellipsis">
      dd_x_layers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.one_score" class="md-nav__link">
    <span class="md-ellipsis">
      one_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenizerpy" class="md-nav__link">
    <span class="md-ellipsis">
      tokenizer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tokenizer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      BasicTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasicTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.word_split" class="md-nav__link">
    <span class="md-ellipsis">
      word_split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.tokenizer.BasicTokenizer.update_context" class="md-nav__link">
    <span class="md-ellipsis">
      update_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      utils.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.profile_fn" class="md-nav__link">
    <span class="md-ellipsis">
      profile_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.euclidian_dist" class="md-nav__link">
    <span class="md-ellipsis">
      euclidian_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.load_keyboard" class="md-nav__link">
    <span class="md-ellipsis">
      load_keyboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.strip_accents" class="md-nav__link">
    <span class="md-ellipsis">
      strip_accents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample_among" class="md-nav__link">
    <span class="md-ellipsis">
      sample_among
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.sample_partial_word" class="md-nav__link">
    <span class="md-ellipsis">
      sample_partial_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.precision" class="md-nav__link">
    <span class="md-ellipsis">
      precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.recall" class="md-nav__link">
    <span class="md-ellipsis">
      recall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.fbeta" class="md-nav__link">
    <span class="md-ellipsis">
      fbeta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.round_to_n" class="md-nav__link">
    <span class="md-ellipsis">
      round_to_n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.human_readable_memory" class="md-nav__link">
    <span class="md-ellipsis">
      human_readable_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.human_readable_runtime" class="md-nav__link">
    <span class="md-ellipsis">
      human_readable_runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.get_soda_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      get_soda_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__py" class="md-nav__link">
    <span class="md-ellipsis">
      __init__.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.SUPPORTED_LANG" class="md-nav__link">
    <span class="md-ellipsis">
      SUPPORTED_LANG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.N_MOST_COMMON_MISTAKES" class="md-nav__link">
    <span class="md-ellipsis">
      N_MOST_COMMON_MISTAKES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.DEFAULT_SEED" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SEED
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emulatorpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      emulator.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emulator.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS" class="md-nav__link">
    <span class="md-ellipsis">
      IOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.GBOARD" class="md-nav__link">
    <span class="md-ellipsis">
      GBOARD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TAPPA" class="md-nav__link">
    <span class="md-ellipsis">
      TAPPA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FLEKSY" class="md-nav__link">
    <span class="md-ellipsis">
      FLEKSY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KBKITPRO" class="md-nav__link">
    <span class="md-ellipsis">
      KBKITPRO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KBKITOSS" class="md-nav__link">
    <span class="md-ellipsis">
      KBKITOSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.SWIFTKEY" class="md-nav__link">
    <span class="md-ellipsis">
      SWIFTKEY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.YANDEX" class="md-nav__link">
    <span class="md-ellipsis">
      YANDEX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.KEYBOARD_PACKAGE" class="md-nav__link">
    <span class="md-ellipsis">
      KEYBOARD_PACKAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID_CAPABILITIES" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID_CAPABILITIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_CAPABILITIES" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_CAPABILITIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.BROWSER_PAD_URL" class="md-nav__link">
    <span class="md-ellipsis">
      BROWSER_PAD_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.ANDROID_TYPING_FIELD_CLASS_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      ANDROID_TYPING_FIELD_CLASS_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.DUMMY_RECIPIENT" class="md-nav__link">
    <span class="md-ellipsis">
      DUMMY_RECIPIENT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_TYPING_FIELD_ID" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_TYPING_FIELD_ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.IOS_START_CHAT_CLASS_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      IOS_START_CHAT_CLASS_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.TESSERACT_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      TESSERACT_CONFIG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.PREDICTION_DELAY" class="md-nav__link">
    <span class="md-ellipsis">
      PREDICTION_DELAY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.CONTENT_TO_IGNORE" class="md-nav__link">
    <span class="md-ellipsis">
      CONTENT_TO_IGNORE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.CONTENT_TO_RENAME" class="md-nav__link">
    <span class="md-ellipsis">
      CONTENT_TO_RENAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.emulator.FLEKSY_LAYOUT" class="md-nav__link">
    <span class="md-ellipsis">
      FLEKSY_LAYOUT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gesturepy_1" class="md-nav__link">
    <span class="md-ellipsis">
      gesture.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gesture.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_RADIUS" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_RADIUS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MIN_N_POINTS_PER_DIST" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_N_POINTS_PER_DIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_N_POINTS_PER_DIST" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_N_POINTS_PER_DIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MIN_ACCELERATION" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_ACCELERATION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.gesture.MAX_ACCELERATION" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_ACCELERATION
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layoutpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      layout.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.SPACE" class="md-nav__link">
    <span class="md-ellipsis">
      SPACE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.POINT" class="md-nav__link">
    <span class="md-ellipsis">
      POINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.layout.N_ACCENT_PER_LINE" class="md-nav__link">
    <span class="md-ellipsis">
      N_ACCENT_PER_LINE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noise_modelpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      noise_model.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="noise_model.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DEFAULT_TYPO_PROBS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TYPO_PROBS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.SPACE" class="md-nav__link">
    <span class="md-ellipsis">
      SPACE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DELETIONS" class="md-nav__link">
    <span class="md-ellipsis">
      DELETIONS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.FRONT_DELETION_MULTIPLIER" class="md-nav__link">
    <span class="md-ellipsis">
      FRONT_DELETION_MULTIPLIER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.DEFAULT_SIGMA_RATIO" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SIGMA_RATIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.CACHE_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      CACHE_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.noise_model.TWEET_TYPO_CORPUS_URL" class="md-nav__link">
    <span class="md-ellipsis">
      TWEET_TYPO_CORPUS_URL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oraclepy_1" class="md-nav__link">
    <span class="md-ellipsis">
      oracle.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="oracle.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.CHUNK_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      CHUNK_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.MAX_CHAR_PER_SENTENCE" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_CHAR_PER_SENTENCE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.oracle.SWIPE_PROB" class="md-nav__link">
    <span class="md-ellipsis">
      SWIPE_PROB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scorerpy_1" class="md-nav__link">
    <span class="md-ellipsis">
      scorer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scorer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.DEFAULT_BETA" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_BETA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.WITH_TYPO" class="md-nav__link">
    <span class="md-ellipsis">
      WITH_TYPO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kebbie.scorer.WITHOUT_TYPO" class="md-nav__link">
    <span class="md-ellipsis">
      WITHOUT_TYPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilspy_1" class="md-nav__link">
    <span class="md-ellipsis">
      utils.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kebbie.utils.SEC_TO_NANOSEC" class="md-nav__link">
    <span class="md-ellipsis">
      SEC_TO_NANOSEC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="internals">Internals</h1>
<h2 id="cmdpy"><code>cmd.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module containing the implementation for the <code>kebbie</code> command line.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="kebbie.cmd.instantiate_correctors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instantiate_correctors</span><span class="p">(</span><span class="n">keyboard</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">instantiate_emulator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Create the right correctors (with the right platform, etc...) given the
arguments from the command line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>keyboard</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name fo the keyboard to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fast_mode</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, the corrector will be
instantiated in fast mode (only AC).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>instantiate_emulator</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, the emulators are
instantiated (which trigger the layout detection). If <code>False</code>, only
the corrector is instantiated, not the emulator.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.correctors.EmulatorCorrector" href="#kebbie.correctors.EmulatorCorrector">EmulatorCorrector</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of created Correctors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/cmd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_correctors</span><span class="p">(</span>
    <span class="n">keyboard</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fast_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">instantiate_emulator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulatorCorrector</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the right correctors (with the right platform, etc...) given the</span>
<span class="sd">    arguments from the command line.</span>

<span class="sd">    Args:</span>
<span class="sd">        keyboard (str): Name fo the keyboard to load.</span>
<span class="sd">        fast_mode (bool, optional): If `True`, the corrector will be</span>
<span class="sd">            instantiated in fast mode (only AC).</span>
<span class="sd">        instantiate_emulator (bool, optional): If `True`, the emulators are</span>
<span class="sd">            instantiated (which trigger the layout detection). If `False`, only</span>
<span class="sd">            the corrector is instantiated, not the emulator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of created Correctors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keyboard</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gboard&quot;</span><span class="p">,</span> <span class="s2">&quot;tappa&quot;</span><span class="p">,</span> <span class="s2">&quot;swiftkey&quot;</span><span class="p">,</span> <span class="s2">&quot;yandex&quot;</span><span class="p">]:</span>
        <span class="c1"># Android keyboards</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">EmulatorCorrector</span><span class="p">(</span>
                <span class="n">device</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;android&quot;</span><span class="p">,</span>
                <span class="n">keyboard</span><span class="o">=</span><span class="n">keyboard</span><span class="p">,</span>
                <span class="n">fast_mode</span><span class="o">=</span><span class="n">fast_mode</span><span class="p">,</span>
                <span class="n">instantiate_emulator</span><span class="o">=</span><span class="n">instantiate_emulator</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">Emulator</span><span class="o">.</span><span class="n">get_android_devices</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># iOS keyboards</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">EmulatorCorrector</span><span class="p">(</span>
                <span class="n">device</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;ios&quot;</span><span class="p">,</span>
                <span class="n">keyboard</span><span class="o">=</span><span class="n">keyboard</span><span class="p">,</span>
                <span class="n">fast_mode</span><span class="o">=</span><span class="n">fast_mode</span><span class="p">,</span>
                <span class="n">instantiate_emulator</span><span class="o">=</span><span class="n">instantiate_emulator</span><span class="p">,</span>
                <span class="n">ios_name</span><span class="o">=</span><span class="n">ios_name</span><span class="p">,</span>
                <span class="n">ios_platform</span><span class="o">=</span><span class="n">ios_platform</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ios_platform</span><span class="p">,</span> <span class="n">ios_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Emulator</span><span class="o">.</span><span class="n">get_ios_devices</span><span class="p">())</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.cmd.common_args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">common_args</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add common arguments to the given parser.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>parser</code></td>
            <td>
                  <code><span title="argparse.ArgumentParser">ArgumentParser</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parser where to add the arguments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/cmd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">common_args</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add common arguments to the given parser.</span>

<span class="sd">    Args:</span>
<span class="sd">        parser (argparse.ArgumentParser): Parser where to add the arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--keyboard&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-K&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;keyboard&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gboard&quot;</span><span class="p">,</span> <span class="s2">&quot;ios&quot;</span><span class="p">,</span> <span class="s2">&quot;kbkitpro&quot;</span><span class="p">,</span> <span class="s2">&quot;kbkitoss&quot;</span><span class="p">,</span> <span class="s2">&quot;tappa&quot;</span><span class="p">,</span> <span class="s2">&quot;fleksy&quot;</span><span class="p">,</span> <span class="s2">&quot;swiftkey&quot;</span><span class="p">,</span> <span class="s2">&quot;yandex&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Which keyboard, to be tested, is currently installed on the emulator.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.cmd.cli" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cli</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Entry-point of the <code>kebbie</code> command line.</p>

            <details class="quote">
              <summary>Source code in <code>kebbie/cmd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cli</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry-point of the `kebbie` command line.&quot;&quot;&quot;</span>
    <span class="c1"># create the top-level parser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Kebbie&#39;s command line.&quot;</span><span class="p">)</span>
    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;commands&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cmd&quot;</span><span class="p">)</span>

    <span class="n">evaluate_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run the evaluation using emulated keyboard.&quot;</span><span class="p">)</span>
    <span class="n">evaluate_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;evaluate&quot;</span><span class="p">)</span>
    <span class="n">common_args</span><span class="p">(</span><span class="n">evaluate_parser</span><span class="p">)</span>
    <span class="n">evaluate_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--result_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-R&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;result_file&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;results.json&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;When to save the results of the evaluation&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">evaluate_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--all_tasks&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-A&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;all_tasks&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If specified, all tasks are evaluated (not only auto-correction, but also auto-completion and &quot;</span>
        <span class="s2">&quot;next-word prediction).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">evaluate_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--n_sentences&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;n_sentences&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The number of sentences to use for the evaluation. Emulated keyboard are slow, so we can&#39;t run on the &quot;</span>
        <span class="s2">&quot;full test set. Instead we pick the first N sentences.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">evaluate_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--track_mistakes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-T&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;track_mistakes&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If specified, mistakes will be tracked and saved in the result file.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">layout_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s2">&quot;show_layout&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Display the layout over the keyboard for debugging purpose.&quot;</span>
    <span class="p">)</span>
    <span class="n">layout_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;show_layout&quot;</span><span class="p">)</span>
    <span class="n">common_args</span><span class="p">(</span><span class="n">layout_parser</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;evaluate&quot;</span><span class="p">:</span>
        <span class="n">correctors</span> <span class="o">=</span> <span class="n">instantiate_correctors</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">keyboard</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">,</span> <span class="n">instantiate_emulator</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get dataset, and filter it to keep only a small number of sentences</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">get_soda_dataset</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">n_sentences</span><span class="p">)</span>

        <span class="c1"># Run the evaluation</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">correctors</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">track_mistakes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">)</span>

        <span class="c1"># Save the results in a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">result_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overall score : &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall_score&quot;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;show_layout&quot;</span><span class="p">:</span>
        <span class="n">correctors</span> <span class="o">=</span> <span class="n">instantiate_correctors</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">keyboard</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">correctors</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">show_keyboards</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predictions : </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="correctorspy"><code>correctors.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module containing the base Corrector class.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.correctors.EmulatorCorrector" class="doc doc-heading">
            <code>EmulatorCorrector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.correctors.Corrector" href="../public_api/#kebbie.correctors.Corrector">Corrector</a></code></p>


      <p>Corrector using an emulated keyboard.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>platform</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the platform used. <code>android</code> or <code>ios</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keyboard</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the keyboard to test.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device UDID to use for the emulator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fast_mode</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, only auto-correction will be tested,
and suggestions will not be retrieved. This is faster because
we don't take screenshot and run the OCR.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>instantiate_emulator</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>False</code>, the emulator is not
initialized (It will only be initialized after being pickled).
This is useful to quickly create instances of this class,
without going through the whole layout detection (which takes
time) 2 times : at initialization and after being pickled.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/correctors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EmulatorCorrector</span><span class="p">(</span><span class="n">Corrector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Corrector using an emulated keyboard.</span>

<span class="sd">    Args:</span>
<span class="sd">        platform (str): Name of the platform used. `android` or `ios`.</span>
<span class="sd">        keyboard (str): Name of the keyboard to test.</span>
<span class="sd">        device (str): Device UDID to use for the emulator.</span>
<span class="sd">        fast_mode (bool): If `True`, only auto-correction will be tested,</span>
<span class="sd">            and suggestions will not be retrieved. This is faster because</span>
<span class="sd">            we don&#39;t take screenshot and run the OCR.</span>
<span class="sd">        instantiate_emulator (bool): If `False`, the emulator is not</span>
<span class="sd">            initialized (It will only be initialized after being pickled).</span>
<span class="sd">            This is useful to quickly create instances of this class,</span>
<span class="sd">            without going through the whole layout detection (which takes</span>
<span class="sd">            time) 2 times : at initialization and after being pickled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keyboard</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fast_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ios_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ios_platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">instantiate_emulator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">=</span> <span class="n">keyboard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span> <span class="o">=</span> <span class="n">fast_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ios_name</span> <span class="o">=</span> <span class="n">ios_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ios_platform</span> <span class="o">=</span> <span class="n">ios_platform</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">instantiate_emulator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span> <span class="o">=</span> <span class="n">Emulator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                <span class="n">ios_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ios_name</span><span class="p">,</span>
                <span class="n">ios_platform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ios_platform</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Typing on keyboard is slow. Because we go through several AC calls</span>
        <span class="c1"># in one sentence, keep track of the previously typed context, so we</span>
        <span class="c1"># can just type the remaining characters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method simply makes the object pickable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of callable and arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ios_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ios_platform</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">cached_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This class keeps track of the content of the context currently</span>
<span class="sd">        typed in the emulator. This method uses this current context to</span>
<span class="sd">        determine if we need to retype the sentence or not. Instead of</span>
<span class="sd">        always erasing the content being typed, we can directly type the</span>
<span class="sd">        remaining characters, which saves up time.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (str): Context to paste.</span>
<span class="sd">            word (str): Word to type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">context</span> <span class="o">+</span> <span class="n">word</span>
        <span class="k">if</span> <span class="n">sentence</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">):</span>
            <span class="c1"># The sentence to type start similarly as the previous context</span>
            <span class="c1"># Don&#39;t retype everything, just what we need</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">)</span> <span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The previous context is not right, erase everything and type it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span> <span class="o">=</span> <span class="n">sentence</span>

    <span class="k">def</span> <span class="nf">auto_correct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keystrokes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation of `auto_correct` method for emulated keyboards.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (str): String representing the previously typed characters</span>
<span class="sd">                (the beginning of the sentence basically).</span>
<span class="sd">            keystrokes (List[Optional[Tuple[float, float]]]): List of positions</span>
<span class="sd">                (x and y coordinates) for each keystroke of the word being</span>
<span class="sd">                typed.</span>
<span class="sd">            word (str): Word being typed (corresponding to the keystrokes).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of correction candidates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="c1"># On keyboard, the leftmost candidate is the word being typed without</span>
        <span class="c1"># any change. If the word doesn&#39;t have a typo, this first candidate</span>
        <span class="c1"># should be kept as the auto-correction, but if the word has a typo,</span>
        <span class="c1"># we should remove it from the candidates list (as it will be</span>
        <span class="c1"># auto-corrected).</span>
        <span class="c1"># In order to know if it will be auto-corrected or not, we have no</span>
        <span class="c1"># choice but type a space and retrieve the current text to see if it</span>
        <span class="c1"># was auto-corrected or not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">autocorrection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">autocorrection</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">autocorrection</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">autocorrection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">autocorrection</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">candidates</span>

    <span class="k">def</span> <span class="nf">auto_complete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keystrokes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">partial_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation of `auto_complete` method for emulated keyboards.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (str): String representing the previously typed characters</span>
<span class="sd">                (the beginning of the sentence basically).</span>
<span class="sd">            keystrokes (List[Optional[Tuple[float, float]]]): List of positions</span>
<span class="sd">                (x and y coordinates) for each keystroke of the word being</span>
<span class="sd">                typed.</span>
<span class="sd">            partial_word (str): Partial word being typed (corresponding to the</span>
<span class="sd">                keystrokes).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of completion candidates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">partial_word</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span>

        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">candidates</span>

    <span class="k">def</span> <span class="nf">predict_next_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation of `predict_next_word` method for emulated keyboards.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (str): String representing the previously typed characters</span>
<span class="sd">                (the beginning of the sentence basically).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of next-word candidates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># In order to get the predictions, the space should be typed</span>
        <span class="k">assert</span> <span class="n">context</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.correctors.EmulatorCorrector.__reduce__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__reduce__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>This method simply makes the object pickable.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of callable and arguments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/correctors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method simply makes the object pickable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of callable and arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ios_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ios_platform</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.correctors.EmulatorCorrector.cached_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>This class keeps track of the content of the context currently
typed in the emulator. This method uses this current context to
determine if we need to retype the sentence or not. Instead of
always erasing the content being typed, we can directly type the
remaining characters, which saves up time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Context to paste.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word to type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/correctors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cached_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class keeps track of the content of the context currently</span>
<span class="sd">    typed in the emulator. This method uses this current context to</span>
<span class="sd">    determine if we need to retype the sentence or not. Instead of</span>
<span class="sd">    always erasing the content being typed, we can directly type the</span>
<span class="sd">    remaining characters, which saves up time.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (str): Context to paste.</span>
<span class="sd">        word (str): Word to type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">context</span> <span class="o">+</span> <span class="n">word</span>
    <span class="k">if</span> <span class="n">sentence</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">):</span>
        <span class="c1"># The sentence to type start similarly as the previous context</span>
        <span class="c1"># Don&#39;t retype everything, just what we need</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">)</span> <span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The previous context is not right, erase everything and type it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span> <span class="o">=</span> <span class="n">sentence</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.correctors.EmulatorCorrector.auto_correct" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">auto_correct</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">keystrokes</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Implementation of <code>auto_correct</code> method for emulated keyboards.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representing the previously typed characters
(the beginning of the sentence basically).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keystrokes</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of positions
(x and y coordinates) for each keystroke of the word being
typed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word being typed (corresponding to the keystrokes).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of correction candidates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/correctors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">auto_correct</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">keystrokes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of `auto_correct` method for emulated keyboards.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (str): String representing the previously typed characters</span>
<span class="sd">            (the beginning of the sentence basically).</span>
<span class="sd">        keystrokes (List[Optional[Tuple[float, float]]]): List of positions</span>
<span class="sd">            (x and y coordinates) for each keystroke of the word being</span>
<span class="sd">            typed.</span>
<span class="sd">        word (str): Word being typed (corresponding to the keystrokes).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of correction candidates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="c1"># On keyboard, the leftmost candidate is the word being typed without</span>
    <span class="c1"># any change. If the word doesn&#39;t have a typo, this first candidate</span>
    <span class="c1"># should be kept as the auto-correction, but if the word has a typo,</span>
    <span class="c1"># we should remove it from the candidates list (as it will be</span>
    <span class="c1"># auto-corrected).</span>
    <span class="c1"># In order to know if it will be auto-corrected or not, we have no</span>
    <span class="c1"># choice but type a space and retrieve the current text to see if it</span>
    <span class="c1"># was auto-corrected or not.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">type_characters</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">autocorrection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_context</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">autocorrection</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">autocorrection</span><span class="p">:</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">autocorrection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">autocorrection</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.correctors.EmulatorCorrector.auto_complete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">auto_complete</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">keystrokes</span><span class="p">,</span> <span class="n">partial_word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Implementation of <code>auto_complete</code> method for emulated keyboards.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representing the previously typed characters
(the beginning of the sentence basically).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keystrokes</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of positions
(x and y coordinates) for each keystroke of the word being
typed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Partial word being typed (corresponding to the
keystrokes).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of completion candidates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/correctors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">auto_complete</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">keystrokes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">partial_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of `auto_complete` method for emulated keyboards.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (str): String representing the previously typed characters</span>
<span class="sd">            (the beginning of the sentence basically).</span>
<span class="sd">        keystrokes (List[Optional[Tuple[float, float]]]): List of positions</span>
<span class="sd">            (x and y coordinates) for each keystroke of the word being</span>
<span class="sd">            typed.</span>
<span class="sd">        partial_word (str): Partial word being typed (corresponding to the</span>
<span class="sd">            keystrokes).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of completion candidates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">partial_word</span><span class="p">)</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.correctors.EmulatorCorrector.predict_next_word" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict_next_word</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Implementation of <code>predict_next_word</code> method for emulated keyboards.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representing the previously typed characters
(the beginning of the sentence basically).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of next-word candidates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/correctors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict_next_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of `predict_next_word` method for emulated keyboards.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (str): String representing the previously typed characters</span>
<span class="sd">            (the beginning of the sentence basically).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of next-word candidates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># In order to get the predictions, the space should be typed</span>
    <span class="k">assert</span> <span class="n">context</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cached_type</span><span class="p">(</span><span class="n">context</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emulator</span><span class="o">.</span><span class="n">get_predictions</span><span class="p">()</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="emulatorpy"><code>emulator.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module containing the code necessary to interact with the emulators, using
Appium.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.Emulator" class="doc doc-heading">
            <code>Emulator</code>


</h3>


    <div class="doc doc-contents ">


      <p>Class used to interact with an emulator and type word on a given keyboard.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>platform</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>android</code> or <code>ios</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>keyboard</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the keyboard installed on the emulator.
This is needed because each keyboard has a different layout, and we
need to know each key's position in order to type words.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device UDID to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>host</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Appium server's address.</p>
              </div>
            </td>
            <td>
                  <code>&#39;127.0.0.1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>port</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Appium server's port.</p>
              </div>
            </td>
            <td>
                  <code>&#39;4723&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error raised if the given platform doesn't exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Emulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class used to interact with an emulator and type word on a given keyboard.</span>

<span class="sd">    Args:</span>
<span class="sd">        platform (str): `android` or `ios`.</span>
<span class="sd">        keyboard (str): The name of the keyboard installed on the emulator.</span>
<span class="sd">            This is needed because each keyboard has a different layout, and we</span>
<span class="sd">            need to know each key&#39;s position in order to type words.</span>
<span class="sd">        device (str, optional): Device UDID to use.</span>
<span class="sd">        host (str, optional): Appium server&#39;s address.</span>
<span class="sd">        port (str, optional): Appium server&#39;s port.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Error raised if the given platform doesn&#39;t exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keyboard</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4723&quot;</span><span class="p">,</span>
        <span class="n">ios_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ios_platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ANDROID</span><span class="p">,</span> <span class="n">IOS</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown platform : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="si">}</span><span class="s2">. Please specify `</span><span class="si">{</span><span class="n">ANDROID</span><span class="si">}</span><span class="s2">` or `</span><span class="si">{</span><span class="n">IOS</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">)</span>

        <span class="c1"># Start appium</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="n">ANDROID_CAPABILITIES</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">ANDROID</span> <span class="k">else</span> <span class="n">IOS_CAPABILITIES</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">IOS</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;deviceName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ios_name</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;platformVersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ios_platform</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;wdaLocalPort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span> <span class="o">+</span> <span class="p">(</span><span class="n">device</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">ANDROID</span> <span class="ow">and</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;udid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">=</span> <span class="n">keyboard</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Access a typing field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_typing_field</span><span class="p">()</span>

        <span class="c1"># Keep track of the keyboard behavior</span>
        <span class="c1"># When the typing field is empty, the keyboard is uppercase by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set the keyboard as default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">ANDROID</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_keyboard</span><span class="p">(</span><span class="n">keyboard</span><span class="p">)</span>

        <span class="c1"># Get the right layout</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">GBOARD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">GboardLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">TAPPA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">TappaLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">FLEKSY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">FleksyLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">IOS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">IosLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">KBKITPRO</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">KbkitproLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">KBKITOSS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">KbkitossLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">SWIFTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">SwiftkeyLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">YANDEX</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="n">YandexLayoutDetector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">layout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown keyboard : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="si">}</span><span class="s2">. Please specify `</span><span class="si">{</span><span class="n">GBOARD</span><span class="si">}</span><span class="s2">`, `</span><span class="si">{</span><span class="n">TAPPA</span><span class="si">}</span><span class="s2">`, `</span><span class="si">{</span><span class="n">FLEKSY</span><span class="si">}</span><span class="s2">`, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">SWIFTKEY</span><span class="si">}</span><span class="s2">`, `</span><span class="si">{</span><span class="n">YANDEX</span><span class="si">}</span><span class="s2">`, `</span><span class="si">{</span><span class="n">KBKITPRO</span><span class="si">}</span><span class="s2">`, `</span><span class="si">{</span><span class="n">KBKITOSS</span><span class="si">}</span><span class="s2">` or `</span><span class="si">{</span><span class="n">IOS</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_access_typing_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the right application and access the typing field where we</span>
<span class="sd">        will type our text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">ANDROID</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;android.intent.action.VIEW&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">BROWSER_PAD_URL</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">typing_field_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">typing_field_loaded</span><span class="p">:</span>
                <span class="n">typing_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">ANDROID_TYPING_FIELD_CLASS_NAME</span><span class="p">)</span>
                <span class="n">typing_field_loaded</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">typing_fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span> <span class="o">=</span> <span class="n">typing_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">IOS_START_CHAT_CLASS_NAME</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">IOS_TYPING_FIELD_ID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_android_devices</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Static method that uses the `adb devices` command to retrieve the</span>
<span class="sd">        list of devices running.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected device UDID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;List of devices attached&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">devices</span>

    <span class="k">def</span> <span class="nf">select_keyboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyboard</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Searches the IME of the desired keyboard and selects it, only for Android.</span>

<span class="sd">        Args:</span>
<span class="sd">            keyboard (str): Keyboard to search.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">keyboard</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">KEYBOARD_PACKAGE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Warning ! </span><span class="si">{</span><span class="n">keyboard</span><span class="si">}</span><span class="s2">&#39;s IME isn&#39;t provided (in `KEYBOARD_PACKAGE`), can&#39;t automatically select the &quot;</span>
                <span class="s2">&quot;keyboard.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">ime_list</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">],</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ime_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">ime</span> <span class="ow">in</span> <span class="n">ime_list</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">keyboard</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ime</span><span class="p">:</span>
                <span class="n">ime_name</span> <span class="o">=</span> <span class="n">ime</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">ime_name</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;secure&quot;</span><span class="p">,</span> <span class="s2">&quot;show_ime_with_hard_keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="n">ime_name</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">ime_name</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ios_devices</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Static method that uses the `xcrun simctl` command to retrieve the</span>
<span class="sd">        list of booted devices.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of booted device platform and device name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;xcrun&quot;</span><span class="p">,</span> <span class="s2">&quot;simctl&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">curr_platform</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;== &quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; ==&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-- &quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; --&quot;</span><span class="p">):</span>
                <span class="n">curr_platform</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+([^\t]+)\s+\([A-Z0-9\-]+\)\s+\((Booted|Shutdown)\)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">device_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Booted&quot;</span> <span class="ow">and</span> <span class="n">curr_platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iOS &quot;</span><span class="p">):</span>
                        <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_platform</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">device_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">devices</span>

    <span class="k">def</span> <span class="nf">_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Paste the given text into the typing field, to quickly simulate</span>
<span class="sd">        typing a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text to paste.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Note : on Android, pasting content in the field will erase the previous content</span>
            <span class="c1"># (which is what we want). On iOS it will not, we need to do it &quot;manually&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="n">IOS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">KBKITPRO</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">KBKITOSS</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">FLEKSY</span><span class="p">:</span>
                <span class="c1"># In the case of KeyboardKit / Fleksy, after pasting the content, typing a space</span>
                <span class="c1"># trigger a punctuation (because previous context may end with a space)</span>
                <span class="c1"># To avoid this behavior, break the cycle by typing a backspace</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;backspace&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_eos</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_eos</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Paste the given text into the typing field, to quickly simulate</span>
<span class="sd">        typing a context.</span>

<span class="sd">        This method is just a wrapper around `_paste()`, making sure the typing</span>
<span class="sd">        field is accessible. If for some reason it is not accessible, it tries</span>
<span class="sd">        to access it and perform the action again.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text to paste.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">StaleElementReferenceException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_access_typing_field</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">type_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characters</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># noqa: C901</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Type the given sentence on the keyboard. For each character, it</span>
<span class="sd">        finds the keys to press and send a tap on the keyboard.</span>

<span class="sd">        Args:</span>
<span class="sd">            characters (str): The sentence to type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span><span class="p">:</span>
                    <span class="c1"># If the previous character was a space, don&#39;t retype a space</span>
                    <span class="c1"># because it can be transformed into a `.`</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;spacebar&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;spacebar&quot;</span><span class="p">])</span>

                <span class="c1"># Behavior of the keyboard : if the previous character typed was an EOS marker</span>
                <span class="c1"># and a space is typed, the keyboard automatically switch to uppercase</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">]:</span>
                <span class="c1"># The character is a lowercase character</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                    <span class="c1"># If the keyboard is in uppercase mode, change it to lowercase</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">SWIFTKEY</span><span class="p">:</span>
                        <span class="c1"># Swiftkey needs double tap, otherwise we are capslocking</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">]:</span>
                <span class="c1"># The character is an uppercase character</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                    <span class="c1"># Change the keyboard to uppercase</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                <span class="c1"># After typing one character, the keyboard automatically come back to lowercase</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">]:</span>
                <span class="c1"># The character is a number of a special character</span>
                <span class="c1"># Access the number keyboard properly</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GBOARD</span><span class="p">,</span> <span class="n">SWIFTKEY</span><span class="p">]:</span>
                    <span class="c1"># For some reason, when `&#39;` is typed, the keyboard automatically goes back</span>
                    <span class="c1"># to lowercase, so no need to re-tap the button (unless the keyboard is GBoard / Swiftkey).</span>
                    <span class="c1"># In all other cases, switch back to letters keyboard</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">][</span><span class="s2">&quot;letters&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Can&#39;t type this character, ignore it</span>
                <span class="k">continue</span>

            <span class="c1"># Behavior of the keyboard : if the previous character typed was an EOS marker</span>
            <span class="c1"># and a space is typed, the keyboard automatically switch to uppercase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>

            <span class="c1"># Update infos about what we typed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_eos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span> <span class="o">=</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>

    <span class="k">def</span> <span class="nf">_is_eos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the given character is an End-Of-Sentence marker. If an EOS</span>
<span class="sd">        marker is typed followed by a space, the keyboard automatically switch</span>
<span class="sd">        to uppercase letters (unless it&#39;s GBoard).</span>

<span class="sd">        Args:</span>
<span class="sd">            c (str): Character to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the character is an EOS marker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">GBOARD</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_tap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keyboard_frame</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tap on the screen at the position described by the given frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            frame (List[int]): Frame describing the position where to tap. A</span>
<span class="sd">                frame is : [start_pos_x, start_pos_y, width, height].</span>
<span class="sd">            keyboard_frame (List[int]): If specified, the Keyboard frame to</span>
<span class="sd">                use. If `None`, it will use `self.layout[&quot;keyboard_frame&quot;]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="n">base_x</span><span class="p">,</span> <span class="n">base_y</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">keyboard_frame</span> <span class="k">if</span> <span class="n">keyboard_frame</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">]</span>

        <span class="n">pos_x</span> <span class="o">=</span> <span class="n">base_x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pos_y</span> <span class="o">=</span> <span class="n">base_y</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">w3c_actions</span> <span class="o">=</span> <span class="n">ActionBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">mouse</span><span class="o">=</span><span class="n">PointerInput</span><span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">POINTER_TOUCH</span><span class="p">,</span> <span class="s2">&quot;touch&quot;</span><span class="p">))</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">w3c_actions</span><span class="o">.</span><span class="n">pointer_action</span><span class="o">.</span><span class="n">move_to_location</span><span class="p">(</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">)</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">w3c_actions</span><span class="o">.</span><span class="n">pointer_action</span><span class="o">.</span><span class="n">pointer_down</span><span class="p">()</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">w3c_actions</span><span class="o">.</span><span class="n">pointer_action</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">w3c_actions</span><span class="o">.</span><span class="n">pointer_action</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_take_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a screenshot of the full screen.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The image of the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">screen_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screen_data</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">screen</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the predictions displayed by the keyboard.</span>

<span class="sd">        Args:</span>
<span class="sd">            lang (str): Language to use for the OCR.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of predictions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;detected&quot;</span><span class="p">):</span>
            <span class="c1"># Only keyboards that were auto-detected (using XML tree) have the</span>
            <span class="c1"># attribute `detected`. If that&#39;s the case, it means we</span>
            <span class="c1"># can retrieve the suggestions directly from the XML tree !</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">get_suggestions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Other keyboards still have to use (slow) OCR</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">PREDICTION_DELAY</span><span class="p">)</span>
            <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

            <span class="n">kb_x</span><span class="p">,</span> <span class="n">kb_y</span><span class="p">,</span> <span class="n">kb_w</span><span class="p">,</span> <span class="n">kb_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">]</span>
            <span class="n">screen</span> <span class="o">=</span> <span class="n">screen</span><span class="p">[</span><span class="n">kb_y</span> <span class="p">:</span> <span class="n">kb_y</span> <span class="o">+</span> <span class="n">kb_h</span><span class="p">,</span> <span class="n">kb_x</span> <span class="p">:</span> <span class="n">kb_x</span> <span class="o">+</span> <span class="n">kb_w</span><span class="p">]</span>

            <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;suggestions_frames&quot;</span><span class="p">]:</span>
                <span class="n">suggestion_area</span> <span class="o">=</span> <span class="n">screen</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span>
                <span class="n">ocr_results</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">suggestion_area</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">TESSERACT_CONFIG</span><span class="p">)</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">_get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the text currently contained in the typing field.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text of the typing field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">typing_field</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the text currently contained in the typing field.</span>

<span class="sd">        This method is just a wrapper around `_get_text()`, making sure the</span>
<span class="sd">        typing field is accessible. If for some reason it is not accessible, it</span>
<span class="sd">        tries to access it and perform the action again.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Text of the typing field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">StaleElementReferenceException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_access_typing_field</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_keyboards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a screenshot and overlay the given layout, for debugging the</span>
<span class="sd">        position of each keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Type a character, in order to have some suggestions</span>
        <span class="c1"># Keyboard starts with uppercase letter by default (unless GBoard), and</span>
        <span class="c1"># automatically go to lowercase after</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">GBOARD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;a&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">])</span>
        <span class="n">screen_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
        <span class="n">screen_upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
        <span class="n">screen_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">screen</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">,</span> <span class="s2">&quot;uppercase&quot;</span><span class="p">,</span> <span class="s2">&quot;numbers&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">screen_lower</span><span class="p">,</span> <span class="n">screen_upper</span><span class="p">,</span> <span class="n">screen_numbers</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="s2">&quot;keyboard frame&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;suggestions_frames&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">suggestion_frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;suggestions_frames&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">suggestion_frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;suggestion </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">key_frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">layout_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">key_frame</span><span class="p">,</span> <span class="n">key_name</span><span class="p">)</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">layout_name</span><span class="p">,</span> <span class="n">screen</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_area_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">base_coords</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">coords</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an area box on the given image (color is random).</span>

<span class="sd">        Args:</span>
<span class="sd">            image: Image where to add the box.</span>
<span class="sd">            base_coords (Tuple[int]): Base coordinates from the full image.</span>
<span class="sd">            coords (Tuple[int]): Coordinates of the element, as well as</span>
<span class="sd">                dimensions.</span>
<span class="sd">            tag (str): Tag for this box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_x</span><span class="p">,</span> <span class="n">base_y</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">base_coords</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">base_x</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">base_y</span>
        <span class="c1"># Generate color only until 200, to ensure it&#39;s dark enough</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">17</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.get_android_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_android_devices</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Static method that uses the <code>adb devices</code> command to retrieve the
list of devices running.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of detected device UDID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_android_devices</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Static method that uses the `adb devices` command to retrieve the</span>
<span class="sd">    list of devices running.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of detected device UDID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;List of devices attached&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.select_keyboard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_keyboard</span><span class="p">(</span><span class="n">keyboard</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Searches the IME of the desired keyboard and selects it, only for Android.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>keyboard</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyboard to search.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_keyboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyboard</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches the IME of the desired keyboard and selects it, only for Android.</span>

<span class="sd">    Args:</span>
<span class="sd">        keyboard (str): Keyboard to search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keyboard</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">KEYBOARD_PACKAGE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Warning ! </span><span class="si">{</span><span class="n">keyboard</span><span class="si">}</span><span class="s2">&#39;s IME isn&#39;t provided (in `KEYBOARD_PACKAGE`), can&#39;t automatically select the &quot;</span>
            <span class="s2">&quot;keyboard.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">ime_list</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">],</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ime_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">ime</span> <span class="ow">in</span> <span class="n">ime_list</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">keyboard</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ime</span><span class="p">:</span>
            <span class="n">ime_name</span> <span class="o">=</span> <span class="n">ime</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">ime_name</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;secure&quot;</span><span class="p">,</span> <span class="s2">&quot;show_ime_with_hard_keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">],</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="n">ime_name</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;adb&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="s2">&quot;ime&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">ime_name</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.get_ios_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ios_devices</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Static method that uses the <code>xcrun simctl</code> command to retrieve the
list of booted devices.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of booted device platform and device name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_ios_devices</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Static method that uses the `xcrun simctl` command to retrieve the</span>
<span class="sd">    list of booted devices.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of booted device platform and device name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;xcrun&quot;</span><span class="p">,</span> <span class="s2">&quot;simctl&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">curr_platform</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;== &quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; ==&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-- &quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; --&quot;</span><span class="p">):</span>
            <span class="n">curr_platform</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+([^\t]+)\s+\([A-Z0-9\-]+\)\s+\((Booted|Shutdown)\)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">device_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Booted&quot;</span> <span class="ow">and</span> <span class="n">curr_platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iOS &quot;</span><span class="p">):</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_platform</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">device_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.paste" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">paste</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Paste the given text into the typing field, to quickly simulate
typing a context.</p>
<p>This method is just a wrapper around <code>_paste()</code>, making sure the typing
field is accessible. If for some reason it is not accessible, it tries
to access it and perform the action again.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to paste.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Paste the given text into the typing field, to quickly simulate</span>
<span class="sd">    typing a context.</span>

<span class="sd">    This method is just a wrapper around `_paste()`, making sure the typing</span>
<span class="sd">    field is accessible. If for some reason it is not accessible, it tries</span>
<span class="sd">    to access it and perform the action again.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Text to paste.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">StaleElementReferenceException</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_typing_field</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.type_characters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">type_characters</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Type the given sentence on the keyboard. For each character, it
finds the keys to press and send a tap on the keyboard.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>characters</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sentence to type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">type_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characters</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># noqa: C901</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type the given sentence on the keyboard. For each character, it</span>
<span class="sd">    finds the keys to press and send a tap on the keyboard.</span>

<span class="sd">    Args:</span>
<span class="sd">        characters (str): The sentence to type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span><span class="p">:</span>
                <span class="c1"># If the previous character was a space, don&#39;t retype a space</span>
                <span class="c1"># because it can be transformed into a `.`</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;spacebar&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;spacebar&quot;</span><span class="p">])</span>

            <span class="c1"># Behavior of the keyboard : if the previous character typed was an EOS marker</span>
            <span class="c1"># and a space is typed, the keyboard automatically switch to uppercase</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">]:</span>
            <span class="c1"># The character is a lowercase character</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                <span class="c1"># If the keyboard is in uppercase mode, change it to lowercase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">SWIFTKEY</span><span class="p">:</span>
                    <span class="c1"># Swiftkey needs double tap, otherwise we are capslocking</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">]:</span>
            <span class="c1"># The character is an uppercase character</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                <span class="c1"># Change the keyboard to uppercase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
            <span class="c1"># After typing one character, the keyboard automatically come back to lowercase</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">]:</span>
            <span class="c1"># The character is a number of a special character</span>
            <span class="c1"># Access the number keyboard properly</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GBOARD</span><span class="p">,</span> <span class="n">SWIFTKEY</span><span class="p">]:</span>
                <span class="c1"># For some reason, when `&#39;` is typed, the keyboard automatically goes back</span>
                <span class="c1"># to lowercase, so no need to re-tap the button (unless the keyboard is GBoard / Swiftkey).</span>
                <span class="c1"># In all other cases, switch back to letters keyboard</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">][</span><span class="s2">&quot;letters&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Can&#39;t type this character, ignore it</span>
            <span class="k">continue</span>

        <span class="c1"># Behavior of the keyboard : if the previous character typed was an EOS marker</span>
        <span class="c1"># and a space is typed, the keyboard automatically switch to uppercase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kb_is_upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>

        <span class="c1"># Update infos about what we typed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_eos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_eos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_char_is_space</span> <span class="o">=</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.get_predictions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_predictions</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Retrieve the predictions displayed by the keyboard.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language to use for the OCR.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of predictions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the predictions displayed by the keyboard.</span>

<span class="sd">    Args:</span>
<span class="sd">        lang (str): Language to use for the OCR.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of predictions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;detected&quot;</span><span class="p">):</span>
        <span class="c1"># Only keyboards that were auto-detected (using XML tree) have the</span>
        <span class="c1"># attribute `detected`. If that&#39;s the case, it means we</span>
        <span class="c1"># can retrieve the suggestions directly from the XML tree !</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected</span><span class="o">.</span><span class="n">get_suggestions</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Other keyboards still have to use (slow) OCR</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">PREDICTION_DELAY</span><span class="p">)</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

        <span class="n">kb_x</span><span class="p">,</span> <span class="n">kb_y</span><span class="p">,</span> <span class="n">kb_w</span><span class="p">,</span> <span class="n">kb_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">]</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">screen</span><span class="p">[</span><span class="n">kb_y</span> <span class="p">:</span> <span class="n">kb_y</span> <span class="o">+</span> <span class="n">kb_h</span><span class="p">,</span> <span class="n">kb_x</span> <span class="p">:</span> <span class="n">kb_x</span> <span class="o">+</span> <span class="n">kb_w</span><span class="p">]</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;suggestions_frames&quot;</span><span class="p">]:</span>
            <span class="n">suggestion_area</span> <span class="o">=</span> <span class="n">screen</span><span class="p">[</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span>
            <span class="n">ocr_results</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">suggestion_area</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">TESSERACT_CONFIG</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.get_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Return the text currently contained in the typing field.</p>
<p>This method is just a wrapper around <code>_get_text()</code>, making sure the
typing field is accessible. If for some reason it is not accessible, it
tries to access it and perform the action again.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text of the typing field.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the text currently contained in the typing field.</span>

<span class="sd">    This method is just a wrapper around `_get_text()`, making sure the</span>
<span class="sd">    typing field is accessible. If for some reason it is not accessible, it</span>
<span class="sd">    tries to access it and perform the action again.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Text of the typing field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">StaleElementReferenceException</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_typing_field</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.Emulator.show_keyboards" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_keyboards</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Take a screenshot and overlay the given layout, for debugging the
position of each keys.</p>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_keyboards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take a screenshot and overlay the given layout, for debugging the</span>
<span class="sd">    position of each keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Type a character, in order to have some suggestions</span>
    <span class="c1"># Keyboard starts with uppercase letter by default (unless GBoard), and</span>
    <span class="c1"># automatically go to lowercase after</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">==</span> <span class="n">GBOARD</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;a&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">])</span>
    <span class="n">screen_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
    <span class="n">screen_upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_tap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">])</span>
    <span class="n">screen_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take_screenshot</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">screen</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">,</span> <span class="s2">&quot;uppercase&quot;</span><span class="p">,</span> <span class="s2">&quot;numbers&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">screen_lower</span><span class="p">,</span> <span class="n">screen_upper</span><span class="p">,</span> <span class="n">screen_numbers</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="s2">&quot;keyboard frame&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;suggestions_frames&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">suggestion_frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;suggestions_frames&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">suggestion_frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;suggestion </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">key_frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">layout_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_area_box</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">key_frame</span><span class="p">,</span> <span class="n">key_name</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">layout_name</span><span class="p">,</span> <span class="n">screen</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.LayoutDetector" class="doc doc-heading">
            <code>LayoutDetector</code>


</h3>


    <div class="doc doc-contents ">


      <p>Base class for auto-detection of the keyboard layout.</p>
<p>To auto-detect a new keyboard, create a new sub-class, and overwite
<code>__init__()</code> and <code>get_suggestions()</code>. Use the existing subclass for GBoard
as reference.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>driver</code></td>
            <td>
                  <code><span title="appium.webdriver.Remote">Remote</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Appium driver, used to access elements
on the emulator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tap_fn</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callback used to tap at specific position on the
screen. See <code>Emulator._tap()</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>xpath_root</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>XPath to the root element of the keyboard.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>xpath_keys</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>XPath to detect the keys elements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LayoutDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for auto-detection of the keyboard layout.</span>

<span class="sd">    To auto-detect a new keyboard, create a new sub-class, and overwite</span>
<span class="sd">    `__init__()` and `get_suggestions()`. Use the existing subclass for GBoard</span>
<span class="sd">    as reference.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (webdriver.Remote): The Appium driver, used to access elements</span>
<span class="sd">            on the emulator.</span>
<span class="sd">        tap_fn (Callable): A callback used to tap at specific position on the</span>
<span class="sd">            screen. See `Emulator._tap()`.</span>
<span class="sd">        xpath_root (str): XPath to the root element of the keyboard.</span>
<span class="sd">        xpath_keys (str): XPath to detect the keys elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">,</span> <span class="n">tap_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">xpath_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">xpath_keys</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">android</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">=</span> <span class="n">tap_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xpath_root</span> <span class="o">=</span> <span class="n">xpath_root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xpath_keys</span> <span class="o">=</span> <span class="n">xpath_keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">android</span> <span class="o">=</span> <span class="n">android</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get the root element of our keyboard</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpath_root</span><span class="p">)</span>

        <span class="c1"># On empty field, the keyboard is on uppercase</span>
        <span class="c1"># So first, retrieve the keyboard frame and uppercase characters</span>
        <span class="n">kb_frame</span><span class="p">,</span> <span class="n">screen_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_keys</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current_layout</span><span class="o">=</span><span class="s2">&quot;uppercase&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kb_frame</span>
        <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">screen_layout</span>

        <span class="c1"># Then, after typing a letter, the keyboard goes to lowercase automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;uppercase&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">])</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">screen_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_keys</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">keyboard_frame</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">current_layout</span><span class="o">=</span><span class="s2">&quot;lowercase&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">screen_layout</span>

        <span class="c1"># Finally, access the symbols keyboard and get characters positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">][</span><span class="s2">&quot;numbers&quot;</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">])</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">screen_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_keys</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">keyboard_frame</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">],</span> <span class="n">current_layout</span><span class="o">=</span><span class="s2">&quot;numbers&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">screen_layout</span>

        <span class="c1"># Reset out keyboard to the original layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">][</span><span class="s2">&quot;letters&quot;</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Note that it&#39;s slower to access the XML through methods like</span>
<span class="sd">        `find_element()`, and it&#39;s faster to access the raw XML with</span>
<span class="sd">        `self.driver.page_source` and parse it as text directly.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Exception raised if this method is not</span>
<span class="sd">                overwritten.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_detect_keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">WebElement</span><span class="p">,</span> <span class="n">current_layout</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keyboard_frame</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method detects all keys currently on screen.</span>

<span class="sd">        If no keyboard_frame is given, it will also detects the keyboard frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            root (WebElement): Root element in the XML tree that represents the</span>
<span class="sd">                keyboard (with all its keys).</span>
<span class="sd">            current_layout (str): Name of the current layout.</span>
<span class="sd">            keyboard_frame (List[int], optional): Optionally, the keyboard</span>
<span class="sd">                frame (so we don&#39;t need to re-detect it everytime).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Keyboard frame</span>
<span class="sd">            Layout with all the keys detected on this screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">keyboard_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">android</span><span class="p">:</span>
                <span class="c1"># Detect the keyboard frame</span>
                <span class="n">kb</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;android:id/inputArea&quot;</span><span class="p">)</span>
                <span class="n">keyboard_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keyboard_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key_elem</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpath_keys</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label</span><span class="p">(</span><span class="n">key_elem</span><span class="p">,</span> <span class="n">current_layout</span><span class="o">=</span><span class="n">current_layout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layout</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame</span><span class="p">(</span><span class="n">key_elem</span><span class="p">)</span>

        <span class="c1"># Then update the letters positions to be relative to the keyboard frame</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">layout</span><span class="p">:</span>
            <span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">keyboard_frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">keyboard_frame</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">keyboard_frame</span><span class="p">,</span> <span class="n">layout</span>

    <span class="k">def</span> <span class="nf">_get_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">WebElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For layout detection, this method returns the bounds of the given</span>
<span class="sd">        element.</span>

<span class="sd">        Args:</span>
<span class="sd">            element (WebElement): XML Element describing a key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Bounds of this key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">android</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(\d+),(\d+)\]\[(\d+),(\d+)\]&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">WebElement</span><span class="p">,</span> <span class="n">current_layout</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_suggestion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For layout detection, this method returns the content of the given</span>
<span class="sd">        element.</span>

<span class="sd">        This method returns `None` if it&#39;s a key we don&#39;t care about. This</span>
<span class="sd">        method takes care of translating the content (the name used in the XML</span>
<span class="sd">        tree is not the same as the one used in our layout).</span>

<span class="sd">        Args:</span>
<span class="sd">            element (WebElement): XML Element describing a key.</span>
<span class="sd">            current_layout (str): Name of the current layout.</span>
<span class="sd">            is_suggestion (bool, optional): If we are retrieving the content of</span>
<span class="sd">                a suggestion, the content shouldn&#39;t be translated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Content of the key, or None if it&#39;s a key we should ignore.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;content-desc&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">android</span> <span class="k">else</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_suggestion</span><span class="p">:</span>
            <span class="c1"># If we are getting the content of the suggestion, return the content directly</span>
            <span class="k">return</span> <span class="n">content</span>

        <span class="k">if</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">CONTENT_TO_IGNORE</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">android</span> <span class="ow">and</span> <span class="n">content</span> <span class="o">==</span> <span class="s2">&quot;more&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_layout</span> <span class="o">==</span> <span class="s2">&quot;uppercase&quot;</span> <span class="ow">or</span> <span class="n">current_layout</span> <span class="o">==</span> <span class="s2">&quot;lowercase&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;numbers&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;letters&quot;</span>
        <span class="k">elif</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">CONTENT_TO_RENAME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CONTENT_TO_RENAME</span><span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.LayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>
<p>Note that it's slower to access the XML through methods like
<code>find_element()</code>, and it's faster to access the raw XML with
<code>self.driver.page_source</code> and parse it as text directly.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception raised if this method is not
overwritten.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Note that it&#39;s slower to access the XML through methods like</span>
<span class="sd">    `find_element()`, and it&#39;s faster to access the raw XML with</span>
<span class="sd">    `self.driver.page_source` and parse it as text directly.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: Exception raised if this method is not</span>
<span class="sd">            overwritten.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.GboardLayoutDetector" class="doc doc-heading">
            <code>GboardLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the Gboard keyboard. See <code>LayoutDetector</code> for more
information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GboardLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the Gboard keyboard. See `LayoutDetector` for more</span>
<span class="sd">    information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;./*/*[@package=&#39;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">GBOARD</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//*[@resource-id][@content-desc]&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">data</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.widget.FrameLayout&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;com.google.android.inputmethod&quot;</span> <span class="ow">in</span> <span class="n">data</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;content-desc&quot;</span> <span class="ow">in</span> <span class="n">section</span> <span class="ow">and</span> <span class="s2">&quot;resource-id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">section</span> <span class="ow">and</span> <span class="s1">&#39;long-clickable=&quot;true&quot;&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content\-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="c1"># Deal with emojis</span>
                    <span class="n">emoji</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;emoji (&amp;[^;]+;)&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">emoji</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">emoji</span> <span class="k">else</span> <span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.GboardLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">data</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.widget.FrameLayout&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;com.google.android.inputmethod&quot;</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;content-desc&quot;</span> <span class="ow">in</span> <span class="n">section</span> <span class="ow">and</span> <span class="s2">&quot;resource-id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">section</span> <span class="ow">and</span> <span class="s1">&#39;long-clickable=&quot;true&quot;&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content\-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Deal with emojis</span>
                <span class="n">emoji</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;emoji (&amp;[^;]+;)&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">emoji</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">emoji</span> <span class="k">else</span> <span class="n">content</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.IosLayoutDetector" class="doc doc-heading">
            <code>IosLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the iOS default keyboard. See <code>LayoutDetector</code> for
more information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IosLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the iOS default keyboard. See `LayoutDetector` for</span>
<span class="sd">    more information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="s2">&quot;.//XCUIElementTypeKeyboard&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;(.//XCUIElementTypeKey|.//XCUIElementTypeButton)&quot;</span><span class="p">,</span>
            <span class="n">android</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;name=&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">is_typing_predictions_section</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Typing Predictions&quot;</span><span class="p">:</span>
                    <span class="n">is_typing_predictions_section</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">is_typing_predictions_section</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.IosLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;name=&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">is_typing_predictions_section</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Typing Predictions&quot;</span><span class="p">:</span>
                <span class="n">is_typing_predictions_section</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">is_typing_predictions_section</span><span class="p">:</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.KbkitproLayoutDetector" class="doc doc-heading">
            <code>KbkitproLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the KeyboardKit Pro demo keyboard. See
<code>LayoutDetector</code> for more information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KbkitproLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the KeyboardKit Pro demo keyboard. See</span>
<span class="sd">    `LayoutDetector` for more information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="s2">&quot;.//XCUIElementTypeOther[XCUIElementTypeButton and XCUIElementTypeTextField]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//XCUIElementTypeButton&quot;</span><span class="p">,</span>
            <span class="n">android</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">pred_part</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeButton&quot;</span> <span class="ow">in</span> <span class="n">pred_part</span> <span class="ow">and</span> <span class="s1">&#39;name=&quot;Add&quot;&#39;</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.KbkitproLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">pred_part</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeButton&quot;</span> <span class="ow">in</span> <span class="n">pred_part</span> <span class="ow">and</span> <span class="s1">&#39;name=&quot;Add&quot;&#39;</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="s2">&quot;&lt;XCUIElementTypeTextField&quot;</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.KbkitossLayoutDetector" class="doc doc-heading">
            <code>KbkitossLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the KeyboardKit OSS demo keyboard. See
<code>LayoutDetector</code> for more information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KbkitossLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the KeyboardKit OSS demo keyboard. See</span>
<span class="sd">    `LayoutDetector` for more information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="s2">&quot;.//XCUIElementTypeOther[XCUIElementTypeButton and XCUIElementTypeStaticText]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//XCUIElementTypeButton&quot;</span><span class="p">,</span>
            <span class="n">android</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;, Subtitle&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">pred_part</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, Subtitle&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">?&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.KbkitossLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;XCUIElementTypeOther&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;, Subtitle&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">pred_part</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, Subtitle&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">pred_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">?&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.SwiftkeyLayoutDetector" class="doc doc-heading">
            <code>SwiftkeyLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the Swiftkey keyboard. See <code>LayoutDetector</code> for more
information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SwiftkeyLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the Swiftkey keyboard. See `LayoutDetector` for more</span>
<span class="sd">    information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;./*/*[@package=&#39;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">SWIFTKEY</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//*[@class=&#39;android.view.View&#39;][@content-desc]&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the raw content as text, weed out useless elements</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.widget.FrameLayout&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;com.touchtype.swiftkey&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s2">&quot;&lt;android.view.View &quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">sections</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.view.View &quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.SwiftkeyLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get the raw content as text, weed out useless elements</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.widget.FrameLayout&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;com.touchtype.swiftkey&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s2">&quot;&lt;android.view.View &quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;android.view.View &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.YandexLayoutDetector" class="doc doc-heading">
            <code>YandexLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the Yandex keyboard. See <code>LayoutDetector</code> for more
information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">YandexLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the Yandex keyboard. See `LayoutDetector` for more</span>
<span class="sd">    information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;./*/*[@package=&#39;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">YANDEX</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//*[@class=&#39;ya.d&#39;][@content-desc]&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Depending if we are on a real device or on emulator, the</span>
        <span class="c1"># Yandex keyboard uses different XML tags...</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;javaClass&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">:</span>  <span class="c1"># Real device</span>
            <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">YANDEX</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/drawable_suggest_container&quot;</span><span class="p">)[</span>
                <span class="mi">1</span>
            <span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/android.view.View&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;&lt;javaClass&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Emulator</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;android.widget.LinearLayout&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">YANDEX</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/kb_suggest_suggestions_container&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">suggestions_section</span> <span class="o">=</span> <span class="n">s</span>
                    <span class="k">break</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">suggestions_section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;kb_suggest_left_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                    <span class="ow">or</span> <span class="s2">&quot;kb_suggest_center_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                    <span class="ow">or</span> <span class="s2">&quot;kb_suggest_right_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                <span class="p">):</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.YandexLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Depending if we are on a real device or on emulator, the</span>
    <span class="c1"># Yandex keyboard uses different XML tags...</span>
    <span class="k">if</span> <span class="s2">&quot;&lt;javaClass&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">:</span>  <span class="c1"># Real device</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">YANDEX</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/drawable_suggest_container&quot;</span><span class="p">)[</span>
            <span class="mi">1</span>
        <span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/android.view.View&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;&lt;javaClass&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Emulator</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;android.widget.LinearLayout&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">YANDEX</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/kb_suggest_suggestions_container&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">suggestions_section</span> <span class="o">=</span> <span class="n">s</span>
                <span class="k">break</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">suggestions_section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;kb_suggest_left_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                <span class="ow">or</span> <span class="s2">&quot;kb_suggest_center_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                <span class="ow">or</span> <span class="s2">&quot;kb_suggest_right_suggestion&quot;</span> <span class="ow">in</span> <span class="n">line</span>
            <span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;content-desc=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.TappaLayoutDetector" class="doc doc-heading">
            <code>TappaLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the Tappa keyboard. See <code>LayoutDetector</code> for more
information.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TappaLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the Tappa keyboard. See `LayoutDetector` for more</span>
<span class="sd">    information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">xpath_root</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;./*/*[@package=&#39;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">TAPPA</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">,</span>
            <span class="n">xpath_keys</span><span class="o">=</span><span class="s2">&quot;.//com.mocha.keyboard.inputmethod.keyboard.Key&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the raw content as text, weed out useless elements</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">TAPPA</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/suggestions_strip&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="s2">&quot;&lt;/android.widget.LinearLayout&gt;&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;&lt;android.widget.TextView&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;text=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.TappaLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get the raw content as text, weed out useless elements</span>
    <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">KEYBOARD_PACKAGE</span><span class="p">[</span><span class="n">TAPPA</span><span class="p">]</span><span class="si">}</span><span class="s2">:id/suggestions_strip&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
        <span class="s2">&quot;&lt;/android.widget.LinearLayout&gt;&quot;</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;android.widget.TextView&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;text=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.emulator.FleksyLayoutDetector" class="doc doc-heading">
            <code>FleksyLayoutDetector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kebbie.emulator.LayoutDetector" href="#kebbie.emulator.LayoutDetector">LayoutDetector</a></code></p>


      <p>Layout detector for the Fleksy keyboard. See <code>LayoutDetector</code> for more
information.</p>
<p>Note that this class is only semi-automatically detected : the layout
itself is not detected, but the suggestions are retrieved from the XML tree
(no need to rely on OCR, much faster). The layout is hard-coded for now.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/emulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FleksyLayoutDetector</span><span class="p">(</span><span class="n">LayoutDetector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Layout detector for the Fleksy keyboard. See `LayoutDetector` for more</span>
<span class="sd">    information.</span>

<span class="sd">    Note that this class is only semi-automatically detected : the layout</span>
<span class="sd">    itself is not detected, but the suggestions are retrieved from the XML tree</span>
<span class="sd">    (no need to rely on OCR, much faster). The layout is hard-coded for now.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>

        <span class="c1"># Adapt the layout to the screen</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">FLEKSY_LAYOUT</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">FLEKSY_LAYOUT</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">:</span> <span class="n">FLEKSY_LAYOUT</span><span class="p">[</span><span class="s2">&quot;keyboard_frame&quot;</span><span class="p">]}</span>
        <span class="k">for</span> <span class="n">layout_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">,</span> <span class="s2">&quot;uppercase&quot;</span><span class="p">,</span> <span class="s2">&quot;numbers&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">key_frame</span> <span class="ow">in</span> <span class="n">FLEKSY_LAYOUT</span><span class="p">[</span><span class="n">layout_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">layout_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">layout_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">layout_name</span><span class="p">][</span><span class="n">key_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">key_frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">key_frame</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">key_frame</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">key_frame</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">h</span><span class="p">),</span>
                <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of suggestions from the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the raw content as text, weed out useless elements</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">s</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;XCUIElementTypeOther&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;XCUIElementTypeStaticText&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s2">&quot;XCUIElementTypeButton&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.emulator.FleksyLayoutDetector.get_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_suggestions</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the keyboard suggestions from the XML tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of suggestions from the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/emulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the keyboard suggestions from the XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of suggestions from the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get the raw content as text, weed out useless elements</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">s</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;XCUIElementTypeOther&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;XCUIElementTypeStaticText&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s2">&quot;XCUIElementTypeButton&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;name=</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="gesturepy"><code>gesture.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module containing the function <code>make_swipe_gesture</code>, which is used to create
a natural-looking swipe gesture from a list of letter-points.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="kebbie.gesture.make_swipe_gesture" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_swipe_gesture</span><span class="p">(</span><span class="n">control_points</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function to generate artificial swipe gesture from a list of points.
The given points represents the typed letters on the keyboard. This
function simply generate several other points between the control points.
Points are generated using sequential Bezier curves. The resulting swipe
gesture pass by the control points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>control_points</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Control points,
representing the letter typed. The resulting swipe gesture will
pass by these points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points generated by the swipe gesture.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/gesture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_swipe_gesture</span><span class="p">(</span><span class="n">control_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to generate artificial swipe gesture from a list of points.</span>
<span class="sd">    The given points represents the typed letters on the keyboard. This</span>
<span class="sd">    function simply generate several other points between the control points.</span>
<span class="sd">    Points are generated using sequential Bezier curves. The resulting swipe</span>
<span class="sd">    gesture pass by the control points.</span>

<span class="sd">    Args:</span>
<span class="sd">        control_points (List[Tuple[float, float]]): Control points,</span>
<span class="sd">            representing the letter typed. The resulting swipe gesture will</span>
<span class="sd">            pass by these points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Points generated by the swipe gesture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gesture_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">control_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c1"># Pick a &quot;style&quot; (speed &amp; acceleration) and keep it constant across the gesture</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">MIN_N_POINTS_PER_DIST</span><span class="p">,</span> <span class="n">MAX_N_POINTS_PER_DIST</span><span class="p">)</span>
    <span class="n">acceleration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">MIN_ACCELERATION</span><span class="p">,</span> <span class="n">MAX_ACCELERATION</span><span class="p">)</span>

    <span class="c1"># Generate bezier curves between each control points</span>
    <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">control_points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">control_points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="c1"># The distance between the 2 points will dictate the speed and radius</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">euclidian_dist</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">MAX_RADIUS</span><span class="p">)</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">speed</span><span class="p">))</span>

        <span class="n">linspace</span> <span class="o">=</span> <span class="n">accelerated_linspace</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">)</span>

        <span class="c1"># We don&#39;t want the curves to be straight between the control points,</span>
        <span class="c1"># so we generate random points to add curves</span>
        <span class="n">p1_curv</span> <span class="o">=</span> <span class="n">random_point_around</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">p2_curv</span> <span class="o">=</span> <span class="n">random_point_around</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>

        <span class="c1"># Make the bezier curve with the specified number of points</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">bezier_curve</span><span class="p">([</span><span class="n">p2</span><span class="p">,</span> <span class="n">p2_curv</span><span class="p">,</span> <span class="n">p1_curv</span><span class="p">,</span> <span class="n">p1</span><span class="p">],</span> <span class="n">linspace</span><span class="o">=</span><span class="n">linspace</span><span class="p">)</span>
        <span class="n">bezier_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>

        <span class="c1"># Make sure the control point p2 is here</span>
        <span class="k">if</span> <span class="n">bezier_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p2</span><span class="p">:</span>
            <span class="n">bezier_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="c1"># p1 was already added in the previous loop, no need to add it</span>
        <span class="k">if</span> <span class="n">bezier_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p1</span><span class="p">:</span>
            <span class="n">bezier_points</span> <span class="o">=</span> <span class="n">bezier_points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">gesture_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bezier_points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gesture_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.gesture.random_point_around" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">random_point_around</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate a random point around the given point p, within the given
radius.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>p</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates to use as a starting point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>radius</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius within the starting point to generate the random
point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of the generated random point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/gesture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_point_around</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a random point around the given point p, within the given</span>
<span class="sd">    radius.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (Tuple[float, float]): Coordinates to use as a starting point.</span>
<span class="sd">        radius (float): Radius within the starting point to generate the random</span>
<span class="sd">            point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Coordinates of the generated random point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rand_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span><span class="p">)</span>
    <span class="n">rand_y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rand_x</span><span class="p">,</span> <span class="n">rand_y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.gesture.bernstein_poly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bernstein_poly</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>The Bernstein polynomial of n, i as a function of t.</p>
<p>Taken from : https://stackoverflow.com/a/12644499/9494790</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>i</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>i</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>n</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>t</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed value for this polynomial function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/gesture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bernstein_poly</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Bernstein polynomial of n, i as a function of t.</span>

<span class="sd">    Taken from : https://stackoverflow.com/a/12644499/9494790</span>

<span class="sd">    Args:</span>
<span class="sd">        i (int): i</span>
<span class="sd">        n (int): n</span>
<span class="sd">        t (float): t</span>

<span class="sd">    Returns:</span>
<span class="sd">        The computed value for this polynomial function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.gesture.bezier_curve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bezier_curve</span><span class="p">(</span><span class="n">control_points</span><span class="p">,</span> <span class="n">linspace</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Given a set of control points, return the bezier curve defined by the
control points.</p>
<p>See : http://processingjs.nihongoresources.com/bezierinfo/</p>
<p>Taken from : https://stackoverflow.com/a/12644499/9494790</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>control_points</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Control points used to
generate the bezier curve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linspace</code></td>
            <td>
                  <code><span title="typing.List">List</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Linspace to use for sampling points across the
Bezier curve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[float], <span title="typing.List">List</span>[float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sampled points along the bezier curve.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/gesture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bezier_curve</span><span class="p">(</span><span class="n">control_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">linspace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a set of control points, return the bezier curve defined by the</span>
<span class="sd">    control points.</span>

<span class="sd">    See : http://processingjs.nihongoresources.com/bezierinfo/</span>

<span class="sd">    Taken from : https://stackoverflow.com/a/12644499/9494790</span>

<span class="sd">    Args:</span>
<span class="sd">        control_points (List[Tuple[float, float]]): Control points used to</span>
<span class="sd">            generate the bezier curve.</span>
<span class="sd">        linspace (List[float]): Linspace to use for sampling points across the</span>
<span class="sd">            Bezier curve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sampled points along the bezier curve.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_points</span><span class="p">)</span>
    <span class="n">x_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">control_points</span><span class="p">])</span>
    <span class="n">y_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">control_points</span><span class="p">])</span>

    <span class="n">polynomial_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bernstein_poly</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linspace</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)])</span>

    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">polynomial_array</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y_points</span><span class="p">,</span> <span class="n">polynomial_array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">y_vals</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.gesture.accelerated_linspace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">accelerated_linspace</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Alternative to np.linspace, instead of giving a range of number evenly
distributed, this one is not evenly distributed, and simulate an
acceleration at first, and then a deceleration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of points to generate in the linspace.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>acceleration</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number that dictate how constant the
acceleration is. The lower, the more S-shape is used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/gesture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">accelerated_linspace</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative to np.linspace, instead of giving a range of number evenly</span>
<span class="sd">    distributed, this one is not evenly distributed, and simulate an</span>
<span class="sd">    acceleration at first, and then a deceleration.</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of points to generate in the linspace.</span>
<span class="sd">        acceleration (float): A number that dictate how constant the</span>
<span class="sd">            acceleration is. The lower, the more S-shape is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Generated points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">nom</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nom</span> <span class="o">/</span> <span class="n">denom</span>

    <span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">k</span><span class="p">))</span>

    <span class="n">linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">linspace</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">linspace</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">acceleration</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="layoutpy"><code>layout.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module containing the helpers <code>LayoutHelper</code>, useful class to deal with the
layout of a keyboard, access key positions, etc...</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.layout.KeyInfo" class="doc doc-heading">
            <code>KeyInfo</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Structure containing all information needed for a given character (key).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>klayer_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyboard Layer ID where this key is located.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>width</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>center</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center position (x, y coordinates) of the
key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/layout.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">KeyInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structure containing all information needed for a given character (key).</span>

<span class="sd">    Args:</span>
<span class="sd">        klayer_id (int): Keyboard Layer ID where this key is located.</span>
<span class="sd">        width (float): Width of the key.</span>
<span class="sd">        height (float): Height of the key.</span>
<span class="sd">        center (Tuple[float, float]): Center position (x, y coordinates) of the</span>
<span class="sd">            key.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">klayer_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.layout.Key" class="doc doc-heading">
            <code>Key</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Structure containing information needed for each key of a given keyboard
layer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>char</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Character associated with this key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bounds</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary representing the bounding box of
the key. The dictionary should contains the following keys :
<code>right</code>, <code>left</code>, <code>top</code>, <code>bottom</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/layout.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Key</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structure containing information needed for each key of a given keyboard</span>
<span class="sd">    layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        char (str): Character associated with this key.</span>
<span class="sd">        bounds (Dict[str, float]): Dictionary representing the bounding box of</span>
<span class="sd">            the key. The dictionary should contains the following keys :</span>
<span class="sd">            `right`, `left`, `top`, `bottom`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">char</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.layout.LayoutHelper" class="doc doc-heading">
            <code>LayoutHelper</code>


</h3>


    <div class="doc doc-contents ">


      <p>Small class that represents a Keyboard layout. The goal of this class is
to offer some easy-to-use method to deal with a keyboard layout.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language of the layout to load.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en-US&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>custom_keyboard</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, instead of relying on
the keyboard layout provided by default, uses the given keyboard
layout.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ignore_layers_after</code></td>
            <td>
                  <code>Optional[int]) </code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ignore higher layers of the
keyboard layout. If <code>None</code> is given, no layer is ignored.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/layout.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LayoutHelper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Small class that represents a Keyboard layout. The goal of this class is</span>
<span class="sd">    to offer some easy-to-use method to deal with a keyboard layout.</span>

<span class="sd">    Args:</span>
<span class="sd">        lang (str, optional): Language of the layout to load.</span>
<span class="sd">        custom_keyboard (Dict, optional): If provided, instead of relying on</span>
<span class="sd">            the keyboard layout provided by default, uses the given keyboard</span>
<span class="sd">            layout.</span>
<span class="sd">        ignore_layers_after (Optional[int]) : Ignore higher layers of the</span>
<span class="sd">            keyboard layout. If `None` is given, no layer is ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en-US&quot;</span><span class="p">,</span> <span class="n">custom_keyboard</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_layers_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">keyboard</span> <span class="o">=</span> <span class="n">custom_keyboard</span> <span class="k">if</span> <span class="n">custom_keyboard</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">load_keyboard</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayers_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_infos</span><span class="p">(</span><span class="n">keyboard</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">],</span> <span class="n">ignore_layers_after</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">letter_accents</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accents</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[\pL]+$&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spelling_symbols</span> <span class="o">=</span> <span class="n">keyboard</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;allowed_symbols_in_words&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_name</span> <span class="o">=</span> <span class="n">keyboard</span><span class="p">[</span><span class="s2">&quot;keyboard&quot;</span><span class="p">][</span><span class="s2">&quot;default-layout&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_extract_infos</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">keyboard_layout</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">ignore_layers_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KeyInfo</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Key</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method reads the given keyboard layout, and extract useful data</span>
<span class="sd">        structures from this (to be used later by other methods). This</span>
<span class="sd">        basically builds the LayoutHelper class (and should be used only inside</span>
<span class="sd">        the constructor).</span>

<span class="sd">        Note:</span>
<span class="sd">            The given keyboard layout contains 24 layers. Each key appears in</span>
<span class="sd">            one (or several) layer of the keyboard. Accents are associated to</span>
<span class="sd">            the same key as their non-accented version.</span>
<span class="sd">            This class may be used to generate typing noise, so accents should</span>
<span class="sd">            have their own keys (and closer accents should be represented by</span>
<span class="sd">            closer keys). This method takes care of it, by generating &quot;virtual</span>
<span class="sd">            keyboard layers&quot;, for each group of accents. The goal is to</span>
<span class="sd">            generate a virtual keyboard layer that is as close as possible as</span>
<span class="sd">            the actual keyboard, used by real-users.</span>

<span class="sd">        Args:</span>
<span class="sd">            keyboard_layout (Dict): Dictionary representing the keyboard and</span>
<span class="sd">                its layout.</span>
<span class="sd">            ignore_layers_after (Optional[int]) : Ignore higher layers of the</span>
<span class="sd">                keyboard layout. If `None` is given, no layer is ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Key information for each character in the keyboard.</span>
<span class="sd">            Key information for each layer of the keyboard.</span>
<span class="sd">            List of accents used in the keyboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dict char -&gt; key infos (bounds, center, klayer ID)</span>
        <span class="n">klayers_info</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># Dict klayer ID -&gt; list of keys (bounds, char)</span>
        <span class="n">all_accents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># A keyboard layout is made of several &quot;layers&quot;, each identified by a KeyboardID</span>
        <span class="n">last_klayer_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keyboard_layout</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">klayer</span> <span class="ow">in</span> <span class="n">keyboard_layout</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;buttons&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ignore_layers_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ignore_layers_after</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Each layer is a list of button</span>
            <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;buttons&quot;</span><span class="p">]:</span>
                <span class="c1"># Button always have a character, and optionally accents</span>
                <span class="n">char</span><span class="p">,</span> <span class="n">accents</span> <span class="o">=</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

                <span class="c1"># Special characters : space, shift, numbers, magic, etc...</span>
                <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">SPACE</span><span class="p">:</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
                    <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="n">POINT</span><span class="p">:</span>
                        <span class="c1"># Points should be added to our key infos</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Other special characters are ignored</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">char</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Save the character and its key information</span>
                <span class="c1"># Save it only if it&#39;s not already in a previous klayer</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys_info</span> <span class="ow">or</span> <span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">klayer_id</span> <span class="o">&gt;</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span>
                    <span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyInfo</span><span class="p">(</span>
                        <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                        <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">button</span><span class="p">[</span><span class="s2">&quot;centerPoint&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;centerPoint&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="c1"># But always save its info in the klayers info</span>
                <span class="n">klayers_info</span><span class="p">[</span><span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Key</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">]))</span>

                <span class="c1"># Then, save the accents if any</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char_accent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accents</span><span class="p">):</span>
                    <span class="n">all_accents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">char_accent</span><span class="p">)</span>

                    <span class="c1"># Create a virtual position for the accent</span>
                    <span class="n">bounds</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_virtual_key</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">])</span>

                    <span class="c1"># Save the accent (only if not existing) in a new virtual klayer</span>
                    <span class="k">if</span> <span class="n">char_accent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys_info</span><span class="p">:</span>
                        <span class="n">keys_info</span><span class="p">[</span><span class="n">char_accent</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyInfo</span><span class="p">(</span>
                            <span class="n">last_klayer_id</span><span class="p">,</span>
                            <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                            <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                            <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]),</span>
                        <span class="p">)</span>
                    <span class="c1"># But always saveits info in the klayers info</span>
                    <span class="n">klayers_info</span><span class="p">[</span><span class="n">last_klayer_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Key</span><span class="p">(</span><span class="n">char_accent</span><span class="p">,</span> <span class="n">bounds</span><span class="p">))</span>

                <span class="c1"># If we added some accent in a virtual klayer, don&#39;t forget to update the last klayer ID</span>
                <span class="k">if</span> <span class="n">accents</span><span class="p">:</span>
                    <span class="n">last_klayer_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">keys_info</span><span class="p">,</span> <span class="n">klayers_info</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_accents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_virtual_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to create a new boundary for an accented character. Based on</span>
<span class="sd">        the given id, the generated boundary box will be generated at a</span>
<span class="sd">        different position.</span>

<span class="sd">        This method tries to follow a similar pattern as the sample app, with</span>
<span class="sd">        accents appearing in lines of 4 accents.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): The index of the bounding box to generate.</span>
<span class="sd">            initial_bounds (Dict[str, float]): The bounding box of the</span>
<span class="sd">                non-accented key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generated bounding box.</span>
<span class="sd">            Its associated center position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>

        <span class="n">start_x</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="n">N_ACCENT_PER_LINE</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span>
        <span class="n">start_y</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">idx</span> <span class="o">//</span> <span class="n">N_ACCENT_PER_LINE</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="n">start_y</span><span class="p">,</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">start_x</span><span class="p">,</span>
            <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">center</span>

    <span class="k">def</span> <span class="nf">get_key_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to retrieve the information associated to a specific key.</span>

<span class="sd">        Args:</span>
<span class="sd">            char (str): Character for which to retrieve key information.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: Exception raised if the given character can&#39;t be typed (</span>
<span class="sd">                because it doesn&#39;t exist on this keyboard layout).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Width of the key for the requested character.</span>
<span class="sd">            Height of the key for the requested character.</span>
<span class="sd">            Center position (x-axis) of the key for the requested character.</span>
<span class="sd">            Center position (y-axis) of the key for the requested character.</span>
<span class="sd">            Keyboard layer ID where the character&#39;s key is located.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="o">.</span><span class="n">klayer_id</span>

    <span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">klayer_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the character associated with the given position.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (Tuple[float, float]): Position (x, y) in the keyboard.</span>
<span class="sd">            klayer_id (int): Keyboard layer ID to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Character associated to the given position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">klayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayers_info</span><span class="p">[</span><span class="n">klayer_id</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Retrieve the key that contains the sampled position</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">k</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">klayer</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="c1"># Maybe the sampled position was out of bound -&gt; retrieve the closest key</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">klayer</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">euclidian_dist</span><span class="p">(</span>
                    <span class="n">pos</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">char</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.layout.LayoutHelper._extract_infos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_infos</span><span class="p">(</span><span class="n">keyboard_layout</span><span class="p">,</span> <span class="n">ignore_layers_after</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>This method reads the given keyboard layout, and extract useful data
structures from this (to be used later by other methods). This
basically builds the LayoutHelper class (and should be used only inside
the constructor).</p>


<details class="note" open>
  <summary>Note</summary>
  <p>The given keyboard layout contains 24 layers. Each key appears in
one (or several) layer of the keyboard. Accents are associated to
the same key as their non-accented version.
This class may be used to generate typing noise, so accents should
have their own keys (and closer accents should be represented by
closer keys). This method takes care of it, by generating "virtual
keyboard layers", for each group of accents. The goal is to
generate a virtual keyboard layer that is as close as possible as
the actual keyboard, used by real-users.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>keyboard_layout</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary representing the keyboard and
its layout.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ignore_layers_after</code></td>
            <td>
                  <code>Optional[int]) </code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ignore higher layers of the
keyboard layout. If <code>None</code> is given, no layer is ignored.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="kebbie.layout.KeyInfo" href="#kebbie.layout.KeyInfo">KeyInfo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key information for each character in the keyboard.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[int, <a class="autorefs autorefs-internal" title="kebbie.layout.Key" href="#kebbie.layout.Key">Key</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key information for each layer of the keyboard.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of accents used in the keyboard.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_infos</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">keyboard_layout</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">ignore_layers_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KeyInfo</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Key</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method reads the given keyboard layout, and extract useful data</span>
<span class="sd">    structures from this (to be used later by other methods). This</span>
<span class="sd">    basically builds the LayoutHelper class (and should be used only inside</span>
<span class="sd">    the constructor).</span>

<span class="sd">    Note:</span>
<span class="sd">        The given keyboard layout contains 24 layers. Each key appears in</span>
<span class="sd">        one (or several) layer of the keyboard. Accents are associated to</span>
<span class="sd">        the same key as their non-accented version.</span>
<span class="sd">        This class may be used to generate typing noise, so accents should</span>
<span class="sd">        have their own keys (and closer accents should be represented by</span>
<span class="sd">        closer keys). This method takes care of it, by generating &quot;virtual</span>
<span class="sd">        keyboard layers&quot;, for each group of accents. The goal is to</span>
<span class="sd">        generate a virtual keyboard layer that is as close as possible as</span>
<span class="sd">        the actual keyboard, used by real-users.</span>

<span class="sd">    Args:</span>
<span class="sd">        keyboard_layout (Dict): Dictionary representing the keyboard and</span>
<span class="sd">            its layout.</span>
<span class="sd">        ignore_layers_after (Optional[int]) : Ignore higher layers of the</span>
<span class="sd">            keyboard layout. If `None` is given, no layer is ignored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Key information for each character in the keyboard.</span>
<span class="sd">        Key information for each layer of the keyboard.</span>
<span class="sd">        List of accents used in the keyboard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dict char -&gt; key infos (bounds, center, klayer ID)</span>
    <span class="n">klayers_info</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># Dict klayer ID -&gt; list of keys (bounds, char)</span>
    <span class="n">all_accents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># A keyboard layout is made of several &quot;layers&quot;, each identified by a KeyboardID</span>
    <span class="n">last_klayer_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keyboard_layout</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">klayer</span> <span class="ow">in</span> <span class="n">keyboard_layout</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;buttons&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ignore_layers_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ignore_layers_after</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Each layer is a list of button</span>
        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;buttons&quot;</span><span class="p">]:</span>
            <span class="c1"># Button always have a character, and optionally accents</span>
            <span class="n">char</span><span class="p">,</span> <span class="n">accents</span> <span class="o">=</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># Special characters : space, shift, numbers, magic, etc...</span>
            <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">SPACE</span><span class="p">:</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
                <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="n">POINT</span><span class="p">:</span>
                    <span class="c1"># Points should be added to our key infos</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Other special characters are ignored</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">char</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Save the character and its key information</span>
            <span class="c1"># Save it only if it&#39;s not already in a previous klayer</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys_info</span> <span class="ow">or</span> <span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">klayer_id</span> <span class="o">&gt;</span> <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span>
                <span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyInfo</span><span class="p">(</span>
                    <span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                    <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">][</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">button</span><span class="p">[</span><span class="s2">&quot;centerPoint&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;centerPoint&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]),</span>
                <span class="p">)</span>
            <span class="c1"># But always save its info in the klayers info</span>
            <span class="n">klayers_info</span><span class="p">[</span><span class="n">klayer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Key</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">]))</span>

            <span class="c1"># Then, save the accents if any</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char_accent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accents</span><span class="p">):</span>
                <span class="n">all_accents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">char_accent</span><span class="p">)</span>

                <span class="c1"># Create a virtual position for the accent</span>
                <span class="n">bounds</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_virtual_key</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">button</span><span class="p">[</span><span class="s2">&quot;boundingRect&quot;</span><span class="p">])</span>

                <span class="c1"># Save the accent (only if not existing) in a new virtual klayer</span>
                <span class="k">if</span> <span class="n">char_accent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys_info</span><span class="p">:</span>
                    <span class="n">keys_info</span><span class="p">[</span><span class="n">char_accent</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyInfo</span><span class="p">(</span>
                        <span class="n">last_klayer_id</span><span class="p">,</span>
                        <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                        <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="c1"># But always saveits info in the klayers info</span>
                <span class="n">klayers_info</span><span class="p">[</span><span class="n">last_klayer_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Key</span><span class="p">(</span><span class="n">char_accent</span><span class="p">,</span> <span class="n">bounds</span><span class="p">))</span>

            <span class="c1"># If we added some accent in a virtual klayer, don&#39;t forget to update the last klayer ID</span>
            <span class="k">if</span> <span class="n">accents</span><span class="p">:</span>
                <span class="n">last_klayer_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">keys_info</span><span class="p">,</span> <span class="n">klayers_info</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_accents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.layout.LayoutHelper._make_virtual_key" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_make_virtual_key</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to create a new boundary for an accented character. Based on
the given id, the generated boundary box will be generated at a
different position.</p>
<p>This method tries to follow a similar pattern as the sample app, with
accents appearing in lines of 4 accents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>idx</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the bounding box to generate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>initial_bounds</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bounding box of the
non-accented key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated bounding box.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Its associated center position.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_make_virtual_key</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to create a new boundary for an accented character. Based on</span>
<span class="sd">    the given id, the generated boundary box will be generated at a</span>
<span class="sd">    different position.</span>

<span class="sd">    This method tries to follow a similar pattern as the sample app, with</span>
<span class="sd">    accents appearing in lines of 4 accents.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): The index of the bounding box to generate.</span>
<span class="sd">        initial_bounds (Dict[str, float]): The bounding box of the</span>
<span class="sd">            non-accented key.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Generated bounding box.</span>
<span class="sd">        Its associated center position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>

    <span class="n">start_x</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="n">N_ACCENT_PER_LINE</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">start_y</span> <span class="o">=</span> <span class="n">initial_bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">idx</span> <span class="o">//</span> <span class="n">N_ACCENT_PER_LINE</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="n">start_y</span><span class="p">,</span>
        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">start_x</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span>
        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">center</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.layout.LayoutHelper.get_key_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_key_info</span><span class="p">(</span><span class="n">char</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to retrieve the information associated to a specific key.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>char</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Character for which to retrieve key information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>KeyError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception raised if the given character can't be typed (
because it doesn't exist on this keyboard layout).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the key for the requested character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the key for the requested character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center position (x-axis) of the key for the requested character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center position (y-axis) of the key for the requested character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyboard layer ID where the character's key is located.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_key_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to retrieve the information associated to a specific key.</span>

<span class="sd">    Args:</span>
<span class="sd">        char (str): Character for which to retrieve key information.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: Exception raised if the given character can&#39;t be typed (</span>
<span class="sd">            because it doesn&#39;t exist on this keyboard layout).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Width of the key for the requested character.</span>
<span class="sd">        Height of the key for the requested character.</span>
<span class="sd">        Center position (x-axis) of the key for the requested character.</span>
<span class="sd">        Center position (y-axis) of the key for the requested character.</span>
<span class="sd">        Keyboard layer ID where the character&#39;s key is located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_info</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="o">.</span><span class="n">klayer_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.layout.LayoutHelper.get_key" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_key</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">klayer_id</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get the character associated with the given position.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Position (x, y) in the keyboard.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>klayer_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyboard layer ID to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Character associated to the given position.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">klayer_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the character associated with the given position.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (Tuple[float, float]): Position (x, y) in the keyboard.</span>
<span class="sd">        klayer_id (int): Keyboard layer ID to use.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Character associated to the given position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">klayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayers_info</span><span class="p">[</span><span class="n">klayer_id</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Retrieve the key that contains the sampled position</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="n">k</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">klayer</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="c1"># Maybe the sampled position was out of bound -&gt; retrieve the closest key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">klayer</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">euclidian_dist</span><span class="p">(</span>
                <span class="n">pos</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">char</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="noise_modelpy"><code>noise_model.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module defining the <code>NoiseModel</code> class, which takes care of introducing
typos in a clean text (and later see if the model can properly correct these
typos).</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.noise_model.Typo" class="doc doc-heading">
            <code>Typo</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


      <p>Enum listing all possible typos that can be introduced.</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/noise_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Typo</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enum listing all possible typos that can be introduced.&quot;&quot;&quot;</span>

    <span class="c1"># Deletions</span>
    <span class="n">DELETE_SPELLING_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;DELETE_SPELLING_SYMBOL&quot;</span>
    <span class="n">DELETE_SPACE</span> <span class="o">=</span> <span class="s2">&quot;DELETE_SPACE&quot;</span>
    <span class="n">DELETE_PUNCTUATION</span> <span class="o">=</span> <span class="s2">&quot;DELETE_PUNCTUATION&quot;</span>
    <span class="n">DELETE_CHAR</span> <span class="o">=</span> <span class="s2">&quot;DELETE_CHAR&quot;</span>

    <span class="c1"># Additions</span>
    <span class="n">ADD_SPELLING_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;ADD_SPELLING_SYMBOL&quot;</span>
    <span class="n">ADD_SPACE</span> <span class="o">=</span> <span class="s2">&quot;ADD_SPACE&quot;</span>
    <span class="n">ADD_PUNCTUATION</span> <span class="o">=</span> <span class="s2">&quot;ADD_PUNCTUATION&quot;</span>
    <span class="n">ADD_CHAR</span> <span class="o">=</span> <span class="s2">&quot;ADD_CHAR&quot;</span>

    <span class="c1"># Substitutions</span>
    <span class="n">SUBSTITUTE_CHAR</span> <span class="o">=</span> <span class="s2">&quot;SUBSTITUTE_CHAR&quot;</span>

    <span class="c1"># Simplifications</span>
    <span class="n">SIMPLIFY_ACCENT</span> <span class="o">=</span> <span class="s2">&quot;SIMPLIFY_ACCENT&quot;</span>
    <span class="n">SIMPLIFY_CASE</span> <span class="o">=</span> <span class="s2">&quot;SIMPLIFY_CASE&quot;</span>

    <span class="c1"># Transposition</span>
    <span class="n">TRANSPOSE_CHAR</span> <span class="o">=</span> <span class="s2">&quot;TRANSPOSE_CHAR&quot;</span>

    <span class="c1"># Common typos</span>
    <span class="n">COMMON_TYPO</span> <span class="o">=</span> <span class="s2">&quot;COMMON_TYPO&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.noise_model.NoiseModel" class="doc doc-heading">
            <code>NoiseModel</code>


</h3>


    <div class="doc doc-contents ">


      <p>Class responsible for introducing typo in a clean text.</p>
<p>Most of typos are introduced on text directly. Then fuzzy typing is
applied, using two Gaussian distributions (for x-axis and y-axis),
mimicking a user typing on a soft keyboard.</p>
<p>The ratio arguments are here to choose how wide the Gaussian distribution
is. A wider distribution will be less precise, a narrower distribution will
be more precise. To test how wide a ratio is, run the following code :
<div class="highlight"><pre><span></span><code>from scipy.stats import norm

def compute(x):
    cdf = norm.cdf(x)
    return cdf - (1 - cdf)

print(compute(2.32))    # &gt;&gt;&gt; 0.9796591226625606
</code></pre></div>
So in this case, a ratio of <code>2.32</code> gives a precision of ~98% (a typo will
be introduced in 2% of the cases).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>custom_keyboard</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, instead of relying on
the keyboard layout provided by default, uses the given keyboard
layout.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>common_typos</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of
common typos. If <code>None</code>, common typos are not used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>typo_probs</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probabilities for
each type of typos. If <code>None</code> is given, <code>DEFAULT_TYPO_PROBS</code> is
used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>x_offset</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter for the Gaussian distribution for
the fuzzy typing. Base position offset on the x-axis.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y_offset</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter for the Gaussian distribution for
the fuzzy typing. Base position offset on the y-axis.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>x_ratio</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter for the Gaussian distribution for
the fuzzy typing. It controls how wide the distribution is on the
x-axis, which is the precision of the typing.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.noise_model.DEFAULT_SIGMA_RATIO" href="#kebbie.noise_model.DEFAULT_SIGMA_RATIO">DEFAULT_SIGMA_RATIO</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y_ratio</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter for the Gaussian distribution for
the fuzzy typing. It controls how wide the distribution is on the
y-axis, which is the precision of the typing.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.noise_model.DEFAULT_SIGMA_RATIO" href="#kebbie.noise_model.DEFAULT_SIGMA_RATIO">DEFAULT_SIGMA_RATIO</a></code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/noise_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NoiseModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class responsible for introducing typo in a clean text.</span>

<span class="sd">    Most of typos are introduced on text directly. Then fuzzy typing is</span>
<span class="sd">    applied, using two Gaussian distributions (for x-axis and y-axis),</span>
<span class="sd">    mimicking a user typing on a soft keyboard.</span>

<span class="sd">    The ratio arguments are here to choose how wide the Gaussian distribution</span>
<span class="sd">    is. A wider distribution will be less precise, a narrower distribution will</span>
<span class="sd">    be more precise. To test how wide a ratio is, run the following code :</span>
<span class="sd">    ```</span>
<span class="sd">    from scipy.stats import norm</span>

<span class="sd">    def compute(x):</span>
<span class="sd">        cdf = norm.cdf(x)</span>
<span class="sd">        return cdf - (1 - cdf)</span>

<span class="sd">    print(compute(2.32))    # &gt;&gt;&gt; 0.9796591226625606</span>
<span class="sd">    ```</span>
<span class="sd">    So in this case, a ratio of `2.32` gives a precision of ~98% (a typo will</span>
<span class="sd">    be introduced in 2% of the cases).</span>

<span class="sd">    Args:</span>
<span class="sd">        lang (str): Language used.</span>
<span class="sd">        custom_keyboard (Dict, optional): If provided, instead of relying on</span>
<span class="sd">            the keyboard layout provided by default, uses the given keyboard</span>
<span class="sd">            layout.</span>
<span class="sd">        common_typos (Optional[Dict[str, List[str]]], optional): Dictionary of</span>
<span class="sd">            common typos. If `None`, common typos are not used.</span>
<span class="sd">        typo_probs (Optional[Dict[str, float]], optional): Probabilities for</span>
<span class="sd">            each type of typos. If `None` is given, `DEFAULT_TYPO_PROBS` is</span>
<span class="sd">            used.</span>
<span class="sd">        x_offset (float, optional): Parameter for the Gaussian distribution for</span>
<span class="sd">            the fuzzy typing. Base position offset on the x-axis.</span>
<span class="sd">        y_offset (float, optional): Parameter for the Gaussian distribution for</span>
<span class="sd">            the fuzzy typing. Base position offset on the y-axis.</span>
<span class="sd">        x_ratio (float, optional): Parameter for the Gaussian distribution for</span>
<span class="sd">            the fuzzy typing. It controls how wide the distribution is on the</span>
<span class="sd">            x-axis, which is the precision of the typing.</span>
<span class="sd">        y_ratio (float, optional): Parameter for the Gaussian distribution for</span>
<span class="sd">            the fuzzy typing. It controls how wide the distribution is on the</span>
<span class="sd">            y-axis, which is the precision of the typing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">custom_keyboard</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">common_typos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">typo_probs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">y_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">x_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_SIGMA_RATIO</span><span class="p">,</span>
        <span class="n">y_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_SIGMA_RATIO</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_offset</span> <span class="o">=</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_ratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ratio</span> <span class="o">=</span> <span class="n">x_ratio</span><span class="p">,</span> <span class="n">y_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span> <span class="o">=</span> <span class="n">LayoutHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span> <span class="n">custom_keyboard</span><span class="o">=</span><span class="n">custom_keyboard</span><span class="p">,</span> <span class="n">ignore_layers_after</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probs</span> <span class="o">=</span> <span class="n">typo_probs</span> <span class="k">if</span> <span class="n">typo_probs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_TYPO_PROBS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">common_typos</span> <span class="o">=</span> <span class="n">common_typos</span> <span class="k">if</span> <span class="n">common_typos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_typos</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">type_till_space</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">,</span>
        <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method introducing typos word by word.</span>

<span class="sd">        This method receives a list of words, and type these words while</span>
<span class="sd">        introducing typos.</span>
<span class="sd">        So most of the time, only one word will be typed and the method will</span>
<span class="sd">        return. In some cases, the space is mistyped or deleted, so two words</span>
<span class="sd">        are typed.</span>

<span class="sd">        Args:</span>
<span class="sd">            words (List[str]): List of words to type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of keystrokes (may contains some None).</span>
<span class="sd">            The typed characters as string.</span>
<span class="sd">            The number of words typed.</span>
<span class="sd">            The list of typos introduced in the string typed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_keystrokes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_typed_char</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">all_typos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
            <span class="c1"># Some words can&#39;t be corrected (numbers, symbols, etc...) -&gt; Don&#39;t introduce typos</span>
            <span class="n">error_free</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_correctable</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>

            <span class="c1"># Add typos in the word</span>
            <span class="n">noisy_word</span><span class="p">,</span> <span class="n">typos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_typos</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>
            <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">typos</span>

            <span class="c1"># Type the word (fuzzy)</span>
            <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_char</span><span class="p">,</span> <span class="n">typos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">noisy_word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>
            <span class="n">all_keystrokes</span> <span class="o">+=</span> <span class="n">keystrokes</span>
            <span class="n">all_typed_char</span> <span class="o">+=</span> <span class="n">typed_char</span>
            <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">typos</span>

            <span class="c1"># Then, we try to type a space (separator between words)</span>
            <span class="c1"># TODO : Modify this part for languages without space</span>
            <span class="n">noisy_space</span><span class="p">,</span> <span class="n">sp_typo_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_typos</span><span class="p">(</span><span class="n">SPACE</span><span class="p">)</span>
            <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_char</span><span class="p">,</span> <span class="n">sp_typo_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">noisy_space</span><span class="p">)</span>

            <span class="c1"># If the space is correctly typed, return now, otherwise type the next word</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_typo_1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sp_typo_2</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_keystrokes</span> <span class="o">+=</span> <span class="n">keystrokes</span>
                <span class="n">all_typed_char</span> <span class="o">+=</span> <span class="n">typed_char</span>
                <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">sp_typo_1</span> <span class="o">+</span> <span class="n">sp_typo_2</span>

        <span class="k">return</span> <span class="n">all_keystrokes</span><span class="p">,</span> <span class="n">all_typed_char</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">all_typos</span>

    <span class="k">def</span> <span class="nf">swipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for creating an artificial swipe gesture given a word.</span>

<span class="sd">        Args:</span>
<span class="sd">            word (str): Word to type with a swipe gesture.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Positions (x, y) of the generated swipe gesture, or None if the</span>
<span class="sd">                swipe gesture couldn&#39;t be created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Some words can&#39;t be corrected (numbers, symbols, etc...) -&gt; Don&#39;t introduce typos</span>
        <span class="n">error_free</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_correctable</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>

        <span class="c1"># Get the core keystrokes (fuzzy)</span>
        <span class="n">keystrokes</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>

        <span class="c1"># If we can swipe that word, create the corresponding artificial gesture</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">make_swipe_gesture</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_introduce_typos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_free</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">]]:</span>  <span class="c1"># noqa: C901</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to introduce typos in a given string.</span>

<span class="sd">        Either the word is changed into an existing common typo, or the word is</span>
<span class="sd">        processed as a stream of characters, each character having a chance of</span>
<span class="sd">        being mistyped.</span>
<span class="sd">        This method only add regular typos (deletions, additions, etc...), and</span>
<span class="sd">        is not introducing fuzzy typing.</span>

<span class="sd">        Args:</span>
<span class="sd">            word (str): Clean string where to add typos.</span>
<span class="sd">            error_free (bool): If set to True, don&#39;t introduce typo. Defaults</span>
<span class="sd">                to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The noisy string.</span>
<span class="sd">            The list of typos introduced.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">error_free</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">word</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c1"># First of all, we either consider the word as a unit and introduce a</span>
        <span class="c1"># language-specific common typo (if available), or treat the word as a</span>
        <span class="c1"># sequence of character, where each character can have a typo</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_typos</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">COMMON_TYPO</span><span class="p">]):</span>
            <span class="c1"># Introduce a common typo</span>
            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">common_typos</span><span class="p">[</span><span class="n">word</span><span class="p">]),</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">COMMON_TYPO</span><span class="p">]</span>

        <span class="c1"># From here, treat the word as a stream of characters, and potentially</span>
        <span class="c1"># add typos for each character</span>
        <span class="n">noisy_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">typos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">word_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">word_chars</span><span class="p">):</span>
            <span class="c1"># First, potentially apply simplifications (removing accent, or</span>
            <span class="c1"># lowercasing an uppercase character)</span>
            <span class="c1"># Note that if the full word is uppercase, we don&#39;t apply lowercase</span>
            <span class="c1"># simplification (doesn&#39;t feel like a natural typo a user would do)</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">letter_accents</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_ACCENT</span><span class="p">]):</span>
                <span class="n">char</span> <span class="o">=</span> <span class="n">strip_accents</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
                <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_ACCENT</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_CASE</span><span class="p">]):</span>
                <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_CASE</span><span class="p">)</span>

            <span class="c1"># Check if this character exists on our keyboard</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
                <span class="n">char_is_on_kb</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">char_is_on_default_kb</span> <span class="o">=</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">char_is_on_kb</span> <span class="o">=</span> <span class="n">char_is_on_default_kb</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Then, add the possible typo depending on the character type</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">is_first_char</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">is_last_char</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">char_is_on_kb</span><span class="p">:</span>
                <span class="c1"># Don&#39;t introduce typos for numbers or symbols that are not on keyboard</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_last_char</span><span class="p">:</span>
                    <span class="c1"># Only transpose char if they are on the same keyboard layer</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">next_char_klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">next_char_klayer_id</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="n">next_char_klayer_id</span><span class="p">:</span>
                        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">TRANSPOSE_CHAR</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">spelling_symbols</span><span class="p">:</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">)</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPELLING_SYMBOL</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">char</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">)</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPACE</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">:</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">)</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_PUNCTUATION</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">char_is_on_default_kb</span><span class="p">:</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">)</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_CHAR</span><span class="p">)</span>

            <span class="c1"># If it&#39;s the last character (and we are not typing a space),</span>
            <span class="c1"># don&#39;t add deletions typos, because it&#39;s an auto-completion case,</span>
            <span class="c1"># not auto-correction</span>
            <span class="k">if</span> <span class="n">is_last_char</span> <span class="ow">and</span> <span class="n">word</span> <span class="o">!=</span> <span class="n">SPACE</span><span class="p">:</span>
                <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DELETIONS</span><span class="p">]</span>

            <span class="c1"># Get the probabilities for these possible events</span>
            <span class="n">typo_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">is_first_char</span><span class="p">:</span>
                <span class="c1"># Deleting the first character of the word is not so common, update the probabilities accordingly</span>
                <span class="n">typo_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="n">p</span> <span class="o">*</span> <span class="n">FRONT_DELETION_MULTIPLIER</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">DELETIONS</span> <span class="k">else</span> <span class="n">p</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">typo_probs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="c1"># And sample one of them</span>
            <span class="n">typo</span> <span class="o">=</span> <span class="n">sample_among</span><span class="p">(</span><span class="n">typo_probs</span><span class="p">)</span>

            <span class="c1"># Process the typo</span>
            <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="n">Typo</span><span class="o">.</span><span class="n">TRANSPOSE_CHAR</span><span class="p">:</span>
                <span class="n">noisy_char</span> <span class="o">=</span> <span class="n">word_chars</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">word_chars</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">char</span>
            <span class="k">elif</span> <span class="n">typo</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">]:</span>
                <span class="n">noisy_char</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="n">typo</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPELLING_SYMBOL</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPACE</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_PUNCTUATION</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_CHAR</span><span class="p">]:</span>
                <span class="n">noisy_char</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">char</span><span class="si">}{</span><span class="n">char</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># No typo</span>
                <span class="n">noisy_char</span> <span class="o">=</span> <span class="n">char</span>

            <span class="n">noisy_word</span> <span class="o">+=</span> <span class="n">noisy_char</span>
            <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typo</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">noisy_word</span><span class="p">,</span> <span class="n">typos</span>

    <span class="k">def</span> <span class="nf">_fuzzy_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_free</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method adding fuzzy typing.</span>

<span class="sd">        This method takes a string (potentially already noisy from other type</span>
<span class="sd">        of typos), and fuzzy-type it : simulate a user on a soft-keyboard.</span>
<span class="sd">        This &quot;fat-finger syndrom&quot; is simulated using two Gaussian</span>
<span class="sd">        distributions, one for each axis (x, y).</span>
<span class="sd">        This method also returns the generated keystrokes (positions on the</span>
<span class="sd">        keyboard), but only for the default keyboard (ID = 0). Keystrokes from</span>
<span class="sd">        other keyboard are set to None.</span>

<span class="sd">        Args:</span>
<span class="sd">            word (str): String to fuzzy-type.</span>
<span class="sd">            error_free (bool): If set to True, don&#39;t introduce typo. Defaults</span>
<span class="sd">                to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of keystrokes.</span>
<span class="sd">            Fuzzy string (corresponding to the keystrokes).</span>
<span class="sd">            List of typos introduced.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fuzzy_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">keystrokes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">typos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Type word character by character</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># This character doesn&#39;t exist on the current keyboard</span>
                <span class="c1"># Just type it without introducing typo, like if the user copy-pasted it</span>
                <span class="n">keystrokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">fuzzy_word</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="k">continue</span>

            <span class="c1"># Sample a keystroke for this character</span>
            <span class="c1"># Note that we don&#39;t generate typos for characters outside of the default keyboard</span>
            <span class="k">if</span> <span class="n">error_free</span> <span class="ow">or</span> <span class="n">klayer_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">keystroke</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Compute mu and sigma for the Normal distribution</span>
                <span class="n">x_mu</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_offset</span>
                <span class="n">y_mu</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_offset</span>
                <span class="n">x_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ratio</span>
                <span class="n">y_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ratio</span>

                <span class="c1"># Sample a position (x and y)</span>
                <span class="n">keystroke</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">x_mu</span><span class="p">,</span> <span class="n">x_sigma</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">y_mu</span><span class="p">,</span> <span class="n">y_sigma</span><span class="p">))</span>

            <span class="c1"># Convert it back to a character, to see where we tapped</span>
            <span class="n">fuzzy_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">keystroke</span><span class="p">,</span> <span class="n">klayer_id</span><span class="p">)</span>

            <span class="c1"># Save it (save the keystroke only if part of the default keyboard)</span>
            <span class="n">keystrokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keystroke</span> <span class="k">if</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">fuzzy_word</span> <span class="o">+=</span> <span class="n">fuzzy_char</span>
            <span class="k">if</span> <span class="n">fuzzy_char</span> <span class="o">!=</span> <span class="n">char</span><span class="p">:</span>
                <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SUBSTITUTE_CHAR</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">keystrokes</span><span class="p">,</span> <span class="n">fuzzy_word</span><span class="p">,</span> <span class="n">typos</span>

    <span class="k">def</span> <span class="nf">_is_correctable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method returning True if we expect the given word to be corrected</span>
<span class="sd">        upon typo introduction, False otherwise.</span>

<span class="sd">        This is necessary to ensure we don&#39;t introduce typos in words that</span>
<span class="sd">        can&#39;t be corrected, because if we do, it will be counted as error.</span>

<span class="sd">        For now, are considered non-correctable :</span>
<span class="sd">         * Words that don&#39;t contains any letter (from Unicode standard)</span>

<span class="sd">        Args:</span>
<span class="sd">            word (str): Word to classify as correctable or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the word is correctable (and therefore we can introduce</span>
<span class="sd">            typo), False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use the Unicode category `L` (see https://en.wikipedia.org/wiki/Unicode_character_property#General_Category)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[^\pL]+$&quot;</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_common_typos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list (if it exists) of plausible common typos to use</span>
<span class="sd">        when introducing typos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary where the keys are the correct words and the values are</span>
<span class="sd">                the associated possible typos for this word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">common_typos_cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CACHE_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plang</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>

        <span class="c1"># Try to access the cached common typos, and if it fails, it means we</span>
        <span class="c1"># don&#39;t have it locally</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># File is not cached, download &amp; process the common typos from online</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">typos</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TWEET_TYPO_CORPUS_URL</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">typoed_word</span><span class="p">,</span> <span class="n">correct_word</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">typos</span><span class="p">[</span><span class="n">correct_word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typoed_word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Save the retrieved typos in cache</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">typos</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">typos</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel.type_till_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">type_till_space</span><span class="p">(</span><span class="n">words</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method introducing typos word by word.</p>
<p>This method receives a list of words, and type these words while
introducing typos.
So most of the time, only one word will be typed and the method will
return. In some cases, the space is mistyped or deleted, so two words
are typed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>words</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of words to type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of keystrokes (may contains some None).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The typed characters as string.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of words typed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.noise_model.Typo" href="#kebbie.noise_model.Typo">Typo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of typos introduced in the string typed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">type_till_space</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="nb">int</span><span class="p">,</span>
    <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method introducing typos word by word.</span>

<span class="sd">    This method receives a list of words, and type these words while</span>
<span class="sd">    introducing typos.</span>
<span class="sd">    So most of the time, only one word will be typed and the method will</span>
<span class="sd">    return. In some cases, the space is mistyped or deleted, so two words</span>
<span class="sd">    are typed.</span>

<span class="sd">    Args:</span>
<span class="sd">        words (List[str]): List of words to type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of keystrokes (may contains some None).</span>
<span class="sd">        The typed characters as string.</span>
<span class="sd">        The number of words typed.</span>
<span class="sd">        The list of typos introduced in the string typed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_keystrokes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_typed_char</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">all_typos</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
        <span class="c1"># Some words can&#39;t be corrected (numbers, symbols, etc...) -&gt; Don&#39;t introduce typos</span>
        <span class="n">error_free</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_correctable</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>

        <span class="c1"># Add typos in the word</span>
        <span class="n">noisy_word</span><span class="p">,</span> <span class="n">typos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_typos</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>
        <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">typos</span>

        <span class="c1"># Type the word (fuzzy)</span>
        <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_char</span><span class="p">,</span> <span class="n">typos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">noisy_word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>
        <span class="n">all_keystrokes</span> <span class="o">+=</span> <span class="n">keystrokes</span>
        <span class="n">all_typed_char</span> <span class="o">+=</span> <span class="n">typed_char</span>
        <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">typos</span>

        <span class="c1"># Then, we try to type a space (separator between words)</span>
        <span class="c1"># TODO : Modify this part for languages without space</span>
        <span class="n">noisy_space</span><span class="p">,</span> <span class="n">sp_typo_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_typos</span><span class="p">(</span><span class="n">SPACE</span><span class="p">)</span>
        <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_char</span><span class="p">,</span> <span class="n">sp_typo_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">noisy_space</span><span class="p">)</span>

        <span class="c1"># If the space is correctly typed, return now, otherwise type the next word</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_typo_1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sp_typo_2</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_keystrokes</span> <span class="o">+=</span> <span class="n">keystrokes</span>
            <span class="n">all_typed_char</span> <span class="o">+=</span> <span class="n">typed_char</span>
            <span class="n">all_typos</span> <span class="o">+=</span> <span class="n">sp_typo_1</span> <span class="o">+</span> <span class="n">sp_typo_2</span>

    <span class="k">return</span> <span class="n">all_keystrokes</span><span class="p">,</span> <span class="n">all_typed_char</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">all_typos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel.swipe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">swipe</span><span class="p">(</span><span class="n">word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method for creating an artificial swipe gesture given a word.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word to type with a swipe gesture.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positions (x, y) of the generated swipe gesture, or None if the
swipe gesture couldn't be created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for creating an artificial swipe gesture given a word.</span>

<span class="sd">    Args:</span>
<span class="sd">        word (str): Word to type with a swipe gesture.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Positions (x, y) of the generated swipe gesture, or None if the</span>
<span class="sd">            swipe gesture couldn&#39;t be created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Some words can&#39;t be corrected (numbers, symbols, etc...) -&gt; Don&#39;t introduce typos</span>
    <span class="n">error_free</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_correctable</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>

    <span class="c1"># Get the core keystrokes (fuzzy)</span>
    <span class="n">keystrokes</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="n">error_free</span><span class="p">)</span>

    <span class="c1"># If we can swipe that word, create the corresponding artificial gesture</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_swipe_gesture</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel._introduce_typos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_introduce_typos</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to introduce typos in a given string.</p>
<p>Either the word is changed into an existing common typo, or the word is
processed as a stream of characters, each character having a chance of
being mistyped.
This method only add regular typos (deletions, additions, etc...), and
is not introducing fuzzy typing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Clean string where to add typos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>error_free</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set to True, don't introduce typo. Defaults
to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The noisy string.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.noise_model.Typo" href="#kebbie.noise_model.Typo">Typo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of typos introduced.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_introduce_typos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_free</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">]]:</span>  <span class="c1"># noqa: C901</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to introduce typos in a given string.</span>

<span class="sd">    Either the word is changed into an existing common typo, or the word is</span>
<span class="sd">    processed as a stream of characters, each character having a chance of</span>
<span class="sd">    being mistyped.</span>
<span class="sd">    This method only add regular typos (deletions, additions, etc...), and</span>
<span class="sd">    is not introducing fuzzy typing.</span>

<span class="sd">    Args:</span>
<span class="sd">        word (str): Clean string where to add typos.</span>
<span class="sd">        error_free (bool): If set to True, don&#39;t introduce typo. Defaults</span>
<span class="sd">            to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The noisy string.</span>
<span class="sd">        The list of typos introduced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">error_free</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">word</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># First of all, we either consider the word as a unit and introduce a</span>
    <span class="c1"># language-specific common typo (if available), or treat the word as a</span>
    <span class="c1"># sequence of character, where each character can have a typo</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_typos</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">COMMON_TYPO</span><span class="p">]):</span>
        <span class="c1"># Introduce a common typo</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">common_typos</span><span class="p">[</span><span class="n">word</span><span class="p">]),</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">COMMON_TYPO</span><span class="p">]</span>

    <span class="c1"># From here, treat the word as a stream of characters, and potentially</span>
    <span class="c1"># add typos for each character</span>
    <span class="n">noisy_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">typos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">word_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">word_chars</span><span class="p">):</span>
        <span class="c1"># First, potentially apply simplifications (removing accent, or</span>
        <span class="c1"># lowercasing an uppercase character)</span>
        <span class="c1"># Note that if the full word is uppercase, we don&#39;t apply lowercase</span>
        <span class="c1"># simplification (doesn&#39;t feel like a natural typo a user would do)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">letter_accents</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_ACCENT</span><span class="p">]):</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">strip_accents</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_ACCENT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_CASE</span><span class="p">]):</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_CASE</span><span class="p">)</span>

        <span class="c1"># Check if this character exists on our keyboard</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="n">char_is_on_kb</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">char_is_on_default_kb</span> <span class="o">=</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">char_is_on_kb</span> <span class="o">=</span> <span class="n">char_is_on_default_kb</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Then, add the possible typo depending on the character type</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">is_first_char</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">is_last_char</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">char_is_on_kb</span><span class="p">:</span>
            <span class="c1"># Don&#39;t introduce typos for numbers or symbols that are not on keyboard</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_last_char</span><span class="p">:</span>
                <span class="c1"># Only transpose char if they are on the same keyboard layer</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">next_char_klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">next_char_klayer_id</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="n">next_char_klayer_id</span><span class="p">:</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">TRANSPOSE_CHAR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">spelling_symbols</span><span class="p">:</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">)</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPELLING_SYMBOL</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">char</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">)</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPACE</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">:</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">)</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_PUNCTUATION</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">char_is_on_default_kb</span><span class="p">:</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">)</span>
                <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_CHAR</span><span class="p">)</span>

        <span class="c1"># If it&#39;s the last character (and we are not typing a space),</span>
        <span class="c1"># don&#39;t add deletions typos, because it&#39;s an auto-completion case,</span>
        <span class="c1"># not auto-correction</span>
        <span class="k">if</span> <span class="n">is_last_char</span> <span class="ow">and</span> <span class="n">word</span> <span class="o">!=</span> <span class="n">SPACE</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DELETIONS</span><span class="p">]</span>

        <span class="c1"># Get the probabilities for these possible events</span>
        <span class="n">typo_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">is_first_char</span><span class="p">:</span>
            <span class="c1"># Deleting the first character of the word is not so common, update the probabilities accordingly</span>
            <span class="n">typo_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="n">p</span> <span class="o">*</span> <span class="n">FRONT_DELETION_MULTIPLIER</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">DELETIONS</span> <span class="k">else</span> <span class="n">p</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">typo_probs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># And sample one of them</span>
        <span class="n">typo</span> <span class="o">=</span> <span class="n">sample_among</span><span class="p">(</span><span class="n">typo_probs</span><span class="p">)</span>

        <span class="c1"># Process the typo</span>
        <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="n">Typo</span><span class="o">.</span><span class="n">TRANSPOSE_CHAR</span><span class="p">:</span>
            <span class="n">noisy_char</span> <span class="o">=</span> <span class="n">word_chars</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">word_chars</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">char</span>
        <span class="k">elif</span> <span class="n">typo</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">]:</span>
            <span class="n">noisy_char</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">typo</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPELLING_SYMBOL</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPACE</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_PUNCTUATION</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_CHAR</span><span class="p">]:</span>
            <span class="n">noisy_char</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">char</span><span class="si">}{</span><span class="n">char</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># No typo</span>
            <span class="n">noisy_char</span> <span class="o">=</span> <span class="n">char</span>

        <span class="n">noisy_word</span> <span class="o">+=</span> <span class="n">noisy_char</span>
        <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typo</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">noisy_word</span><span class="p">,</span> <span class="n">typos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel._fuzzy_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_fuzzy_type</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">error_free</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method adding fuzzy typing.</p>
<p>This method takes a string (potentially already noisy from other type
of typos), and fuzzy-type it : simulate a user on a soft-keyboard.
This "fat-finger syndrom" is simulated using two Gaussian
distributions, one for each axis (x, y).
This method also returns the generated keystrokes (positions on the
keyboard), but only for the default keyboard (ID = 0). Keystrokes from
other keyboard are set to None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String to fuzzy-type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>error_free</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set to True, don't introduce typo. Defaults
to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of keystrokes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fuzzy string (corresponding to the keystrokes).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.noise_model.Typo" href="#kebbie.noise_model.Typo">Typo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of typos introduced.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_fuzzy_type</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_free</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method adding fuzzy typing.</span>

<span class="sd">    This method takes a string (potentially already noisy from other type</span>
<span class="sd">    of typos), and fuzzy-type it : simulate a user on a soft-keyboard.</span>
<span class="sd">    This &quot;fat-finger syndrom&quot; is simulated using two Gaussian</span>
<span class="sd">    distributions, one for each axis (x, y).</span>
<span class="sd">    This method also returns the generated keystrokes (positions on the</span>
<span class="sd">    keyboard), but only for the default keyboard (ID = 0). Keystrokes from</span>
<span class="sd">    other keyboard are set to None.</span>

<span class="sd">    Args:</span>
<span class="sd">        word (str): String to fuzzy-type.</span>
<span class="sd">        error_free (bool): If set to True, don&#39;t introduce typo. Defaults</span>
<span class="sd">            to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of keystrokes.</span>
<span class="sd">        Fuzzy string (corresponding to the keystrokes).</span>
<span class="sd">        List of typos introduced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fuzzy_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">keystrokes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">typos</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Type word character by character</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">klayer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key_info</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># This character doesn&#39;t exist on the current keyboard</span>
            <span class="c1"># Just type it without introducing typo, like if the user copy-pasted it</span>
            <span class="n">keystrokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">fuzzy_word</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">continue</span>

        <span class="c1"># Sample a keystroke for this character</span>
        <span class="c1"># Note that we don&#39;t generate typos for characters outside of the default keyboard</span>
        <span class="k">if</span> <span class="n">error_free</span> <span class="ow">or</span> <span class="n">klayer_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">keystroke</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Compute mu and sigma for the Normal distribution</span>
            <span class="n">x_mu</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_offset</span>
            <span class="n">y_mu</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_offset</span>
            <span class="n">x_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ratio</span>
            <span class="n">y_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ratio</span>

            <span class="c1"># Sample a position (x and y)</span>
            <span class="n">keystroke</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">x_mu</span><span class="p">,</span> <span class="n">x_sigma</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">y_mu</span><span class="p">,</span> <span class="n">y_sigma</span><span class="p">))</span>

        <span class="c1"># Convert it back to a character, to see where we tapped</span>
        <span class="n">fuzzy_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klayout</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">keystroke</span><span class="p">,</span> <span class="n">klayer_id</span><span class="p">)</span>

        <span class="c1"># Save it (save the keystroke only if part of the default keyboard)</span>
        <span class="n">keystrokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keystroke</span> <span class="k">if</span> <span class="n">klayer_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fuzzy_word</span> <span class="o">+=</span> <span class="n">fuzzy_char</span>
        <span class="k">if</span> <span class="n">fuzzy_char</span> <span class="o">!=</span> <span class="n">char</span><span class="p">:</span>
            <span class="n">typos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Typo</span><span class="o">.</span><span class="n">SUBSTITUTE_CHAR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">keystrokes</span><span class="p">,</span> <span class="n">fuzzy_word</span><span class="p">,</span> <span class="n">typos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel._is_correctable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_is_correctable</span><span class="p">(</span><span class="n">word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method returning True if we expect the given word to be corrected
upon typo introduction, False otherwise.</p>
<p>This is necessary to ensure we don't introduce typos in words that
can't be corrected, because if we do, it will be counted as error.</p>
<p>For now, are considered non-correctable :
 * Words that don't contains any letter (from Unicode standard)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word to classify as correctable or not.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the word is correctable (and therefore we can introduce</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>typo), False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_is_correctable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method returning True if we expect the given word to be corrected</span>
<span class="sd">    upon typo introduction, False otherwise.</span>

<span class="sd">    This is necessary to ensure we don&#39;t introduce typos in words that</span>
<span class="sd">    can&#39;t be corrected, because if we do, it will be counted as error.</span>

<span class="sd">    For now, are considered non-correctable :</span>
<span class="sd">     * Words that don&#39;t contains any letter (from Unicode standard)</span>

<span class="sd">    Args:</span>
<span class="sd">        word (str): Word to classify as correctable or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the word is correctable (and therefore we can introduce</span>
<span class="sd">        typo), False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use the Unicode category `L` (see https://en.wikipedia.org/wiki/Unicode_character_property#General_Category)</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[^\pL]+$&quot;</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.noise_model.NoiseModel._get_common_typos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_common_typos</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Retrieve the list (if it exists) of plausible common typos to use
when introducing typos.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary where the keys are the correct words and the values are
the associated possible typos for this word.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/noise_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_get_common_typos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the list (if it exists) of plausible common typos to use</span>
<span class="sd">    when introducing typos.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary where the keys are the correct words and the values are</span>
<span class="sd">            the associated possible typos for this word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">common_typos_cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CACHE_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plang</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>

    <span class="c1"># Try to access the cached common typos, and if it fails, it means we</span>
    <span class="c1"># don&#39;t have it locally</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># File is not cached, download &amp; process the common typos from online</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">typos</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TWEET_TYPO_CORPUS_URL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">typoed_word</span><span class="p">,</span> <span class="n">correct_word</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">typos</span><span class="p">[</span><span class="n">correct_word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typoed_word</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># Save the retrieved typos in cache</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">common_typos_cache_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">typos</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">typos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="oraclepy"><code>oracle.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module defining the <code>Oracle</code> class, which is the class taking care of
iterating the dataset, introducing typos using the noise model, and querying
the Corrector to correct these typos. Then the scorer is used to compute
metrics about the performances, and the results are returned.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.oracle.Oracle" class="doc doc-heading">
            <code>Oracle</code>


</h3>


    <div class="doc doc-contents ">


      <p>Class that takes care of testing a Corrector. It basically gets clean
text data, adds noise to it, send the noisy data to the Corrector, and
scores its output.</p>
<p>This class spawn multiple processes to decrease runtime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>test_data</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of clean sentences for each
domain.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>custom_keyboard</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, instead of relying on
the keyboard layout provided by default, uses the given keyboard
layout.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>track_mistakes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set to <code>True</code> for tracking the most
common mistakes. Most common mistakes are added to the results
dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_most_common_mistakes</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>track_mistakes</code> is set to
<code>True</code>, the top X mistakes to record.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>beta</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Beta to use for computing the F-beta score.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/oracle.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Oracle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class that takes care of testing a Corrector. It basically gets clean</span>
<span class="sd">    text data, adds noise to it, send the noisy data to the Corrector, and</span>
<span class="sd">    scores its output.</span>

<span class="sd">    This class spawn multiple processes to decrease runtime.</span>

<span class="sd">    Args:</span>
<span class="sd">        lang (str): Language used.</span>
<span class="sd">        test_data (Dict[str, List[str]]): List of clean sentences for each</span>
<span class="sd">            domain.</span>
<span class="sd">        custom_keyboard (Dict): If provided, instead of relying on</span>
<span class="sd">            the keyboard layout provided by default, uses the given keyboard</span>
<span class="sd">            layout.</span>
<span class="sd">        track_mistakes (bool): Set to `True` for tracking the most</span>
<span class="sd">            common mistakes. Most common mistakes are added to the results</span>
<span class="sd">            dictionary.</span>
<span class="sd">        n_most_common_mistakes (int): If `track_mistakes` is set to</span>
<span class="sd">            `True`, the top X mistakes to record.</span>
<span class="sd">        beta (float): Beta to use for computing the F-beta score.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">test_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">custom_keyboard</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">track_mistakes</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">n_most_common_mistakes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">test_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_keyboard</span> <span class="o">=</span> <span class="n">custom_keyboard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span> <span class="o">=</span> <span class="n">track_mistakes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_most_common_mistakes</span> <span class="o">=</span> <span class="n">n_most_common_mistakes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corrector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Corrector</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Corrector</span><span class="p">]],</span> <span class="n">n_proc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main method, it tests the given Corrector, and returns results as a</span>
<span class="sd">        dictionary.</span>

<span class="sd">        This method spawn multiple processes to decrease runtime.</span>

<span class="sd">        Args:</span>
<span class="sd">            corrector (Union[Corrector, List[Corrector]]): Corrector to test.</span>
<span class="sd">                If a list of Corrector is given, the argument `n_proc` is</span>
<span class="sd">                ignored, and one corrector is assigned for each process.</span>
<span class="sd">            n_proc (Optional[int]): Number of processes to use. If `None`,</span>
<span class="sd">                `os.cpu_count()` is used.</span>
<span class="sd">            seed (int): Seed to use for running the tests.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Results formatted in a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize a global Scorer here, that will gather counts across processes</span>
        <span class="n">scorer</span> <span class="o">=</span> <span class="n">Scorer</span><span class="p">(</span><span class="n">domains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">track_mistakes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">)</span>

        <span class="c1"># For multiprocessing</span>
        <span class="n">n_proc</span> <span class="o">=</span> <span class="n">n_proc</span> <span class="k">if</span> <span class="n">n_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">d_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Create the corrector for each process</span>
        <span class="n">proc_correctors</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">corrector</span><span class="p">,</span> <span class="n">Corrector</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_proc</span><span class="p">):</span>
                <span class="n">proc_correctors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">corrector</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we already have a list of correctors, assign one for each process</span>
            <span class="n">n_proc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corrector</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">corrector</span><span class="p">:</span>
                <span class="n">proc_correctors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span>
            <span class="n">processes</span><span class="o">=</span><span class="n">n_proc</span><span class="p">,</span>
            <span class="n">initializer</span><span class="o">=</span><span class="n">init_tester</span><span class="p">,</span>
            <span class="n">initargs</span><span class="o">=</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_keyboard</span><span class="p">,</span> <span class="n">proc_correctors</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">),</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">d_size</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="c1"># Test data is made of several domain, where each domain contains a list of sentences</span>
            <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">sentence_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_proc</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">scr</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="n">sentence_list</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                    <span class="n">scr</span><span class="o">.</span><span class="n">set_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
                    <span class="n">scorer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">scr</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Retrieve the results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">scorer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>

        <span class="c1"># Then potentially add the most common mistakes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
            <span class="n">mistakes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nwp&quot;</span><span class="p">,</span> <span class="s2">&quot;acp&quot;</span><span class="p">,</span> <span class="s2">&quot;acr&quot;</span><span class="p">]:</span>
                <span class="n">task_name</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nwp&quot;</span><span class="p">:</span> <span class="s2">&quot;next_word_prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;acp&quot;</span><span class="p">:</span> <span class="s2">&quot;auto_completion&quot;</span><span class="p">,</span> <span class="s2">&quot;acr&quot;</span><span class="p">:</span> <span class="s2">&quot;auto_correction&quot;</span><span class="p">}[</span><span class="n">task</span><span class="p">]</span>

                <span class="n">m_count</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scorer</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">_mistakes&quot;</span><span class="p">)</span>

                <span class="n">mistakes</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Expected&quot;</span><span class="p">,</span> <span class="s2">&quot;Predictions&quot;</span><span class="p">,</span> <span class="s2">&quot;Context&quot;</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_most_common_mistakes</span><span class="p">):</span>
                    <span class="n">mistakes</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">actual</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">preds</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;most_common_mistakes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mistakes</span>

        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.oracle.Oracle.test" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test</span><span class="p">(</span><span class="n">corrector</span><span class="p">,</span> <span class="n">n_proc</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Main method, it tests the given Corrector, and returns results as a
dictionary.</p>
<p>This method spawn multiple processes to decrease runtime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>corrector</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="kebbie.Corrector" href="../public_api/#kebbie.correctors.Corrector">Corrector</a>, <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.Corrector" href="../public_api/#kebbie.correctors.Corrector">Corrector</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corrector to test.
If a list of Corrector is given, the argument <code>n_proc</code> is
ignored, and one corrector is assigned for each process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_proc</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use. If <code>None</code>,
<code>os.cpu_count()</code> is used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed to use for running the tests.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results formatted in a dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/oracle.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corrector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Corrector</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Corrector</span><span class="p">]],</span> <span class="n">n_proc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main method, it tests the given Corrector, and returns results as a</span>
<span class="sd">    dictionary.</span>

<span class="sd">    This method spawn multiple processes to decrease runtime.</span>

<span class="sd">    Args:</span>
<span class="sd">        corrector (Union[Corrector, List[Corrector]]): Corrector to test.</span>
<span class="sd">            If a list of Corrector is given, the argument `n_proc` is</span>
<span class="sd">            ignored, and one corrector is assigned for each process.</span>
<span class="sd">        n_proc (Optional[int]): Number of processes to use. If `None`,</span>
<span class="sd">            `os.cpu_count()` is used.</span>
<span class="sd">        seed (int): Seed to use for running the tests.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Results formatted in a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize a global Scorer here, that will gather counts across processes</span>
    <span class="n">scorer</span> <span class="o">=</span> <span class="n">Scorer</span><span class="p">(</span><span class="n">domains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">track_mistakes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">)</span>

    <span class="c1"># For multiprocessing</span>
    <span class="n">n_proc</span> <span class="o">=</span> <span class="n">n_proc</span> <span class="k">if</span> <span class="n">n_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="n">d_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Create the corrector for each process</span>
    <span class="n">proc_correctors</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">corrector</span><span class="p">,</span> <span class="n">Corrector</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_proc</span><span class="p">):</span>
            <span class="n">proc_correctors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">corrector</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If we already have a list of correctors, assign one for each process</span>
        <span class="n">n_proc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corrector</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">corrector</span><span class="p">:</span>
            <span class="n">proc_correctors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span>
        <span class="n">processes</span><span class="o">=</span><span class="n">n_proc</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="n">init_tester</span><span class="p">,</span>
        <span class="n">initargs</span><span class="o">=</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_keyboard</span><span class="p">,</span> <span class="n">proc_correctors</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">),</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">d_size</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="c1"># Test data is made of several domain, where each domain contains a list of sentences</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">sentence_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_proc</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">scr</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="n">sentence_list</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                <span class="n">scr</span><span class="o">.</span><span class="n">set_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
                <span class="n">scorer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">scr</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Retrieve the results</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">scorer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>

    <span class="c1"># Then potentially add the most common mistakes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
        <span class="n">mistakes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nwp&quot;</span><span class="p">,</span> <span class="s2">&quot;acp&quot;</span><span class="p">,</span> <span class="s2">&quot;acr&quot;</span><span class="p">]:</span>
            <span class="n">task_name</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nwp&quot;</span><span class="p">:</span> <span class="s2">&quot;next_word_prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;acp&quot;</span><span class="p">:</span> <span class="s2">&quot;auto_completion&quot;</span><span class="p">,</span> <span class="s2">&quot;acr&quot;</span><span class="p">:</span> <span class="s2">&quot;auto_correction&quot;</span><span class="p">}[</span><span class="n">task</span><span class="p">]</span>

            <span class="n">m_count</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scorer</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">_mistakes&quot;</span><span class="p">)</span>

            <span class="n">mistakes</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Expected&quot;</span><span class="p">,</span> <span class="s2">&quot;Predictions&quot;</span><span class="p">,</span> <span class="s2">&quot;Context&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_most_common_mistakes</span><span class="p">):</span>
                <span class="n">mistakes</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">actual</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">preds</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;most_common_mistakes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mistakes</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="kebbie.oracle.init_tester" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_tester</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">custom_keyboard</span><span class="p">,</span> <span class="n">correctors</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">track_mistakes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function run at process initialization for Tester workers.</p>
<p>Each worker in a Pool will run this function when created. It will
instanciate several things needed for testing the given corrector :
 * A Tokenizer to split sentences into words
 * A NoiseModel to introduce typos
 * A Corrector instance, which is the model we want to test</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fn</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Main tester function (instanciated objects will be
attached to this function).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>custom_keyboard</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, instead of relying on
the keyboard layout provided by default, uses the given keyboard
layout.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>correctors</code></td>
            <td>
                  <code><span title="multiprocessing.Queue">Queue</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Queue containing list of correctors to test.
Each process will get the next corrector available in queue.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base seed to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>track_mistakes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set to <code>True</code> for tracking the most common
mistakes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/oracle.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_tester</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">custom_keyboard</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">correctors</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">track_mistakes</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function run at process initialization for Tester workers.</span>

<span class="sd">    Each worker in a Pool will run this function when created. It will</span>
<span class="sd">    instanciate several things needed for testing the given corrector :</span>
<span class="sd">     * A Tokenizer to split sentences into words</span>
<span class="sd">     * A NoiseModel to introduce typos</span>
<span class="sd">     * A Corrector instance, which is the model we want to test</span>

<span class="sd">    Args:</span>
<span class="sd">        fn (Callable): Main tester function (instanciated objects will be</span>
<span class="sd">            attached to this function).</span>
<span class="sd">        lang (str): Language used.</span>
<span class="sd">        custom_keyboard (Dict, optional): If provided, instead of relying on</span>
<span class="sd">            the keyboard layout provided by default, uses the given keyboard</span>
<span class="sd">            layout.</span>
<span class="sd">        correctors (mp.Queue): Queue containing list of correctors to test.</span>
<span class="sd">            Each process will get the next corrector available in queue.</span>
<span class="sd">        seed (int): Base seed to use.</span>
<span class="sd">        track_mistakes (bool): Set to `True` for tracking the most common</span>
<span class="sd">            mistakes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">BasicTokenizer</span><span class="p">()</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">noisy</span> <span class="o">=</span> <span class="n">NoiseModel</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">custom_keyboard</span><span class="o">=</span><span class="n">custom_keyboard</span><span class="p">)</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">corrector</span> <span class="o">=</span> <span class="n">correctors</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">base_seed</span> <span class="o">=</span> <span class="n">seed</span>
    <span class="n">fn</span><span class="o">.</span><span class="n">track_mistakes</span> <span class="o">=</span> <span class="n">track_mistakes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.oracle.tester" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tester</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function to test a given sentence.</p>
<p>It uses the noise model to introduce typos word by word, run the
Corrector on various tasks (auto-completion, auto-correction, next-word
prediction), and score the results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>sentence</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sentence to use as data for the test.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Scorer" href="#kebbie.scorer.Scorer">Scorer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scorer class with the prediction counts for this sentence.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/oracle.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tester</span><span class="p">(</span><span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Scorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to test a given sentence.</span>

<span class="sd">    It uses the noise model to introduce typos word by word, run the</span>
<span class="sd">    Corrector on various tasks (auto-completion, auto-correction, next-word</span>
<span class="sd">    prediction), and score the results.</span>

<span class="sd">    Args:</span>
<span class="sd">        sentence (str): Sentence to use as data for the test.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Scorer class with the prediction counts for this sentence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set the seed for reproducibility, using the hash of the sentence</span>
    <span class="n">hsh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">sentence</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">tester</span><span class="o">.</span><span class="n">base_seed</span> <span class="o">+</span> <span class="n">hsh</span><span class="p">)</span>
    <span class="n">rnd_state</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getstate</span><span class="p">()</span>

    <span class="c1"># Tokenize the sentence into words</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_split</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># Keep track for predictions counts with a local scorer, for this sentence</span>
    <span class="n">scorer</span> <span class="o">=</span> <span class="n">Scorer</span><span class="p">(</span><span class="n">domains</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">track_mistakes</span><span class="o">=</span><span class="n">tester</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">words</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_CHAR_PER_SENTENCE</span><span class="p">:</span>
        <span class="c1"># Before randomly generating typo, set the random state for determinism</span>
        <span class="n">random</span><span class="o">.</span><span class="n">setstate</span><span class="p">(</span><span class="n">rnd_state</span><span class="p">)</span>

        <span class="c1"># It&#39;s slow to generate swipe gesture every sentence, so run it just sometimes</span>
        <span class="n">word_to_swipe</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">swipe_gesture</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">noisy</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="n">word_to_swipe</span><span class="p">)</span> <span class="k">if</span> <span class="n">sample</span><span class="p">(</span><span class="n">SWIPE_PROB</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Generate noisy keystrokes for the next word(s)</span>
        <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_word</span><span class="p">,</span> <span class="n">n_word_typed</span><span class="p">,</span> <span class="n">typos</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">noisy</span><span class="o">.</span><span class="n">type_till_space</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

        <span class="c1"># Get the clean word(s), update the remaining words to type and get the next word</span>
        <span class="n">actual_word</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="n">n_word_typed</span><span class="p">])</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">n_word_typed</span><span class="p">:]</span>
        <span class="n">next_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># We are done with generating typo, save the random state for the next iteration</span>
        <span class="n">rnd_state</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getstate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">swipe_gesture</span><span class="p">:</span>
            <span class="c1"># Call the swipe model</span>
            <span class="n">preds</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">corrector</span><span class="o">.</span><span class="n">profiled_resolve_swipe</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">swipe_gesture</span><span class="p">)</span>
            <span class="n">scorer</span><span class="o">.</span><span class="n">swp</span><span class="p">(</span><span class="n">word_to_swipe</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Call the model for auto-completion (for long enough words)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typed_word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">partial_keystrokes</span><span class="p">,</span> <span class="n">partial_word</span> <span class="o">=</span> <span class="n">sample_partial_word</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_word</span><span class="p">,</span> <span class="n">actual_word</span><span class="p">)</span>
            <span class="n">preds</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">corrector</span><span class="o">.</span><span class="n">profiled_auto_complete</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">partial_keystrokes</span><span class="p">,</span> <span class="n">partial_word</span><span class="p">)</span>
            <span class="n">scorer</span><span class="o">.</span><span class="n">acp</span><span class="p">(</span><span class="n">actual_word</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">partial_word</span><span class="o">=</span><span class="n">partial_word</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Call the model for auto-correction</span>
        <span class="n">preds</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">corrector</span><span class="o">.</span><span class="n">profiled_auto_correct</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">keystrokes</span><span class="p">,</span> <span class="n">typed_word</span><span class="p">)</span>
        <span class="n">scorer</span><span class="o">.</span><span class="n">acr</span><span class="p">(</span>
            <span class="n">actual_word</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">typed_word</span><span class="o">=</span><span class="n">typed_word</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">typos</span><span class="o">=</span><span class="n">typos</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span>
        <span class="p">)</span>

        <span class="c1"># Update the context for the next iteration (input forcing)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">update_context</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">actual_word</span><span class="p">)</span>

        <span class="c1"># Call the model for next-word prediction</span>
        <span class="k">if</span> <span class="n">next_word</span><span class="p">:</span>
            <span class="n">preds</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">corrector</span><span class="o">.</span><span class="n">profiled_predict_next_word</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="n">scorer</span><span class="o">.</span><span class="n">nwp</span><span class="p">(</span><span class="n">next_word</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scorer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="scorerpy"><code>scorer.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module implementing <code>Scorer</code>, a class that keep track of how many errors
the model is making, and output various corresponding metrics.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.scorer.Count" class="doc doc-heading">
            <code>Count</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Structure representing the most basic counts for a task.</p>
<p>It counts :
* Number of correct predictions
* Number of top3-correct predictions
* Total number of predictions</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/scorer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Count</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structure representing the most basic counts for a task.</span>

<span class="sd">    It counts :</span>
<span class="sd">    * Number of correct predictions</span>
<span class="sd">    * Number of top3-correct predictions</span>
<span class="sd">    * Total number of predictions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">correct</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of times the first prediction was correct</span>
    <span class="n">correct_3</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of times one of the top-3 predictions was correct</span>
    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Total number of predictions</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">Count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Count</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge two `Count` instance by adding their counts.</span>

<span class="sd">        Args:</span>
<span class="sd">            count (Count): Count instance to add.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Merged Count.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Count</span><span class="p">(</span>
            <span class="n">correct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">correct</span><span class="p">,</span>
            <span class="n">correct_3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">correct_3</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Count</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiply the current `Count` instance by a given proportion.</span>

<span class="sd">        Args:</span>
<span class="sd">            proportion (float): Proportion to multiply by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Count with the right proportion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Count</span><span class="p">(</span>
            <span class="n">correct</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
            <span class="n">correct_3</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Count.__add__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__add__</span><span class="p">(</span><span class="n">count</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Merge two <code>Count</code> instance by adding their counts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>count</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count instance to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Merged Count.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">Count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Count</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge two `Count` instance by adding their counts.</span>

<span class="sd">    Args:</span>
<span class="sd">        count (Count): Count instance to add.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Merged Count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Count</span><span class="p">(</span>
        <span class="n">correct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">correct</span><span class="p">,</span>
        <span class="n">correct_3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">correct_3</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Count.__mul__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__mul__</span><span class="p">(</span><span class="n">proportion</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Multiply the current <code>Count</code> instance by a given proportion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>proportion</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportion to multiply by.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count with the right proportion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Count</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply the current `Count` instance by a given proportion.</span>

<span class="sd">    Args:</span>
<span class="sd">        proportion (float): Proportion to multiply by.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Count with the right proportion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Count</span><span class="p">(</span>
        <span class="n">correct</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
        <span class="n">correct_3</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.scorer.Mistake" class="doc doc-heading">
            <code>Mistake</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Structure representing a mistake (including the context of the mistake,
the expected word and the predictions).</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/scorer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Mistake</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structure representing a mistake (including the context of the mistake,</span>
<span class="sd">    the expected word and the predictions).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">actual</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">preds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kebbie.scorer.Scorer" class="doc doc-heading">
            <code>Scorer</code>


</h3>


    <div class="doc doc-contents ">


      <p>Class keeping track of the predictions and how correct they are, but
also computing the associated score for each task after the end of test.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>domains</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of domains in the dataset. The Scorer
keeps track of the score for each domain, so that we can spot
discrepancies between domain, if any.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>human_readable</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set to <code>False</code>, performance metrics
(memory, runtime) are kept in their raw, numeral form. If set to
<code>True</code>, these are converted to a human readable string.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>track_mistakes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set to <code>True</code> for tracking the most
common mistakes.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>kebbie/scorer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Scorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class keeping track of the predictions and how correct they are, but</span>
<span class="sd">    also computing the associated score for each task after the end of test.</span>

<span class="sd">    Args:</span>
<span class="sd">        domains (List[str]): The list of domains in the dataset. The Scorer</span>
<span class="sd">            keeps track of the score for each domain, so that we can spot</span>
<span class="sd">            discrepancies between domain, if any.</span>
<span class="sd">        human_readable (bool, optional): If set to `False`, performance metrics</span>
<span class="sd">            (memory, runtime) are kept in their raw, numeral form. If set to</span>
<span class="sd">            `True`, these are converted to a human readable string.</span>
<span class="sd">        track_mistakes (bool, optional): Set to `True` for tracking the most</span>
<span class="sd">            common mistakes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domains</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">human_readable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">track_mistakes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">human_readable</span> <span class="o">=</span> <span class="n">human_readable</span>

        <span class="c1"># For each task, create a dictionary of Counts</span>
        <span class="c1"># Each task has a different structure :</span>

        <span class="c1"># Next-word prediction : [domain] -&gt; counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span> <span class="o">=</span> <span class="n">dd_x_layers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Autocompletion : [domain] -&gt; [typo/no_typo] -&gt; [word_completion_rate] -&gt; counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span> <span class="o">=</span> <span class="n">dd_x_layers</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Autocorrection : [domain] -&gt; [typo type/number of typo] -&gt; counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span> <span class="o">=</span> <span class="n">dd_x_layers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Swipe resolution : [domain] -&gt; counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span> <span class="o">=</span> <span class="n">dd_x_layers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Make sure we track each domain (create a 0-Count for each domain)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">WITH_TYPO</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

        <span class="c1"># Also keep track of memories &amp; runtimes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Optionally track common mistakes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span> <span class="o">=</span> <span class="n">track_mistakes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_mistakes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_mistakes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_mistakes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_mistakes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scorer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to update the current Scorer with the counts from another</span>
<span class="sd">        Scorer.</span>

<span class="sd">        Args:</span>
<span class="sd">            scorer (Scorer): Scorer to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Count</span><span class="p">):</span>
                    <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">update</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">acp_c</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">acr_c</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">swp_c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_memories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_memories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_memories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_memories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nwp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the next-word prediction</span>
<span class="sd">        task.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_word (str): The label (clean word to predict).</span>
<span class="sd">            predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">            context (str): The context (previous words in the sentence).</span>
<span class="sd">            memory (int): Memory consumption for the call of the model.</span>
<span class="sd">            runtime (int): Runtime for the call of the model.</span>
<span class="sd">            domain (str): Domain of this prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Record memory &amp; runtime</span>
        <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Record counts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">acp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">partial_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the auto-completion task.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_word (str): The label (clean word to predict).</span>
<span class="sd">            predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">            partial_word (str): The input sent to the model (only part of the</span>
<span class="sd">                word to predict, with potential typos).</span>
<span class="sd">            context (str): The context (previous words in the sentence).</span>
<span class="sd">            memory (int): Memory consumption for the call of the model.</span>
<span class="sd">            runtime (int): Runtime for the call of the model.</span>
<span class="sd">            domain (str): Domain of this prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Record memory &amp; runtime</span>
        <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Check if a typo was introduced or not</span>
        <span class="n">has_typo</span> <span class="o">=</span> <span class="n">WITHOUT_TYPO</span> <span class="k">if</span> <span class="n">true_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">partial_word</span><span class="p">)</span> <span class="k">else</span> <span class="n">WITH_TYPO</span>

        <span class="c1"># Compute the completion rate</span>
        <span class="n">completion_rate</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partial_word</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_word</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Record counts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}{</span><span class="n">partial_word</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">acr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">typed_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">typos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">],</span>
        <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the auto-correction task.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_word (str): The label (clean word to predict).</span>
<span class="sd">            predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">            typed_word (str): The word typed, containing potential typos.</span>
<span class="sd">            context (str): The context (previous words in the sentence).</span>
<span class="sd">            typos (List[Typo]): List of typos introduced.</span>
<span class="sd">            memory (int): Memory consumption for the call of the model.</span>
<span class="sd">            runtime (int): Runtime for the call of the model.</span>
<span class="sd">            domain (str): Domain of this prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Record memory &amp; runtime</span>
        <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Get the type of typo</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">typos</span><span class="p">:</span>
            <span class="n">typo_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">typos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">typo_type</span> <span class="o">=</span> <span class="n">typos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">typo_type</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">typos</span><span class="p">)</span>

        <span class="c1"># Record counts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}{</span><span class="n">typed_word</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">swp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the swipe resolution task.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_word (str): The label (clean word to predict).</span>
<span class="sd">            predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">            context (str): The context (previous words in the sentence).</span>
<span class="sd">            memory (int): Memory consumption for the call of the model.</span>
<span class="sd">            runtime (int): Runtime for the call of the model.</span>
<span class="sd">            domain (str): Domain of this prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Record memory &amp; runtime</span>
        <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

        <span class="c1"># Record counts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">set_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method setting the domain for the scores associated with no domain.</span>

<span class="sd">        To make it easier to score a single sentence, it&#39;s possible to call the</span>
<span class="sd">        scorer without a domain (see signature of `nwp()`, `acp()`, `acr()`).</span>
<span class="sd">        In this case the scores are associated to no domain (`None` key).</span>
<span class="sd">        This method allows the user to set the domain name for these scores</span>
<span class="sd">        with no domain (effectively moving the `None` domain scores to the</span>
<span class="sd">        given domain name).</span>

<span class="sd">        Note:</span>
<span class="sd">            If some scores were already linked to the given domain, these</span>
<span class="sd">            scores will be erased (replaced by the scores of the `None`</span>
<span class="sd">            domain).</span>

<span class="sd">        Args:</span>
<span class="sd">            domain (str): Domain name to associate the scores to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to compute the accuracy given a prediction count.</span>

<span class="sd">        This method return a dictionary with 3 metrics :</span>
<span class="sd">         * Accuracy</span>
<span class="sd">         * Top3 accuracy</span>
<span class="sd">         * Total number of predictions</span>

<span class="sd">        Args:</span>
<span class="sd">            c (Count): Count object to use to compute the accuracy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the computed metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">correct</span> <span class="o">/</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;top3_accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">/</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_score_precision_recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_typo_c</span><span class="p">:</span> <span class="n">Count</span><span class="p">,</span> <span class="n">typo_c</span><span class="p">:</span> <span class="n">Count</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to compute the precision and recall for</span>
<span class="sd">        auto-correction.</span>

<span class="sd">        This method return a dictionary with several metrics :</span>
<span class="sd">         * Accuracy</span>
<span class="sd">         * Precision</span>
<span class="sd">         * Recall</span>
<span class="sd">         * F-score</span>
<span class="sd">         * Top3 accuracy</span>
<span class="sd">         * Top3 precision</span>
<span class="sd">         * Top3 recall</span>
<span class="sd">         * Top3 F-score</span>
<span class="sd">         * Number of predictions with a typo</span>
<span class="sd">         * Total number of predictions</span>

<span class="sd">        For auto-correction, we need 2 Count objects : the counts of typos, and</span>
<span class="sd">        the counts of non-typo (to compute the True Negative and False Positive</span>
<span class="sd">        metrics).</span>

<span class="sd">        Args:</span>
<span class="sd">            no_typo_c (Count): Count object for the predictions where no typo</span>
<span class="sd">                were added.</span>
<span class="sd">            typo_c (Count): Count object for the predictions where typos were</span>
<span class="sd">                added.</span>
<span class="sd">            beta (float): Beta to use for computing the F-beta score.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the computed metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The first step is to divide the counts into TN, FP, TP, FN</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct</span>

        <span class="n">tn_3</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct_3</span>
        <span class="n">fp_3</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct_3</span>
        <span class="n">tp_3</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct_3</span>
        <span class="n">fn_3</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct_3</span>

        <span class="c1"># Then we compute the metrics</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>

        <span class="n">p_3</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp_3</span><span class="p">)</span>
        <span class="n">r_3</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn_3</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="o">=</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)),</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">p</span><span class="p">),</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
            <span class="s2">&quot;fscore&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)),</span>
            <span class="s2">&quot;top3_accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">tn</span><span class="o">=</span><span class="n">tn_3</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp_3</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn_3</span><span class="p">)),</span>
            <span class="s2">&quot;top3_precision&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">p_3</span><span class="p">),</span>
            <span class="s2">&quot;top3_recall&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">r_3</span><span class="p">),</span>
            <span class="s2">&quot;top3_fscore&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">p_3</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="n">r_3</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)),</span>
            <span class="s2">&quot;n_typo&quot;</span><span class="p">:</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">+</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">runtimes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to compute metrics related to the memory &amp; runtime.</span>

<span class="sd">        This method returns a dictionary with several metrics :</span>
<span class="sd">         * The mean memory consumption</span>
<span class="sd">         * The min memory consumption</span>
<span class="sd">         * The max memory consumption</span>
<span class="sd">         * The mean running time</span>
<span class="sd">         * The fastest running time</span>
<span class="sd">         * The slowest running time</span>

<span class="sd">        Args:</span>
<span class="sd">            memories (List[int]): List of memories consumptions for a</span>
<span class="sd">                specific operation.</span>
<span class="sd">            runtimes (List[int]): List of runtimes for a specific operation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the computed metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">perf</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mean_memory&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;min_memory&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;max_memory&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;mean_runtime&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;fastest_runtime&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;slowest_runtime&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable</span><span class="p">:</span>
            <span class="n">perf</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">human_readable_memory</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">human_readable_runtime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">perf</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">perf</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BETA</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>  <span class="c1"># noqa: C901</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method that computes the final scores (as well as some alternative</span>
<span class="sd">        metrics that can bring insight in the capabilities of the model), and</span>
<span class="sd">        output these in an organized dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            beta (float, optional): Beta to use for computing the F-beta score.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing the computed scores and metrics for the</span>
<span class="sd">            model tested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># --- Next-word prediction ---</span>
        <span class="c1"># Group scores by domain</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
        <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Task results</span>
        <span class="n">nwp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
            <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
            <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># --- Auto-completion ---</span>
        <span class="c1"># Group scores by domain</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
        <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Group scores by completion rate</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">per</span><span class="p">[</span><span class="n">compl_rate</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">per_compl_rate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;&lt;25%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
            <span class="s2">&quot;25%~50%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.25</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
            <span class="s2">&quot;50%~75%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
            <span class="s2">&quot;&gt;75%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.75</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
        <span class="p">}</span>

        <span class="c1"># Group scores by with_typo / without_typo</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">per</span><span class="p">[</span><span class="n">has_typo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">per_other</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">WITHOUT_TYPO</span><span class="p">,</span> <span class="n">WITH_TYPO</span><span class="p">]}</span>

        <span class="c1"># Task results</span>
        <span class="n">acp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
            <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
            <span class="s2">&quot;per_completion_rate&quot;</span><span class="p">:</span> <span class="n">per_compl_rate</span><span class="p">,</span>
            <span class="s2">&quot;per_other&quot;</span><span class="p">:</span> <span class="n">per_other</span><span class="p">,</span>
            <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># --- Auto-correction ---</span>
        <span class="c1"># Group scores by domain</span>
        <span class="n">no_typo_per</span><span class="p">,</span> <span class="n">typo_per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">),</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">typo</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">no_typo_per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">typo_per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">no_typo_total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">no_typo_per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
        <span class="n">typo_total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">typo_per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
        <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="p">}</span>

        <span class="c1"># Group scores by typo type</span>
        <span class="n">no_typo_c</span><span class="p">,</span> <span class="n">typo_per</span> <span class="o">=</span> <span class="n">Count</span><span class="p">(),</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">typo</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">no_typo_c</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">typo_per</span><span class="p">[</span><span class="n">typo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="c1"># Divide the total count of no-typo into each type of typos with the right proportions</span>
        <span class="n">no_typo_per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">no_typo_c</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="n">typo_total_c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="n">per_typo_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Typo</span><span class="p">}</span>
        <span class="n">per_n_typo</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Typo</span><span class="p">)),</span> <span class="n">Count</span><span class="p">()),</span>
                <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Typo</span><span class="p">)),</span> <span class="n">Count</span><span class="p">()),</span>
                <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">),</span>
            <span class="s2">&quot;3+&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Count</span><span class="p">()),</span>
                <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Count</span><span class="p">()),</span>
                <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Task results</span>
        <span class="n">acr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_total_c</span><span class="p">,</span> <span class="n">typo_total_c</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">),</span>
            <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
            <span class="s2">&quot;per_typo_type&quot;</span><span class="p">:</span> <span class="n">per_typo_type</span><span class="p">,</span>
            <span class="s2">&quot;per_number_of_typos&quot;</span><span class="p">:</span> <span class="n">per_n_typo</span><span class="p">,</span>
            <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># --- Swipe resolution ---</span>
        <span class="c1"># Group scores by domain</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
        <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Task results</span>
        <span class="n">swp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
            <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
            <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Final results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;next_word_prediction&quot;</span><span class="p">:</span> <span class="n">nwp</span><span class="p">,</span>
            <span class="s2">&quot;auto_completion&quot;</span><span class="p">:</span> <span class="n">acp</span><span class="p">,</span>
            <span class="s2">&quot;auto_correction&quot;</span><span class="p">:</span> <span class="n">acr</span><span class="p">,</span>
            <span class="s2">&quot;swipe_resolution&quot;</span><span class="p">:</span> <span class="n">swp</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Add the overall score</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_score</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">scorer</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method to update the current Scorer with the counts from another
Scorer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>scorer</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Scorer" href="#kebbie.scorer.Scorer">Scorer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scorer to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scorer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to update the current Scorer with the counts from another</span>
<span class="sd">    Scorer.</span>

<span class="sd">    Args:</span>
<span class="sd">        scorer (Scorer): Scorer to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Count</span><span class="p">):</span>
                <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">)</span>
    <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">acp_c</span><span class="p">)</span>
    <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">acr_c</span><span class="p">)</span>
    <span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">,</span> <span class="n">scorer</span><span class="o">.</span><span class="n">swp_c</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_memories</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_memories</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_memories</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_memories</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scorer</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.nwp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nwp</span><span class="p">(</span><span class="n">true_word</span><span class="p">,</span> <span class="n">predicted_words</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method used to record a prediction for the next-word prediction
task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>true_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The label (clean word to predict).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>predicted_words</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predictions of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context (previous words in the sentence).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>memory</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory consumption for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>runtime</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>domain</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain of this prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nwp</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the next-word prediction</span>
<span class="sd">    task.</span>

<span class="sd">    Args:</span>
<span class="sd">        true_word (str): The label (clean word to predict).</span>
<span class="sd">        predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">        context (str): The context (previous words in the sentence).</span>
<span class="sd">        memory (int): Memory consumption for the call of the model.</span>
<span class="sd">        runtime (int): Runtime for the call of the model.</span>
<span class="sd">        domain (str): Domain of this prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Record memory &amp; runtime</span>
    <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Record counts</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nwp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.acp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">acp</span><span class="p">(</span><span class="n">true_word</span><span class="p">,</span> <span class="n">predicted_words</span><span class="p">,</span> <span class="n">partial_word</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method used to record a prediction for the auto-completion task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>true_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The label (clean word to predict).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>predicted_words</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predictions of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input sent to the model (only part of the
word to predict, with potential typos).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context (previous words in the sentence).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>memory</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory consumption for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>runtime</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>domain</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain of this prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">acp</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">partial_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the auto-completion task.</span>

<span class="sd">    Args:</span>
<span class="sd">        true_word (str): The label (clean word to predict).</span>
<span class="sd">        predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">        partial_word (str): The input sent to the model (only part of the</span>
<span class="sd">            word to predict, with potential typos).</span>
<span class="sd">        context (str): The context (previous words in the sentence).</span>
<span class="sd">        memory (int): Memory consumption for the call of the model.</span>
<span class="sd">        runtime (int): Runtime for the call of the model.</span>
<span class="sd">        domain (str): Domain of this prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Record memory &amp; runtime</span>
    <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Check if a typo was introduced or not</span>
    <span class="n">has_typo</span> <span class="o">=</span> <span class="n">WITHOUT_TYPO</span> <span class="k">if</span> <span class="n">true_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">partial_word</span><span class="p">)</span> <span class="k">else</span> <span class="n">WITH_TYPO</span>

    <span class="c1"># Compute the completion rate</span>
    <span class="n">completion_rate</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partial_word</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_word</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Record counts</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">[</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}{</span><span class="n">partial_word</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">has_typo</span><span class="p">][</span><span class="n">completion_rate</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.acr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">acr</span><span class="p">(</span><span class="n">true_word</span><span class="p">,</span> <span class="n">predicted_words</span><span class="p">,</span> <span class="n">typed_word</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">typos</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method used to record a prediction for the auto-correction task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>true_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The label (clean word to predict).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>predicted_words</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predictions of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>typed_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The word typed, containing potential typos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context (previous words in the sentence).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>typos</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kebbie.noise_model.Typo" href="#kebbie.noise_model.Typo">Typo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of typos introduced.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>memory</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory consumption for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>runtime</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>domain</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain of this prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">acr</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">typed_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">typos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Typo</span><span class="p">],</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the auto-correction task.</span>

<span class="sd">    Args:</span>
<span class="sd">        true_word (str): The label (clean word to predict).</span>
<span class="sd">        predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">        typed_word (str): The word typed, containing potential typos.</span>
<span class="sd">        context (str): The context (previous words in the sentence).</span>
<span class="sd">        typos (List[Typo]): List of typos introduced.</span>
<span class="sd">        memory (int): Memory consumption for the call of the model.</span>
<span class="sd">        runtime (int): Runtime for the call of the model.</span>
<span class="sd">        domain (str): Domain of this prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Record memory &amp; runtime</span>
    <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Get the type of typo</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">typos</span><span class="p">:</span>
        <span class="n">typo_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">typos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">typo_type</span> <span class="o">=</span> <span class="n">typos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">typo_type</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">typos</span><span class="p">)</span>

    <span class="c1"># Record counts</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acr_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">[</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}{</span><span class="n">typed_word</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">typo_type</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.swp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">swp</span><span class="p">(</span><span class="n">true_word</span><span class="p">,</span> <span class="n">predicted_words</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method used to record a prediction for the swipe resolution task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>true_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The label (clean word to predict).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>predicted_words</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predictions of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context (previous words in the sentence).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>memory</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory consumption for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>runtime</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime for the call of the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>domain</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain of this prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swp</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicted_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">runtime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method used to record a prediction for the swipe resolution task.</span>

<span class="sd">    Args:</span>
<span class="sd">        true_word (str): The label (clean word to predict).</span>
<span class="sd">        predicted_words (List[str]): Predictions of the model.</span>
<span class="sd">        context (str): The context (previous words in the sentence).</span>
<span class="sd">        memory (int): Memory consumption for the call of the model.</span>
<span class="sd">        runtime (int): Runtime for the call of the model.</span>
<span class="sd">        domain (str): Domain of this prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Record memory &amp; runtime</span>
    <span class="k">if</span> <span class="n">memory</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Record counts</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">predicted_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">true_word</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">true_word</span> <span class="ow">in</span> <span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the word is not in the top-3 predictions, this is a mistake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_mistakes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swp_mistakes</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">Mistake</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">true_word</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">predicted_words</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.set_domain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method setting the domain for the scores associated with no domain.</p>
<p>To make it easier to score a single sentence, it's possible to call the
scorer without a domain (see signature of <code>nwp()</code>, <code>acp()</code>, <code>acr()</code>).
In this case the scores are associated to no domain (<code>None</code> key).
This method allows the user to set the domain name for these scores
with no domain (effectively moving the <code>None</code> domain scores to the
given domain name).</p>


<details class="note" open>
  <summary>Note</summary>
  <p>If some scores were already linked to the given domain, these
scores will be erased (replaced by the scores of the <code>None</code>
domain).</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>domain</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain name to associate the scores to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method setting the domain for the scores associated with no domain.</span>

<span class="sd">    To make it easier to score a single sentence, it&#39;s possible to call the</span>
<span class="sd">    scorer without a domain (see signature of `nwp()`, `acp()`, `acr()`).</span>
<span class="sd">    In this case the scores are associated to no domain (`None` key).</span>
<span class="sd">    This method allows the user to set the domain name for these scores</span>
<span class="sd">    with no domain (effectively moving the `None` domain scores to the</span>
<span class="sd">    given domain name).</span>

<span class="sd">    Note:</span>
<span class="sd">        If some scores were already linked to the given domain, these</span>
<span class="sd">        scores will be erased (replaced by the scores of the `None`</span>
<span class="sd">        domain).</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (str): Domain name to associate the scores to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer._score_accuracy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Helper method to compute the accuracy given a prediction count.</p>


<details class="this-method-return-a-dictionary-with-3-metrics-" open>
  <summary>This method return a dictionary with 3 metrics</summary>
  <ul>
<li>Accuracy</li>
<li>Top3 accuracy</li>
<li>Total number of predictions</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>c</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count object to use to compute the accuracy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the computed metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_score_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to compute the accuracy given a prediction count.</span>

<span class="sd">    This method return a dictionary with 3 metrics :</span>
<span class="sd">     * Accuracy</span>
<span class="sd">     * Top3 accuracy</span>
<span class="sd">     * Total number of predictions</span>

<span class="sd">    Args:</span>
<span class="sd">        c (Count): Count object to use to compute the accuracy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the computed metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">correct</span> <span class="o">/</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;top3_accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">correct_3</span> <span class="o">/</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer._score_precision_recall" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_c</span><span class="p">,</span> <span class="n">typo_c</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Helper method to compute the precision and recall for
auto-correction.</p>


<details class="this-method-return-a-dictionary-with-several-metrics-" open>
  <summary>This method return a dictionary with several metrics</summary>
  <ul>
<li>Accuracy</li>
<li>Precision</li>
<li>Recall</li>
<li>F-score</li>
<li>Top3 accuracy</li>
<li>Top3 precision</li>
<li>Top3 recall</li>
<li>Top3 F-score</li>
<li>Number of predictions with a typo</li>
<li>Total number of predictions</li>
</ul>
</details>      <p>For auto-correction, we need 2 Count objects : the counts of typos, and
the counts of non-typo (to compute the True Negative and False Positive
metrics).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>no_typo_c</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count object for the predictions where no typo
were added.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>typo_c</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.Count" href="#kebbie.scorer.Count">Count</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count object for the predictions where typos were
added.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>beta</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Beta to use for computing the F-beta score.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the computed metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_score_precision_recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_typo_c</span><span class="p">:</span> <span class="n">Count</span><span class="p">,</span> <span class="n">typo_c</span><span class="p">:</span> <span class="n">Count</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to compute the precision and recall for</span>
<span class="sd">    auto-correction.</span>

<span class="sd">    This method return a dictionary with several metrics :</span>
<span class="sd">     * Accuracy</span>
<span class="sd">     * Precision</span>
<span class="sd">     * Recall</span>
<span class="sd">     * F-score</span>
<span class="sd">     * Top3 accuracy</span>
<span class="sd">     * Top3 precision</span>
<span class="sd">     * Top3 recall</span>
<span class="sd">     * Top3 F-score</span>
<span class="sd">     * Number of predictions with a typo</span>
<span class="sd">     * Total number of predictions</span>

<span class="sd">    For auto-correction, we need 2 Count objects : the counts of typos, and</span>
<span class="sd">    the counts of non-typo (to compute the True Negative and False Positive</span>
<span class="sd">    metrics).</span>

<span class="sd">    Args:</span>
<span class="sd">        no_typo_c (Count): Count object for the predictions where no typo</span>
<span class="sd">            were added.</span>
<span class="sd">        typo_c (Count): Count object for the predictions where typos were</span>
<span class="sd">            added.</span>
<span class="sd">        beta (float): Beta to use for computing the F-beta score.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the computed metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The first step is to divide the counts into TN, FP, TP, FN</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct</span>

    <span class="n">tn_3</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct_3</span>
    <span class="n">fp_3</span> <span class="o">=</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">correct_3</span>
    <span class="n">tp_3</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct_3</span>
    <span class="n">fn_3</span> <span class="o">=</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">correct_3</span>

    <span class="c1"># Then we compute the metrics</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>

    <span class="n">p_3</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp_3</span><span class="p">)</span>
    <span class="n">r_3</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn_3</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="o">=</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)),</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">p</span><span class="p">),</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
        <span class="s2">&quot;fscore&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)),</span>
        <span class="s2">&quot;top3_accuracy&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="o">=</span><span class="n">tp_3</span><span class="p">,</span> <span class="n">tn</span><span class="o">=</span><span class="n">tn_3</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp_3</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn_3</span><span class="p">)),</span>
        <span class="s2">&quot;top3_precision&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">p_3</span><span class="p">),</span>
        <span class="s2">&quot;top3_recall&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">r_3</span><span class="p">),</span>
        <span class="s2">&quot;top3_fscore&quot;</span><span class="p">:</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">p_3</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="n">r_3</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)),</span>
        <span class="s2">&quot;n_typo&quot;</span><span class="p">:</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
        <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">no_typo_c</span><span class="o">.</span><span class="n">total</span> <span class="o">+</span> <span class="n">typo_c</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer._score_performances" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_score_performances</span><span class="p">(</span><span class="n">memories</span><span class="p">,</span> <span class="n">runtimes</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Helper method to compute metrics related to the memory &amp; runtime.</p>


<details class="this-method-returns-a-dictionary-with-several-metrics-" open>
  <summary>This method returns a dictionary with several metrics</summary>
  <ul>
<li>The mean memory consumption</li>
<li>The min memory consumption</li>
<li>The max memory consumption</li>
<li>The mean running time</li>
<li>The fastest running time</li>
<li>The slowest running time</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>memories</code></td>
            <td>
                  <code><span title="typing.List">List</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of memories consumptions for a
specific operation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>runtimes</code></td>
            <td>
                  <code><span title="typing.List">List</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of runtimes for a specific operation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the computed metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">runtimes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to compute metrics related to the memory &amp; runtime.</span>

<span class="sd">    This method returns a dictionary with several metrics :</span>
<span class="sd">     * The mean memory consumption</span>
<span class="sd">     * The min memory consumption</span>
<span class="sd">     * The max memory consumption</span>
<span class="sd">     * The mean running time</span>
<span class="sd">     * The fastest running time</span>
<span class="sd">     * The slowest running time</span>

<span class="sd">    Args:</span>
<span class="sd">        memories (List[int]): List of memories consumptions for a</span>
<span class="sd">            specific operation.</span>
<span class="sd">        runtimes (List[int]): List of runtimes for a specific operation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the computed metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">perf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mean_memory&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;min_memory&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;max_memory&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;mean_runtime&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;fastest_runtime&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;slowest_runtime&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">runtimes</span><span class="p">)</span> <span class="k">if</span> <span class="n">runtimes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable</span><span class="p">:</span>
        <span class="n">perf</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">human_readable_memory</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">human_readable_runtime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">perf</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">perf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.scorer.Scorer.score" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">score</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">DEFAULT_BETA</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method that computes the final scores (as well as some alternative
metrics that can bring insight in the capabilities of the model), and
output these in an organized dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>beta</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Beta to use for computing the F-beta score.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="kebbie.scorer.DEFAULT_BETA" href="#kebbie.scorer.DEFAULT_BETA">DEFAULT_BETA</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing the computed scores and metrics for the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model tested.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BETA</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>  <span class="c1"># noqa: C901</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method that computes the final scores (as well as some alternative</span>
<span class="sd">    metrics that can bring insight in the capabilities of the model), and</span>
<span class="sd">    output these in an organized dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        beta (float, optional): Beta to use for computing the F-beta score.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing the computed scores and metrics for the</span>
<span class="sd">        model tested.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Next-word prediction ---</span>
    <span class="c1"># Group scores by domain</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
    <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Task results</span>
    <span class="n">nwp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
        <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
        <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwp_runtimes</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># --- Auto-completion ---</span>
    <span class="c1"># Group scores by domain</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
    <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Group scores by completion rate</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">per</span><span class="p">[</span><span class="n">compl_rate</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">per_compl_rate</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;&lt;25%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
        <span class="s2">&quot;25%~50%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.25</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
        <span class="s2">&quot;50%~75%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
        <span class="s2">&quot;&gt;75%&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="mf">0.75</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">),</span> <span class="n">Count</span><span class="p">())),</span>
    <span class="p">}</span>

    <span class="c1"># Group scores by with_typo / without_typo</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">has_typo</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">compl_rate</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">per</span><span class="p">[</span><span class="n">has_typo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">per_other</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">WITHOUT_TYPO</span><span class="p">,</span> <span class="n">WITH_TYPO</span><span class="p">]}</span>

    <span class="c1"># Task results</span>
    <span class="n">acp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
        <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
        <span class="s2">&quot;per_completion_rate&quot;</span><span class="p">:</span> <span class="n">per_compl_rate</span><span class="p">,</span>
        <span class="s2">&quot;per_other&quot;</span><span class="p">:</span> <span class="n">per_other</span><span class="p">,</span>
        <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acp_runtimes</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># --- Auto-correction ---</span>
    <span class="c1"># Group scores by domain</span>
    <span class="n">no_typo_per</span><span class="p">,</span> <span class="n">typo_per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">),</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">typo</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">no_typo_per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">typo_per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">no_typo_total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">no_typo_per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
    <span class="n">typo_total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">typo_per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
    <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="p">}</span>

    <span class="c1"># Group scores by typo type</span>
    <span class="n">no_typo_c</span><span class="p">,</span> <span class="n">typo_per</span> <span class="o">=</span> <span class="n">Count</span><span class="p">(),</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">d1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">typo</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">typo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">no_typo_c</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">typo_per</span><span class="p">[</span><span class="n">typo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="c1"># Divide the total count of no-typo into each type of typos with the right proportions</span>
    <span class="n">no_typo_per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">no_typo_c</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="n">typo_total_c</span><span class="o">.</span><span class="n">total</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
    <span class="n">per_typo_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Typo</span><span class="p">}</span>
    <span class="n">per_n_typo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span>
            <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Typo</span><span class="p">)),</span> <span class="n">Count</span><span class="p">()),</span>
            <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Typo</span><span class="p">)),</span> <span class="n">Count</span><span class="p">()),</span>
            <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_per</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typo_per</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">),</span>
        <span class="s2">&quot;3+&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span>
            <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">no_typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Count</span><span class="p">()),</span>
            <span class="nb">sum</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">typo_per</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Count</span><span class="p">()),</span>
            <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Task results</span>
    <span class="n">acr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_precision_recall</span><span class="p">(</span><span class="n">no_typo_total_c</span><span class="p">,</span> <span class="n">typo_total_c</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">),</span>
        <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
        <span class="s2">&quot;per_typo_type&quot;</span><span class="p">:</span> <span class="n">per_typo_type</span><span class="p">,</span>
        <span class="s2">&quot;per_number_of_typos&quot;</span><span class="p">:</span> <span class="n">per_n_typo</span><span class="p">,</span>
        <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acr_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acr_runtimes</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># --- Swipe resolution ---</span>
    <span class="c1"># Group scores by domain</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">per</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">total_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Count</span><span class="p">())</span>
    <span class="n">per_domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">per</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Task results</span>
    <span class="n">swp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_accuracy</span><span class="p">(</span><span class="n">total_c</span><span class="p">),</span>
        <span class="s2">&quot;per_domain&quot;</span><span class="p">:</span> <span class="n">per_domain</span><span class="p">,</span>
        <span class="s2">&quot;performances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_performances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swp_memories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swp_runtimes</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Final results</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;next_word_prediction&quot;</span><span class="p">:</span> <span class="n">nwp</span><span class="p">,</span>
        <span class="s2">&quot;auto_completion&quot;</span><span class="p">:</span> <span class="n">acp</span><span class="p">,</span>
        <span class="s2">&quot;auto_correction&quot;</span><span class="p">:</span> <span class="n">acr</span><span class="p">,</span>
        <span class="s2">&quot;swipe_resolution&quot;</span><span class="p">:</span> <span class="n">swp</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Add the overall score</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_score</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="kebbie.scorer.dd_x_layers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dd_x_layers</span><span class="p">(</span><span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Helper function for creating a nested defaultdict, with a specified
number of nest level. The end object is a Count.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n_layers</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of layer for the defaultdict.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.defaultdict">defaultdict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Created nested defaultdict.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dd_x_layers</span><span class="p">(</span><span class="n">n_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">defaultdict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function for creating a nested defaultdict, with a specified</span>
<span class="sd">    number of nest level. The end object is a Count.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_layers (int): Number of layer for the defaultdict.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Created nested defaultdict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">n_layers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;A default dict have at least 1 layer (</span><span class="si">{</span><span class="n">n_layers</span><span class="si">}</span><span class="s2"> given)&quot;</span>
    <span class="k">if</span> <span class="n">n_layers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">dd_x_layers</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="n">n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.scorer.one_score" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one_score</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>One Score to rule them all, One Score to find them, One Score to bring
them all and in the darkness bind them.</p>
<p>This function is here to gather the various testing metrics of a JET file
in a single number, to easily compare models.</p>
<p>We take a single metric for each task, and weight them based on the
importance of the task (these metrics already have the same scale : between
0 and 1).</p>
<p>For NWP and ACP we take a top-3 metric, because these tasks usually involve
a user action from a proposed list. For ACR and SWP, we take a top-1
metric, since usually it's automatically applied without user input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>results</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Testing results. Should be a dictionary containing all
the metrics (used to compute the one score).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One score, computed from the results given.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/scorer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">one_score</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;One Score to rule them all, One Score to find them, One Score to bring</span>
<span class="sd">    them all and in the darkness bind them.</span>

<span class="sd">    This function is here to gather the various testing metrics of a JET file</span>
<span class="sd">    in a single number, to easily compare models.</span>

<span class="sd">    We take a single metric for each task, and weight them based on the</span>
<span class="sd">    importance of the task (these metrics already have the same scale : between</span>
<span class="sd">    0 and 1).</span>

<span class="sd">    For NWP and ACP we take a top-3 metric, because these tasks usually involve</span>
<span class="sd">    a user action from a proposed list. For ACR and SWP, we take a top-1</span>
<span class="sd">    metric, since usually it&#39;s automatically applied without user input.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (Dict): Testing results. Should be a dictionary containing all</span>
<span class="sd">            the metrics (used to compute the one score).</span>

<span class="sd">    Returns:</span>
<span class="sd">        One score, computed from the results given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwp</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;next_word_prediction&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">][</span><span class="s2">&quot;top3_accuracy&quot;</span><span class="p">]</span>
    <span class="n">acp</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;auto_completion&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">][</span><span class="s2">&quot;top3_accuracy&quot;</span><span class="p">]</span>
    <span class="n">acr</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;auto_correction&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">][</span><span class="s2">&quot;fscore&quot;</span><span class="p">]</span>
    <span class="n">swp</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;swipe_resolution&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">nwp</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">acp</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">acr</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">swp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="tokenizerpy"><code>tokenizer.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Module defining <code>BasicTokenizer</code>, very basic tokenizer to separate a
sentence into words.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="kebbie.tokenizer.BasicTokenizer" class="doc doc-heading">
            <code>BasicTokenizer</code>


</h3>


    <div class="doc doc-contents ">


      <p>A basic tokenizer, used for regular latin languages.
This tokenizer simply use space as word separator. Since it is used for
testing only, we don't need to care about punctuations, etc...</p>

              <details class="quote">
                <summary>Source code in <code>kebbie/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasicTokenizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic tokenizer, used for regular latin languages.</span>
<span class="sd">    This tokenizer simply use space as word separator. Since it is used for</span>
<span class="sd">    testing only, we don&#39;t need to care about punctuations, etc...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for simple preprocessing.</span>

<span class="sd">        The goal of this function is not to provide an extensive and clean</span>
<span class="sd">        preprocessing. The goal is just to normalize some characters (that</span>
<span class="sd">        are not in our keyboard, so the user can&#39;t officially type them) into</span>
<span class="sd">        their normal counterpart, that are in the keyboard.</span>

<span class="sd">        Args:</span>
<span class="sd">            sentence (str): String to normalize.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Normalized string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Replace things that are like &quot;</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

        <span class="c1"># Replace things that are like &#39;</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Replace things that are like -</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="c1"># Replace other punctuations</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># TODO: Each keyboard has its own way to deal with punctuation</span>
        <span class="c1"># (applying auto-correction or not, displaying next-word prediction or</span>
        <span class="c1"># not, etc...). So for now we just get rid of the punctuations, it&#39;s a</span>
        <span class="c1"># convenient shortcut and it&#39;s fair to all keyboards.</span>
        <span class="c1"># Eventually we should find a better way to deal with that.</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\.+\s*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*[,:;\(\)</span><span class="se">\&quot;</span><span class="s2">!?\[\]\{\}~]\s*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sentence</span>

    <span class="k">def</span> <span class="nf">word_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for splitting a sentence into a list of words.</span>

<span class="sd">        Args:</span>
<span class="sd">            sentence (str): Sentence to split.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of words from the sentence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sentence</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for updating a context, given a word that was typed.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (str): Existing context.</span>
<span class="sd">            word (str): Word being typed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Updated context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">context</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="kebbie.tokenizer.BasicTokenizer.preprocess" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method for simple preprocessing.</p>
<p>The goal of this function is not to provide an extensive and clean
preprocessing. The goal is just to normalize some characters (that
are not in our keyboard, so the user can't officially type them) into
their normal counterpart, that are in the keyboard.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>sentence</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String to normalize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for simple preprocessing.</span>

<span class="sd">    The goal of this function is not to provide an extensive and clean</span>
<span class="sd">    preprocessing. The goal is just to normalize some characters (that</span>
<span class="sd">    are not in our keyboard, so the user can&#39;t officially type them) into</span>
<span class="sd">    their normal counterpart, that are in the keyboard.</span>

<span class="sd">    Args:</span>
<span class="sd">        sentence (str): String to normalize.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Normalized string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace things that are like &quot;</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="c1"># Replace things that are like &#39;</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Replace things that are like -</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

    <span class="c1"># Replace other punctuations</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># TODO: Each keyboard has its own way to deal with punctuation</span>
    <span class="c1"># (applying auto-correction or not, displaying next-word prediction or</span>
    <span class="c1"># not, etc...). So for now we just get rid of the punctuations, it&#39;s a</span>
    <span class="c1"># convenient shortcut and it&#39;s fair to all keyboards.</span>
    <span class="c1"># Eventually we should find a better way to deal with that.</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\.+\s*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*[,:;\(\)</span><span class="se">\&quot;</span><span class="s2">!?\[\]\{\}~]\s*&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sentence</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.tokenizer.BasicTokenizer.word_split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">word_split</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method for splitting a sentence into a list of words.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>sentence</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sentence to split.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of words from the sentence.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">word_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for splitting a sentence into a list of words.</span>

<span class="sd">    Args:</span>
<span class="sd">        sentence (str): Sentence to split.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of words from the sentence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sentence</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="kebbie.tokenizer.BasicTokenizer.update_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_context</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Method for updating a context, given a word that was typed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>context</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word being typed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for updating a context, given a word that was typed.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (str): Existing context.</span>
<span class="sd">        word (str): Word being typed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">context</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="utilspy"><code>utils.py</code></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

      <p>Various utils function used by <code>kebbie</code>.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.profile_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">profile_fn</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Profile the runtime and memory usage of the given function.</p>
<p>Note that it will only account for memory allocated by python (if you use
a library in C/C++ that does its own allocation, it won't report it).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fn</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>*args</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments to pass to the given function.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keywords arguments to pass to the given function.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The return value of the function called.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The memory usage (in bytes).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The runtime (in nano seconds).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">profile_fn</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Profile the runtime and memory usage of the given function.</span>

<span class="sd">    Note that it will only account for memory allocated by python (if you use</span>
<span class="sd">    a library in C/C++ that does its own allocation, it won&#39;t report it).</span>

<span class="sd">    Args:</span>
<span class="sd">        fn (Callable): Function to profile.</span>
<span class="sd">        *args: Positional arguments to pass to the given function.</span>
<span class="sd">        **kwargs: Keywords arguments to pass to the given function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The return value of the function called.</span>
<span class="sd">        The memory usage (in bytes).</span>
<span class="sd">        The runtime (in nano seconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">runtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">memory</span> <span class="o">=</span> <span class="n">tracemalloc</span><span class="o">.</span><span class="n">get_traced_memory</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">memory</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">*</span> <span class="n">SEC_TO_NANOSEC</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.euclidian_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">euclidian_dist</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function computing the euclidian distance between 2 points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>p1</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Point 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>p2</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Point 2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Euclidian distance between the 2 given points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">euclidian_dist</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function computing the euclidian distance between 2 points.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Tuple[float, float]): Point 1.</span>
<span class="sd">        p2 (Tuple[float, float]): Point 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Euclidian distance between the 2 given points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.load_keyboard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_keyboard</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en-US&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load the keyboard data for the given language.</p>
<p>For now, only <code>en-US</code> is supported.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lang</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language of the keyboard to load.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en-US&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The keyboard data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_keyboard</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en-US&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the keyboard data for the given language.</span>

<span class="sd">    For now, only `en-US` is supported.</span>

<span class="sd">    Args:</span>
<span class="sd">        lang (str, optional): Language of the keyboard to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The keyboard data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layout_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;layouts&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">layout_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">keyboard</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">keyboard</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.strip_accents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">strip_accents</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Util function for removing accents from a given string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>s</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accented string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Same string, without accent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">strip_accents</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Util function for removing accents from a given string.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (str): Accented string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Same string, without accent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nfkd_form</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFKD&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nfkd_form</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">combining</span><span class="p">(</span><span class="n">c</span><span class="p">)])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample</span><span class="p">(</span><span class="n">proba</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Simple function to sample an event with the given probability.
For example, calling <code>sample(0.95)</code> will return <code>True</code> in 95% cases, and
<code>False</code> in 5% cases.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>proba</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability of the event to happen. Should be between 0
and 1 (included).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>True</code> if the event was sampled, <code>False</code> otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">proba</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple function to sample an event with the given probability.</span>
<span class="sd">    For example, calling `sample(0.95)` will return `True` in 95% cases, and</span>
<span class="sd">    `False` in 5% cases.</span>

<span class="sd">    Args:</span>
<span class="sd">        proba (float): Probability of the event to happen. Should be between 0</span>
<span class="sd">            and 1 (included).</span>

<span class="sd">    Returns:</span>
<span class="sd">        `True` if the event was sampled, `False` otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">proba</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">proba</span><span class="si">}</span><span class="s2">` is not a valid probability (should be between 0 and 1)&quot;</span>
    <span class="k">if</span> <span class="n">proba</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">proba</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="n">proba</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">proba</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.sample_among" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_among</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">with_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function that sample an event among several with different
probabilities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>probs</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary representing the different events
and their probabilities. Each probability should be above 0 and
their sum should not exceed 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>with_none</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set to <code>True</code>, add a <code>None</code> option (no event
sampled).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corresponding key of the event sampled.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_among</span><span class="p">(</span><span class="n">probs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">with_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that sample an event among several with different</span>
<span class="sd">    probabilities.</span>

<span class="sd">    Args:</span>
<span class="sd">        probs (Dict[Any, float]): Dictionary representing the different events</span>
<span class="sd">            and their probabilities. Each probability should be above 0 and</span>
<span class="sd">            their sum should not exceed 1.</span>
<span class="sd">        with_none (bool): If set to `True`, add a `None` option (no event</span>
<span class="sd">            sampled).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The corresponding key of the event sampled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="nb">all</span><span class="p">(</span><span class="n">w</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="p">),</span> <span class="s2">&quot;The numbers given are not a probability (should be above 0 and their sum should not exceed 1)&quot;</span>

    <span class="k">if</span> <span class="n">with_none</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.sample_partial_word" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_partial_word</span><span class="p">(</span><span class="n">keystrokes</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">true_word</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Sample a partial word from a given word, and extract the corresponding
keystrokes as well.</p>
<p>Sampling is done with increasing weights (more chances to sample a longer
list). For example if the list represent the keystrokes of "abcdef", the
probabilities are as follow:
 * "a" :     1/15
 * "ab" :    2/15
 * "abc" :   3/15
 * "abcd" :  4/15
 * "abcde" : 5/15</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>keystrokes</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Complete list of
keystrokes, representing a full word.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The word corresponding to the keystrokes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>true_word</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual word (without typo). Necessary to ensure the
sampled keystrokes are partial.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The partial list of keystrokes (sampled from the given word).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The partial word (sampled from the given word).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_partial_word</span><span class="p">(</span>
    <span class="n">keystrokes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">true_word</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample a partial word from a given word, and extract the corresponding</span>
<span class="sd">    keystrokes as well.</span>

<span class="sd">    Sampling is done with increasing weights (more chances to sample a longer</span>
<span class="sd">    list). For example if the list represent the keystrokes of &quot;abcdef&quot;, the</span>
<span class="sd">    probabilities are as follow:</span>
<span class="sd">     * &quot;a&quot; :     1/15</span>
<span class="sd">     * &quot;ab&quot; :    2/15</span>
<span class="sd">     * &quot;abc&quot; :   3/15</span>
<span class="sd">     * &quot;abcd&quot; :  4/15</span>
<span class="sd">     * &quot;abcde&quot; : 5/15</span>

<span class="sd">    Args:</span>
<span class="sd">        keystrokes (List[Optional[Tuple[float, float]]]): Complete list of</span>
<span class="sd">            keystrokes, representing a full word.</span>
<span class="sd">        word (str): The word corresponding to the keystrokes.</span>
<span class="sd">        true_word (str): Actual word (without typo). Necessary to ensure the</span>
<span class="sd">            sampled keystrokes are partial.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The partial list of keystrokes (sampled from the given word).</span>
<span class="sd">        The partial word (sampled from the given word).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_word</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">keystrokes</span><span class="p">[:</span><span class="n">s</span><span class="p">],</span> <span class="n">word</span><span class="p">[:</span><span class="n">s</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.accuracy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function computing the precision.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tp</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of True Positive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tn</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of True Negative.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fp</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of False Positive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fn</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of False Negative.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accuracy.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">tp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tn</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function computing the precision.</span>

<span class="sd">    Args:</span>
<span class="sd">        tp (int): Number of True Positive.</span>
<span class="sd">        tn (int): Number of True Negative.</span>
<span class="sd">        fp (int): Number of False Positive.</span>
<span class="sd">        fn (int): Number of False Negative.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Accuracy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.precision" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">precision</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function computing the precision.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tp</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of True Positive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fp</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of False Positive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Precision.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="n">tp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function computing the precision.</span>

<span class="sd">    Args:</span>
<span class="sd">        tp (int): Number of True Positive.</span>
<span class="sd">        fp (int): Number of False Positive.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Precision.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.recall" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recall</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function computing the recall.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tp</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of True Positive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fn</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of False Negative.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recall.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">tp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function computing the recall.</span>

<span class="sd">    Args:</span>
<span class="sd">        tp (int): Number of True Positive.</span>
<span class="sd">        fn (int): Number of False Negative.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Recall.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.fbeta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Function computing the F-beta score (which is a generalization of the
F1 score).</p>


<details class="the-value-of-beta-changes-how-much-we-weight-recall-versus-precision" open>
  <summary>The value of Beta changes how much we weight recall versus precision</summary>
  <ul>
<li>For beta=0.5, Precision is twice as important as Recall</li>
<li>For beta=2, Recall is twice as important as Precision</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>precision</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Precision.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>recall</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recall.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>beta</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Beta factor.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>F-beta score.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fbeta</span><span class="p">(</span><span class="n">precision</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">recall</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function computing the F-beta score (which is a generalization of the</span>
<span class="sd">    F1 score).</span>

<span class="sd">    The value of Beta changes how much we weight recall versus precision:</span>
<span class="sd">     * For beta=0.5, Precision is twice as important as Recall</span>
<span class="sd">     * For beta=2, Recall is twice as important as Precision</span>

<span class="sd">    Args:</span>
<span class="sd">        precision (float): Precision.</span>
<span class="sd">        recall (float): Recall.</span>
<span class="sd">        beta (float): Beta factor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        F-beta score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.round_to_n" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">round_to_n</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Util function to round a given number to n significant digits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number to round.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of significant digits to use.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rounded number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">round_to_n</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Util function to round a given number to n significant digits.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): Number to round.</span>
<span class="sd">        n (int): Number of significant digits to use.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Rounded number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.human_readable_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">human_readable_memory</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Given a number in bytes, return a human-readable string of this number,
with the right unit.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number in bytes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable version of the given number, with the right unit.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">human_readable_memory</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a number in bytes, return a human-readable string of this number,</span>
<span class="sd">    with the right unit.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number in bytes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Human-readable version of the given number, with the right unit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">x</span> <span class="o">/=</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> TB&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.human_readable_runtime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">human_readable_runtime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Given a number in nanoseconds, return a human-readable string of this
number, with the right unit.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number in nanoseconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable version of the given number, with the right unit.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">human_readable_runtime</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a number in nanoseconds, return a human-readable string of this</span>
<span class="sd">    number, with the right unit.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Number in nanoseconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Human-readable version of the given number, with the right unit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">round_to_n</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ns&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">x</span> <span class="o">/=</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> s&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kebbie.utils.get_soda_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_soda_dataset</span><span class="p">(</span><span class="n">max_sentences</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load the SODA dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>max_sentences</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of sentences in total in
the dataset. They will be shared across domain (50% from the
<code>narrative</code> domain, 50% from the <code>dialogue</code> domain).</p>
              </div>
            </td>
            <td>
                  <code>2000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed to use when shuffling the dataset (since we
don't use the whole dataset, it's better to shuffle it before
extracting the X first sentences).</p>
              </div>
            </td>
            <td>
                  <code>31</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset, separated into two domains : narrative and dialogue.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>kebbie/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_soda_dataset</span><span class="p">(</span><span class="n">max_sentences</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2_000</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">31</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the SODA dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_sentences (int, optional): Maximum number of sentences in total in</span>
<span class="sd">            the dataset. They will be shared across domain (50% from the</span>
<span class="sd">            `narrative` domain, 50% from the `dialogue` domain).</span>
<span class="sd">        seed (int, optional): Seed to use when shuffling the dataset (since we</span>
<span class="sd">            don&#39;t use the whole dataset, it&#39;s better to shuffle it before</span>
<span class="sd">            extracting the X first sentences).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dataset, separated into two domains : narrative and dialogue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;narrative&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;dialogue&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">max_domain_sentences</span> <span class="o">=</span> <span class="n">max_sentences</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">hf_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;allenai/soda&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="n">hf_dataset</span> <span class="o">=</span> <span class="n">hf_dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">hf_dataset</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;narrative&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">max_domain_sentences</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dialogue&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">max_domain_sentences</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;narrative&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">max_domain_sentences</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;narrative&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;narrative&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">sen</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;dialogue&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dialogue&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">max_domain_sentences</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dialogue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sen</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="constants">Constants</h2>
<h3 id="__init__py"><code>__init__.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.SUPPORTED_LANG" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SUPPORTED_LANG</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;en-US&#39;</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.N_MOST_COMMON_MISTAKES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">N_MOST_COMMON_MISTAKES</span> <span class="o">=</span> <span class="mi">1000</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.DEFAULT_SEED" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SEED</span> <span class="o">=</span> <span class="mi">42</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="emulatorpy_1"><code>emulator.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.ANDROID" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ANDROID</span> <span class="o">=</span> <span class="s1">&#39;android&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.IOS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">IOS</span> <span class="o">=</span> <span class="s1">&#39;ios&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.GBOARD" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">GBOARD</span> <span class="o">=</span> <span class="s1">&#39;gboard&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.TAPPA" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TAPPA</span> <span class="o">=</span> <span class="s1">&#39;tappa&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.FLEKSY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">FLEKSY</span> <span class="o">=</span> <span class="s1">&#39;fleksy&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.KBKITPRO" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">KBKITPRO</span> <span class="o">=</span> <span class="s1">&#39;kbkitpro&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.KBKITOSS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">KBKITOSS</span> <span class="o">=</span> <span class="s1">&#39;kbkitoss&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.SWIFTKEY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SWIFTKEY</span> <span class="o">=</span> <span class="s1">&#39;swiftkey&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.YANDEX" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">YANDEX</span> <span class="o">=</span> <span class="s1">&#39;yandex&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.KEYBOARD_PACKAGE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">KEYBOARD_PACKAGE</span> <span class="o">=</span> <span class="p">{</span><span class="n">GBOARD</span><span class="p">:</span> <span class="s1">&#39;com.google.android.inputmethod.latin&#39;</span><span class="p">,</span> <span class="n">SWIFTKEY</span><span class="p">:</span> <span class="s1">&#39;com.touchtype.swiftkey&#39;</span><span class="p">,</span> <span class="n">YANDEX</span><span class="p">:</span> <span class="s1">&#39;ru.yandex.androidkeyboard&#39;</span><span class="p">,</span> <span class="n">TAPPA</span><span class="p">:</span> <span class="s1">&#39;com.tappa.keyboard&#39;</span><span class="p">}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.ANDROID_CAPABILITIES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ANDROID_CAPABILITIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;platformName&#39;</span><span class="p">:</span> <span class="s1">&#39;android&#39;</span><span class="p">,</span> <span class="s1">&#39;automationName&#39;</span><span class="p">:</span> <span class="s1">&#39;UiAutomator2&#39;</span><span class="p">,</span> <span class="s1">&#39;enableMultiWindows&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;deviceName&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;newCommandTimeout&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.IOS_CAPABILITIES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">IOS_CAPABILITIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;platformName&#39;</span><span class="p">:</span> <span class="s1">&#39;iOS&#39;</span><span class="p">,</span> <span class="s1">&#39;automationName&#39;</span><span class="p">:</span> <span class="s1">&#39;XCUITest&#39;</span><span class="p">,</span> <span class="s1">&#39;udid&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;xcodeOrgId&#39;</span><span class="p">:</span> <span class="s1">&#39;8556JTA4X4&#39;</span><span class="p">,</span> <span class="s1">&#39;xcodeSigningId&#39;</span><span class="p">:</span> <span class="s1">&#39;iPhone Developer&#39;</span><span class="p">,</span> <span class="s1">&#39;useNewWDA&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;usePrebuiltWdDA&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;startIWDP&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;bundleId&#39;</span><span class="p">:</span> <span class="s1">&#39;com.apple.MobileSMS&#39;</span><span class="p">,</span> <span class="s1">&#39;newCommandTimeout&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.BROWSER_PAD_URL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BROWSER_PAD_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.justnotepad.com&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.ANDROID_TYPING_FIELD_CLASS_NAME" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ANDROID_TYPING_FIELD_CLASS_NAME</span> <span class="o">=</span> <span class="s1">&#39;android.widget.EditText&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.DUMMY_RECIPIENT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DUMMY_RECIPIENT</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.IOS_TYPING_FIELD_ID" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">IOS_TYPING_FIELD_ID</span> <span class="o">=</span> <span class="s1">&#39;messageBodyField&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.IOS_START_CHAT_CLASS_NAME" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">IOS_START_CHAT_CLASS_NAME</span> <span class="o">=</span> <span class="s1">&#39;XCUIElementTypeCell&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.TESSERACT_CONFIG" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TESSERACT_CONFIG</span> <span class="o">=</span> <span class="s1">&#39;-c tessedit_char_blacklist=0123456789:!@$%&amp;/()=.?&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.PREDICTION_DELAY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PREDICTION_DELAY</span> <span class="o">=</span> <span class="mf">0.4</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.CONTENT_TO_IGNORE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CONTENT_TO_IGNORE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sticker&#39;</span><span class="p">,</span> <span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="s1">&#39;Clipboard&#39;</span><span class="p">,</span> <span class="s1">&#39;Settings&#39;</span><span class="p">,</span> <span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Switch input method&#39;</span><span class="p">,</span> <span class="s1">&#39;Paste item&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="s1">&#39;paintpalette&#39;</span><span class="p">,</span> <span class="s1">&#39;Search Document&#39;</span><span class="p">,</span> <span class="s1">&#39;Microphone&#39;</span><span class="p">,</span> <span class="s1">&#39;gearshape&#39;</span><span class="p">,</span> <span class="s1">&#39;Next Locale&#39;</span><span class="p">,</span> <span class="s1">&#39;paintpalette&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/smileysAndPeople&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/animalsAndNature&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/foodAndDrink&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/activity&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/travelAndPlaces&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/objects&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/symbols&#39;</span><span class="p">,</span> <span class="s1">&#39;EmojiCategories/flags&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="s1">&#39;And&#39;</span><span class="p">,</span> <span class="s1">&#39;Are&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Switch language.&#39;</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.CONTENT_TO_RENAME" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CONTENT_TO_RENAME</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Delete&#39;</span><span class="p">:</span> <span class="s1">&#39;backspace&#39;</span><span class="p">,</span> <span class="s1">&#39;Backspace&#39;</span><span class="p">:</span> <span class="s1">&#39;backspace&#39;</span><span class="p">,</span> <span class="s1">&#39;Space&#39;</span><span class="p">:</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">,</span> <span class="s1">&#39;space&#39;</span><span class="p">:</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">,</span> <span class="s1">&#39;Space.&#39;</span><span class="p">:</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">,</span> <span class="s1">&#39;Emoji button&#39;</span><span class="p">:</span> <span class="s1">&#39;smiley&#39;</span><span class="p">,</span> <span class="s1">&#39;Emoji&#39;</span><span class="p">:</span> <span class="s1">&#39;smiley&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyboard Type - emojis&#39;</span><span class="p">:</span> <span class="s1">&#39;smiley&#39;</span><span class="p">,</span> <span class="s1">&#39;Search&#39;</span><span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span> <span class="s1">&#39;Enter&#39;</span><span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span> <span class="s1">&#39;Delete.&#39;</span><span class="p">:</span> <span class="s1">&#39;backspace&#39;</span><span class="p">,</span> <span class="s1">&#39;To symbols.&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;Return.&#39;</span><span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbol keyboard&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbols and numbers&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyboard Type - numeric&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;Voice input&#39;</span><span class="p">:</span> <span class="s1">&#39;mic&#39;</span><span class="p">,</span> <span class="s1">&#39;,, alternatives available, Voice typing, long press to activate&#39;</span><span class="p">:</span> <span class="s1">&#39;mic&#39;</span><span class="p">,</span> <span class="s1">&#39;Close features menu&#39;</span><span class="p">:</span> <span class="s1">&#39;magic&#39;</span><span class="p">,</span> <span class="s1">&#39;Open features menu&#39;</span><span class="p">:</span> <span class="s1">&#39;magic&#39;</span><span class="p">,</span> <span class="s1">&#39;underline&#39;</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;ampersand&#39;</span><span class="p">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;Dash&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;Plus&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;Left parenthesis&#39;</span><span class="p">:</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;Right parenthesis&#39;</span><span class="p">:</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;slash&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Apostrophe&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;Colon&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;Semicolon&#39;</span><span class="p">:</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;Exclamation&#39;</span><span class="p">:</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;Question mark&#39;</span><span class="p">:</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;Letter keyboard&#39;</span><span class="p">:</span> <span class="s1">&#39;letters&#39;</span><span class="p">,</span> <span class="s1">&#39;Letters&#39;</span><span class="p">:</span> <span class="s1">&#39;letters&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyboard Type - auto&#39;</span><span class="p">:</span> <span class="s1">&#39;letters&#39;</span><span class="p">,</span> <span class="s1">&#39;To letters.&#39;</span><span class="p">:</span> <span class="s1">&#39;letters&#39;</span><span class="p">,</span> <span class="s1">&#39;Digit keyboard&#39;</span><span class="p">:</span> <span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;More symbols&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyboard Type - symbolic&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Double tap for uppercase&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Double tap for caps lock&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Uppercase key.&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;Additional symbols.&#39;</span><span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="s1">&#39;capital Q&#39;</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;capital W&#39;</span><span class="p">:</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;capital E&#39;</span><span class="p">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;capital R&#39;</span><span class="p">:</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;capital T&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;capital Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;capital U&#39;</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;capital I&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;Capital I&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;capital O&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;capital P&#39;</span><span class="p">:</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;capital A&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;capital S&#39;</span><span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;capital D&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;capital F&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;capital G&#39;</span><span class="p">:</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;capital H&#39;</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;capital J&#39;</span><span class="p">:</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;capital K&#39;</span><span class="p">:</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;capital L&#39;</span><span class="p">:</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;capital Z&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;capital X&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;capital C&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;capital V&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;capital B&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;capital N&#39;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;capital M&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.emulator.FLEKSY_LAYOUT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">FLEKSY_LAYOUT</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;keyboard_frame&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">517</span><span class="p">,</span> <span class="mi">393</span><span class="p">,</span> <span class="mi">266</span><span class="p">],</span> <span class="s1">&#39;lowercase&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.30462962962962964</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05740740740740741</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15555555555555556</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35462962962962963</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4546296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5546296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6546296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8555555555555555</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;shift&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15555555555555556</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35462962962962963</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4546296296296296</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5546296296296296</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6546296296296297</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;backspace&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8555555555555555</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;numbers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;smiley&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.14351851851851852</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.10277777777777777</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.48703703703703705</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;enter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8648148148148148</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.12962962962962962</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">]},</span> <span class="s1">&#39;uppercase&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.30462962962962964</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05740740740740741</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15555555555555556</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35462962962962963</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4546296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5546296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6546296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8555555555555555</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;shift&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15555555555555556</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35462962962962963</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4546296296296296</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5546296296296296</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6546296296296297</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;backspace&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8555555555555555</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;numbers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;smiley&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.14351851851851852</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.10277777777777777</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.48703703703703705</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;enter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8648148148148148</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.12962962962962962</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">]},</span> <span class="s1">&#39;numbers&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20462962962962963</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.30462962962962964</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8046296296296296</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9046296296296297</span><span class="p">,</span> <span class="mf">0.19356164383561644</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10462962962962963</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20462962962962963</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.30462962962962964</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4046296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;)&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5046296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6046296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7046296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8046296296296296</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9046296296296297</span><span class="p">,</span> <span class="mf">0.4008219178082192</span><span class="p">,</span> <span class="mf">0.08796296296296297</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;shift&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3101851851851852</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.44044444444444447</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5707037037037037</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.705962962962963</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;backspace&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8551851851851852</span><span class="p">,</span> <span class="mf">0.5994520547945206</span><span class="p">,</span> <span class="mf">0.1361111111111111</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;letters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.007407407407407408</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;smiley&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.14351851851851852</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.10277777777777777</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;spacebar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25555555555555554</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.48703703703703705</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7546296296296297</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">],</span> <span class="s1">&#39;enter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8648148148148148</span><span class="p">,</span> <span class="mf">0.8080821917808219</span><span class="p">,</span> <span class="mf">0.12962962962962962</span><span class="p">,</span> <span class="mf">0.1643835616438356</span><span class="p">]}}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="gesturepy_1"><code>gesture.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.gesture.MAX_RADIUS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_RADIUS</span> <span class="o">=</span> <span class="mi">16</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.gesture.MIN_N_POINTS_PER_DIST" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MIN_N_POINTS_PER_DIST</span> <span class="o">=</span> <span class="mf">0.1</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.gesture.MAX_N_POINTS_PER_DIST" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_N_POINTS_PER_DIST</span> <span class="o">=</span> <span class="mf">0.25</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.gesture.MIN_ACCELERATION" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MIN_ACCELERATION</span> <span class="o">=</span> <span class="mf">0.2</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.gesture.MAX_ACCELERATION" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_ACCELERATION</span> <span class="o">=</span> <span class="mf">0.5</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="layoutpy_1"><code>layout.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.layout.SPACE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SPACE</span> <span class="o">=</span> <span class="s1">&#39;spacebar&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.layout.POINT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">POINT</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.layout.N_ACCENT_PER_LINE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">N_ACCENT_PER_LINE</span> <span class="o">=</span> <span class="mi">4</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="noise_modelpy_1"><code>noise_model.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.DEFAULT_TYPO_PROBS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TYPO_PROBS</span> <span class="o">=</span> <span class="p">{</span><span class="n">Typo</span><span class="o">.</span><span class="n">TRANSPOSE_CHAR</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPELLING_SYMBOL</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_SPACE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_PUNCTUATION</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">ADD_CHAR</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_ACCENT</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">SIMPLIFY_CASE</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">COMMON_TYPO</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.SPACE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SPACE</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.DELETIONS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DELETIONS</span> <span class="o">=</span> <span class="p">[</span><span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPELLING_SYMBOL</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_SPACE</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_PUNCTUATION</span><span class="p">,</span> <span class="n">Typo</span><span class="o">.</span><span class="n">DELETE_CHAR</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.FRONT_DELETION_MULTIPLIER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">FRONT_DELETION_MULTIPLIER</span> <span class="o">=</span> <span class="mf">0.36</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.DEFAULT_SIGMA_RATIO" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SIGMA_RATIO</span> <span class="o">=</span> <span class="mi">3</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.CACHE_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CACHE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.cache/common_typos/&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.noise_model.TWEET_TYPO_CORPUS_URL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TWEET_TYPO_CORPUS_URL</span> <span class="o">=</span> <span class="s1">&#39;https://luululu.com/tweet/typo-corpus-r1.txt&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="oraclepy_1"><code>oracle.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.oracle.CHUNK_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">10</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.oracle.MAX_CHAR_PER_SENTENCE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_CHAR_PER_SENTENCE</span> <span class="o">=</span> <span class="mi">256</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.oracle.SWIPE_PROB" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SWIPE_PROB</span> <span class="o">=</span> <span class="mf">0.01</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="scorerpy_1"><code>scorer.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.scorer.DEFAULT_BETA" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_BETA</span> <span class="o">=</span> <span class="mf">0.9</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.scorer.WITH_TYPO" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">WITH_TYPO</span> <span class="o">=</span> <span class="s1">&#39;with_typo&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="kebbie.scorer.WITHOUT_TYPO" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">WITHOUT_TYPO</span> <span class="o">=</span> <span class="s1">&#39;without_typo&#39;</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div><h3 id="utilspy_1"><code>utils.py</code></h3>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="kebbie.utils.SEC_TO_NANOSEC" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SEC_TO_NANOSEC</span> <span class="o">=</span> <span class="mf">10000000000.0</span></code>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>